<!DOCTYPE html>
<html class="h-f" lang="en">
<head>
<meta name="viewport" content="user-scalable=yes, width=device-width, initial-scale=1.0">
<style>

:root {
    --body-fg: #999;
    --body-bg: #222;

    --border-w: 1px;
    --border-s: solid;
    --border-c: black;


    --rg-bc: #D89;
    --rg-bc: #4F5;
    --nv-bc: #AC8;
    --nv-bc: #AAA;
    --nv-bc: #BA9;
}

*{
    box-sizing: border-box;   
  -webkit-touch-callout: none; /* iOS Safari */
    -webkit-user-select: none; /* Safari */
     -khtml-user-select: none; /* Konqueror HTML */
       -moz-user-select: none; /* Old versions of Firefox */
        -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Non-prefixed version, currently
                                  supported by Chrome, Edge, Opera and Firefox */
}
*:focus{
    outline: 1px 1px solid #b93;
}

html {
}
body {
    margin: 0px;
    padding: 0px;
    font-size: 0.875rem;
    font-family: "Roboto","Lucida Grande","DejaVu Sans","Bitstream Vera Sans",Verdana,Arial,sans-serif;
    color: var(--body-fg);
    background: var(--body-bg);
}

.hidden{
    display: none !important;
}
.collapse .collapseable{
    display: none !important;
}

button, .btn{
    background: #ccc;
    border: 1px solid #777;
    padding: 1px 2px;
    border-radius: 4px;
    margin-left: 2px;
    margin-right: 2px;
    cursor: pointer;
    display: inline-block;
}
.btn.on{
    background: #eee;
    color: #000;
}
.btn.on.dim{
    background: #999;
}
.btn.dim:not(.on){
/*    background: #222;*/
/*    color: #aaa;*/
}
.miniroll .btn.last{
}

span.log.item{
    display: inline-table;
/*    display: initial;*/
    padding-left: 28px;
    border-color: #999;
    border-style: solid;
    border-width: 0px;
}
span.log.item[data-hover]:hover::after{
/*    position: relative;*/
/*    top: 5px;*/
/*    left: 5px;*/
/*    height: 0px;*/
/*    width: 0px;*/
/*    border: 1px solid #aaa;*/
/*    padding: 2px;*/
/*    content: attr(data-hover);*/

/*    color: #863;*/
/*    color: #983;*/
/*    color: #99A;*/
    color: #99A;
    content: attr(data-hover);
    background-color: #222;
    padding: 4px;
/*    width: min-content;*/
    border-width: 1px;
    border-style: solid;

    position: fixed;
    right: 20px;
    top: 40px;

    white-space: preserve;

    max-width: 85vw;
    max-height: 80vh;
    overflow: auto;

}

span.log.item.empty{
    border-left: 0px;

}
span.log.item.input{
    padding: 4px 4px 2px 8px;
    margin: 4px 2px 2px 8px;

/*    border-color: rgb(136,136,136);*/
/*    border-color: #273;*/
/*    border-bottom: 1px solid #273;*/
/*    border-right: 1px solid #273;*/

    border-width: 1px 0px 0px 5px;
    
/*    display: block;*/
}

span.log.item::before{
/*    display: inline-block;*/
    color: #667;
}

span.log.item.input::before{
    content: "> " !important;
}
span.log.item[data-type="on"]::before{
    content: "x ";
}
span.log.item[data-type="act"]::before{
    content: "() ";
}
span.log.item[data-type="path"]::before{
    content: "@ ";
}
span.log.item[data-type="gen"]::before{
    content: "+ ";
}
span.log.item[data-type="dsp"]::before{
    content: '< ';
}
span.log.item[data-type="res"]::before{
    content: '= ';
}
span.log.item[data-type="act"]{
    color: #629191;
    color: #6a1;
}
span.log.item[data-type="act"]::after{
    border-color: #629191;
    border-color: #6a1;
}
span.log.item[data-type="path"]{
    color: #b35bd2;
}
span.log.item[data-type="path"]::after{
    border-color: #b35bd2;
}
span.log.item[data-type="gen"]{
    color: #2372d9;
}
span.log.item[data-type="gen"]::after{
    border-color: #2372d9;
}
span.log.item[data-type="res"]{
    color: #9B7646;
    color: #5ba;
}
span.log.item[data-type="res"]::after{
    border-color: #9B7646;
    border-color: #5ba;
}
span.log.item[data-type="dsp"]{
    color: #B94;
}
span.log.item[data-type="dsp"]::after{
    border-color: #B94;
}

div.io{
    max-height: 64vh;
    overflow: auto;
}
div.io.collapse{
    position: absolute;
    bottom: 0%;
    right: 0%;
}
div.io>.tag{
    cursor: cell;
}
div.io>div.label{
    text-align: center;
}
table.io th{
    background-color: #432;
    text-align: left;
}
table.io td{
    border: 1px solid #888;
    padding: 4px;
    min-width: 80px;
}
table.io div.input[data-hover]:hover::after{
    color: #863;
    color: #983;
    color: #99A;
    content: " : [ " attr(data-hover) " ]";
    background-color: #222;
    padding: 4px;
    width: min-content;
    max-width: 50vw;
    border: 1px solid;
    position: absolute;
    right: 30px;
    bottom: 40px;
}

table.io .action{
    color: #594;
}
table.io .arg{
    color: #884;
}
table.io .mod>td:first-of-type{
    border-left: 5px solid;
}
table.io .mod>td:last-of-type{
    border-right: 5px solid;
}
table.io .mod>td:nth-of-type(3){
    background: #435;
}
table.io .mod>td:nth-of-type(3)>*{
}
table.io tr:nth-of-type(3)>*{
    border-top-width: 4px;
}

table.colors .sample{
    width: 30px;
    height: 30px;
}

.prompt_mmenu_log{
    background-color: #000;
    font-size: larger;
    padding: 7px;
    padding: 7px 5px 2px;
}
.prompt_mmenu_log > .prompt{
    padding: 3px 7px;
    margin-right: 54px;
    margin-bottom: 7px;
}
.prompt{
    background-color: #122;
}
.mmenu{
    max-height: 64vh;
    overflow: auto;
    scrollbar-width: thin;
    display: flex;
}
.page_mmenu{
    width: -moz-available;
}
.log{
    max-height: 64vh;
    overflow: auto;
    scrollbar-width: thin;
}
.log_items{
}

/* id */
#bodyall{
}
#bodytop{
}
#bodybot{
    align-self: center;
    margin-bottom: 6px;
}
#bodybrand{
    position: absolute;
    right: 8px;
    top: 5px;
    font-size: large;
    padding: 5px;
    border-radius: 2px;
    background-color: #5b303082;
    cursor: pointer;
}
#bodyrow{
    overflow: auto;
}
#bodyleft{
/*    overflow: auto;*/
/*    scrollbar-width: thin;*/
/*    flex: 0.6;*/
    flex: 0;
    max-width: 40 vw;
}
#bodyright{
/*    overflow: auto;*/
/*    scrollbar-width: thin;*/
/*    flex: 0.6;*/
    flex: 0;
    max-width: 40 vw;
}
#bodycol{
    overflow: auto;
    scrollbar-width: thin;
    flex: 3;

/*    overflow: auto;*/
    overflow: hidden;
    height: inherit;
}
#bodyup{
    height: 100%;
    /*overflow: auto;
    scrollbar-width: thin;*/
    flex: 0;
/*    max-height: 100vh;*/
}
#bodycell{
    height: 100%;
    overflow: auto;
    scrollbar-width: thin;
    flex: 1;
/*    max-height: 100vh;*/
}
#bodydown{
    height: 100%;
    /*overflow: auto;
    scrollbar-width: thin;*/
    flex: 0;
/*    max-height: 100vh;*/
}

/* helper */
.d-f{
    display: flex;
}
.d-fc{
    display: flex;
    flex-direction: column;
}
.d-fr{
    display: flex;
    flex-direction: row;
}
.h-f{
    height: 100%;
}
.w-f{
    width: 100%;
}
.f-1{
    flex: 1;
}
.b-vw-v{
    border-style: var(--border-s);
    border-color: var(--border-c);
    border-width: var(--border-w);
}
.p-5{
    padding: 5px;
}
.m-2{
    margin: 2px;
}
.m-5{
    margin: 5px;
}

.default{
    text-decoration-line: underline;
    text-underline-offset: 3px;
}

.miniroll.top{
    display: flex;
}
.miniroll.left{
    height: inherit;
    overflow: auto;
    scrollbar-width: thin;
}
.miniroll.menu{
    /*    min-width: 130px;*/
    /*    padding: 10px;*/
    height: inherit;
    overflow: auto;
    scrollbar-width: thin;
}
.miniroll.title{
/*    font-size: x-large;*/
    background: #122;
    color: #aaa;
    font-size: larger;
    padding: 6px 40px;
    margin-bottom: 3px;
}
.miniroll.main{
    height: 100%;
    overflow: auto;
    scrollbar-width: thin;
    display: grid;
    justify-items: center;
    align-items: baseline;
}
.miniroll.main > table{
    width: fit-content;
}

.miniroll.down{
    height: 100%;
    overflow: auto;
    scrollbar-width: thin;
}
.miniroll.right{
    height: inherit;
    overflow: auto;
    scrollbar-width: thin;
}
.miniroll.up{
    height: 100%;
    overflow: auto;
    scrollbar-width: thin;
}
.miniroll.bottom{
    height: 100%;
    overflow: auto;
    scrollbar-width: thin;
}

.miniroll.banner button.reset{
    border-radius: 3px;
    border: 1px solid;
    margin-left: 6px;
    margin-right: 6px;
}

.miniroll .creation{
    display: block;
    min-width: 187px;
    padding: 2px 0px 2px 4px;
}
.miniroll .creation .rerolls[data-rerolls]::before {
/*  content: " [" attr(data-rerolls) "] ";*/
    content: attr(data-rerolls) " ";
/*    border-bottom: 1px solid;*/
    border-right: 1px solid;
    margin-right: 2px;
    padding-left: 4px;
    background: #000;
/*    color: #aaa;*/
/*    background: #aaa;*/
    background: #faa;
    color: #017;
    background: #641;
    color: #aaa;
}
.miniroll .creation .reroll.msg{
    height: 25px;
    display: block;
}
.miniroll .creation .stat{
    display: inline-block;
    padding: 2px 1px;
    margin-right: 5px;
}
.miniroll .creation .stat .reroll{
    width: 84px;
    max-width: 84px;
    background: #ddd;
    color: #111;
    border-radius: 4px;
    text-align: center;
    padding: 2px 0px;
    cursor: cell;
}
.miniroll .creation .stat .value{
    display: flex;
}
.miniroll .creation .stat .cur{
    width: 26px;
    text-align: center;
    align-content: center;
}
.miniroll .creation .die{
    text-align: center;
    align-content: center;
    background: #bbb;
    color: #111;
    border: 2px solid;
    border-radius: 5px;
    height: 20px;
    width: 20px;
}

.miniroll .die:not(:first-of-type){
    margin-left: -2px;
}
.miniroll .creation .die.best1{
    background: #6e2 !important;
}
.miniroll .creation .die.best2{
    background: #bf9 !important;
}
.miniroll .creation .die.best3{
    background: #bc8 !important;
}
.miniroll .creation .die.worst1{
    background: #caa !important;
}
.miniroll .stat .value .cur.bad{
    background: #302 !important;
}

.miniroll .creation>.class{
    background-color: #122;
    padding: 3px;    
}
.miniroll .creation button{
    padding: 1px 2px;
    margin-right: 3px;
    margin-top: 2px;
}
.miniroll .creation .add{
    margin-top: 5px;
    width: -moz-available;
}
.miniroll button:disabled{
    background: #333;
    color: #777;
    border-color: #777;
    border-width: 2px;
}

.miniroll .encounter > * ~ *{
    margin-top: 5px;
}

.miniroll .title .label{
    text-align: center;
}

.miniroll .info.min.party > .us::before{
/*        content: "<party>";*/
        display: inline-block;
        color: #7cb;
}
.miniroll .info.min.encounter > .them::before{
/*        content: "<encounter>";*/
        display: inline-block;
        color: #ba7;
}

.miniroll .info.min{
    /*    visibility: collapse;*/
    overflow: hidden;
    height: 35px;
    height: 18px;
}
.miniroll .info.min >*{
    /*    visibility: collapse;*/
    overflow: hidden;
}
.miniroll .info.less{
    height: 54px;
}
.miniroll .info{
    height: 128px;
    border-color: #166;
    vertical-align: top;
}
.miniroll .info.more{
    height: 180px;
}
.miniroll .info.max{
    height: 100%;
}

.miniroll .soloable{
    overflow: auto;
    scrollbar-width: thin;
}
.miniroll .info > .us{
    min-width: 50px;
    border: 1px solid #5a9;
    border: 1px solid #7cb;
}
.miniroll .info > .them{
    min-width: 50px;
    border: 1px solid #ba7;
}

.miniroll .info > .ent.min{
    /*    visibility: collapse;*/
/*    width: min-content;*/
    overflow: hidden;
/*    max-width: 15vw;*/
    flex: 0.7;
}
.miniroll .info > .ent.less{
/*    width: min-content;*/
    /*    overflow: hidden;*/
    flex: 0.85;
}
.miniroll .info > .ent{
    flex: 1;
    padding: 0px 2px;
    border: 1px solid transparent;
    min-width: 104px;
}
.miniroll .info > .ent.more{
    flex: 1.15;
}
.miniroll .info > .ent.max{
    flex: 1.3;
}

.miniroll .coord.label{
    padding: 1px 6px;
    background: #6ae;
    color: #000;
    border: 1px outset #fff;
    border-radius: 3px;
    align-content: center;
}

.miniroll .environ{
/*    display: block;*/
    overflow: auto;
    scrollbar-gutter: both-edges;
    scrollbar-width: thin;
    width: unset;
}
.miniroll .environ.top{
    overflow: unset;
}
.miniroll .environ.top > *{
/*    margin-top: 2px;*/
}
.miniroll .bglbl .cell[data-bg]::after{
    content: attr(data-bg);
}
.miniroll .npclbl .cell[data-npc]::after{
    content: attr(data-npc);
}
.miniroll .roadlbl .cell:not([data-rd]){
    color: black;
    background: black;
}
.miniroll .roadlbl .cell[data-dist]::after{
    content: attr(data-dist);
}

.miniroll .environ .cell[data-fg]::after{
    content: attr(data-fg) !important;
}
.miniroll .environ .cell[data-mg]{
    border-bottom-color: #ed7;
}
.miniroll .environ .cell[data-fgu]{
    border-up-color: #cb8;
}
.miniroll .environ .cell[data-fgr]{
    border-right-color: #cb8;
}
.miniroll .environ .cell[data-fgd]{
    border-down-color: #cb8;
}
.miniroll .environ .cell[data-fgl]{
    border-left-color: #cb8;
}
.miniroll .cell[data-b-l="r"]{
    border-left-color: var(--rg-bc) !important;    
    border-left-width: 1px;
}
.miniroll .cell[data-b-l="e"]{
    border-left-color: var(--nv-bc) !important;
    border-left-width: 0.5px;
}
.miniroll .cell[data-b-r="r"]{
    border-right-color: var(--rg-bc) !important;
    border-right-width: 1px;
}
.miniroll .cell[data-b-r="e"]{
    border-right-color: var(--nv-bc) !important;
    border-right-width: 0.5px;
}
.miniroll .cell[data-b-t="r"]{
    border-top-color: var(--rg-bc) !important;
    border-top-width: 1px;
}
.miniroll .cell[data-b-t="e"]{
    border-top-color: var(--nv-bc) !important;
    border-top-width: 0.5px;
}
.miniroll .cell[data-b-b="r"]{
    border-bottom-color: var(--rg-bc) !important;
    border-bottom-width: 1px;
}
.miniroll .cell[data-b-b="e"]{
    border-bottom-color: var(--nv-bc) !important;
    border-bottom-width: 0.5px;
}

.miniroll .cell[data-u]{
    border-color: #e8e;    
}
.miniroll .view-u .cell[data-u]::after{
    content: attr(data-u) !important;
}

.miniroll .size8 .cell{
    height: 14px;
    min-width: 16px;
    font-size: 8px;
}
.miniroll .size9 .cell{
    height: 16px;
    min-width: 17px;
    font-size: 9px;
}
.miniroll .size10 .cell{
    height: 17px;
    min-width: 18px;
    font-size: 10px;
}
.miniroll .size11 .cell{
    height: 18px;
    min-width: 19px;
    font-size: 11px;
}
.miniroll .size12 .cell{
    height: 19px;
    min-width: 20px;
    font-size: 12px;
}
.miniroll .size13 .cell{
    height: 20px;
    min-width: 21px;
    font-size: 13px;
}
.miniroll .size14 .cell{
    height: 21px;
    min-width: 22px;
    font-size: 14px;
}
.miniroll .size15 .cell{
    height: 22px;
    min-width: 23px;
    font-size: 15px;
}
.miniroll .size16 .cell{
    height: 24px;
    min-width: 24px;
    font-size: 16px;
}

.miniroll table .cell{
    height: 14px;
    min-width: 16px;
    font-size: 8px;
    border: 1.5px solid #111;
    border: 1.5px solid transparent;
    text-align: center;
    vertical-align: middle;
/*    cursor: cell;*/
/*    cursor: grabbing;*/
    cursor: default;
}
.miniroll .cell.air{
    background: #cef;
    background: #ace;
    background: #adf;
    background: #79a;
    color: #efe;
    color: #88f;
    color: #9be;
}
.miniroll .cell.bg_air{
    background: #eef;
    background: #def;
}
.miniroll .cell.block{
    background: #555;
    background: #444;
    background: #666;
    border-top-color: #777;
    border-right-color: #888;
}
.miniroll .cell.bg_block{
    background: #bbb;
}
.miniroll .cell.rg_chest{
    background: #632;
    color: #ada;
    border-left-color: #b85;
    border-bottom-color: #b85;
    border-right-color: #b85;
    border-top-color: #f00;
}
.miniroll .cell.rg_chest::after{
    content: 'C';
}
.miniroll .cell.chest{
    background: #72a;
    background: #632;
    color: #ada;
    border-left-color: #b85;
    border-bottom-color: #b85;
    border-right-color: #b85;
}
.miniroll .cell.chest::after{
    content: 'c';
}
.miniroll .cell.l_door{
    background: #630;
    border-left-color: #bbb;
    border-right-color: #bbb;
}
.miniroll .cell.l_door::after{
    content: 'D';
}
.miniroll .cell.ul_door{
    background: #972;
}
.miniroll .cell.ul_door::after{
    content: 'd';
}
.miniroll .cell.earth{
    background: #642;
}
.miniroll .cell.bg_earth{
    background: #bb8;
    background: #a96;
    background: #aa6;
}
.miniroll .cell.floral{
    background: #f67;
    background: #f979ce;
    background: #e7b;
    border-top-color: #fff;
    color: #6e2;
    color: #3e2;
}
.miniroll .cell.bg_floral{
    background: #c99;
    border-color: #a99;
}
.miniroll .cell.greenery{
    background: #1d2;
    background: #3b3;
    color: #541;
/*    border-bottom-color: #9db;*/
    border-top-color: #cfd;
}
.miniroll .cell.bg_green{
    background: #2a1;
    background: #1a2;
    background: #6e9;
    background: #4a5;
    color: #783;
}
.miniroll .cell.terminal{
    background: #b82;
    color: #dfc;
/*    border-right-color: #d7c;*/

    border-top-color: #ff0;
}
.miniroll .cell.terminal::after{
    content: 'H';
}
.miniroll .cell.chair{
    background: #b82;
    color: #dfc;
/*    border-right-color: #d7c;*/

    border-top-color: #ff0;
}
.miniroll .cell.chair::after{
    content: 'h';
}
.miniroll .cell.iceb{
    background: #6ef;
    background: #2ef;
}
.miniroll .cell.bg_iceb{
    background: #ace;
}
.miniroll .cell.jem{
    background: #b5e;
    background: #a3e;
    background: #c7b;
    background: #b7e;
    color: #ccc;
    color: #eee;
    color: #ded;
}
.miniroll .cell.jem[data-type]::after{
    content: attr(data-type);
}
.miniroll .cell.jem:not([data-type])::after{
    content: 'J';
}
.miniroll .cell.bg_jungle{
    background: #7c3;
}
.miniroll .cell.rg_kraft{
    background: #962;
    background: #c90;/*ods*/
    border-left-color: #ca8;
    border-bottom-color: #ca8;
    border-right-color: #ca8;
    border-top-color: #f00;
}
.miniroll .cell.rg_kraft::after{
    content: 'K';
}
.miniroll .cell.kraft{
    background: #632;
    background: #72a;
    color: #ada;
    border-left-color: #b85;
    border-bottom-color: #b85;
    border-right-color: #b85;
    border-left-color: #ca8;
    border-bottom-color: #ca8;
    border-right-color: #ca8;
}
.miniroll .cell.kraft::after{
    content: 'k';
}
.miniroll .cell.logic{
    background: #CA4;
}
.miniroll .cell.bg_logic{
    background: #bb5;
    background: #8b7;
    border-color: #8e0;
}
.miniroll .cell.magma{
    background: #d60;
}
.miniroll .cell.bg_magma{
    background: #C62;
    background: #E84;
}
.miniroll .cell.fence{
    background: #83f;
    border-top-color: #fff;
}
.miniroll .cell.bg_fence{
    background: #a93;
}
.miniroll .cell.portal{
    background: #234;
    color: #461;
}
.miniroll .cell.bg_portal{
    background: #457;
}
.miniroll .cell.platform{
    background: #a71;
    border-top-color: #531;
    color: #ccc;
}
.miniroll .cell.power{
    background: #ec6;
    border-bottom-color: #efd;
}
.miniroll .cell.rg_quorum{
    background: #da4;
    border-left-color: #ca8;
    border-bottom-color: #ca8;
    border-right-color: #ca8;
    border-top-color: #f00;
}
.miniroll .cell.rg_quorum::after{
    content: 'Q';
}
.miniroll .cell.quest{
    background: #9cf;
}
.miniroll .cell.quest::after{
    content: 'q';
}
.miniroll .cell.rg_research{
    background: #da4;
    border-left-color: #ca8;
    border-bottom-color: #ca8;
    border-right-color: #ca8;
    border-top-color: #f00;
}
.miniroll .cell.rg_research::after{
    content: 'R';
}
.miniroll .cell.research{
    background: #632;
    background: #72a;
    color: #ada;
    border-left-color: #b85;
    border-bottom-color: #b85;
    border-right-color: #b85;
    border-left-color: #ca8;
    border-bottom-color: #ca8;
    border-right-color: #ca8;
}
.miniroll .cell.research::after{
    content: 'r';
}
.miniroll .cell.sand{
    background: #982;
    background: #861;
    background: #c91;
    background: #d91;
    border-top-color: #873;
    color: #ccc;
    color: #641;
}
.miniroll .cell.bg_sand{
    background: #db6;
}
.miniroll .cell.rg_toggle{
    background: #173;
    color: #ada;
    border-left-color: #ca8;
    border-bottom-color: #ca8;
    border-right-color: #ca8;
    border-top-color: #f00;
}
.miniroll .cell.rg_toggle::after{
    content: 'T';
}
.miniroll .cell.toggle{
    background: #173;
    color: #ada;
    border-left-color: #ca8;
    border-bottom-color: #ca8;
    border-right-color: #ca8;
}
.miniroll .cell.toggle::after{
    content: 't';
}
.miniroll .cell.rg_umbra{
    background: #48c;
    color: #ada;
    border-left-color: #ca8;
    border-bottom-color: #ca8;
    border-right-color: #ca8;
    border-top-color: #f00;
}
.miniroll .cell.rg_umbra::after{
    content: 'U';
}
.miniroll .cell.umbra{
    background: #48c;
    color: #ada;
    border-left-color: #ca8;
    border-bottom-color: #ca8;
    border-right-color: #ca8;
}
.miniroll .cell.umbra::after{
    content: 'u';
}
.miniroll .cell.vernal{
    background: #cd3;
    background: #cf5;
    background: #ee6;
    background: #ee7;
    border-top-color: #85e;
}
.miniroll .cell.bg_vernal{
    background: #ad9;
    background: #ac4;
    background: #bd4;
    color: #bbb;
}
.miniroll .cell.water{
    background: #04f;
    background: #06f;
    border-top-color: #38f;
    border-bottom-color: #34f;
}
.miniroll .cell.bg_water{
    background: #8ac;/*ods*/
    background: #6ad;
    background: #7ae;
    background: #59f;
    background: #5ce;
    background: #3cf;
}
.miniroll .cell.harm{
    background: #f6c;
    background: #f67;
    color: #fff;
    color: #fd0;
    color: #fd8;
}
.miniroll .cell.harm::after{
    content:'X';
}
.miniroll .cell.bg_harm{
    background: #e48;
}
.miniroll .cell.on_light{
    background: #ffa;
}
.miniroll .cell.off_light{
    background: #dd8;
}
.miniroll .cell.mover{
    background: #f8f;
}
.miniroll .cell.mover::after{
    content:'Z';
}
.miniroll .cell.pilot{
    background: #e9e;
}
.miniroll .cell.pilot::after{
    content:'z';
}

.miniroll .cell.fog{
    background: #222 !important;
    color: transparent !important;
}
.miniroll .cell.road{
    outline: 1.5px solid #7b7b75;
/*    border-color: #4a3a29 !important;*/
    border-color: #fc9;

}

.miniroll .cell.water.fog{
    border-color:#06f4;
}
.miniroll table:not(.noroad) .cell.road.water{
    background: #09f;
    background: #6cf;/*ods*/
    background: #4cf;
    color: #25a;
}
.miniroll .cell.forest{
    background: #050;
    background: #090;/*ods*/
    color: #642;
}
.miniroll .cell.forest.fog{
    border-color:#0904;
}
.miniroll table:not(.noroad) .cell.forest.road{
    background: #290;
    background: #0c0;/*ods*/
    background: #2b0;
    background: #2c0;
}
.miniroll .cell.desert{
    background: #a84;
    background: #c9c997;/*ods*/
    color: #666;
}
.miniroll .cell.desert.fog{
    border-color:#c9c99744;
}
.miniroll table:not(.noroad) .cell.desert.road{
    background: #962;
    background: #c90;/*ods*/
    color: #dd9;
}
.miniroll .cell.grass{
    background: #cd5;
    background: #ff9;/*ods*/

    background: #ff8;
    color: #825;
}
.miniroll .cell.grass.fog{
    border-color:#ff84;
}
.miniroll table:not(.noroad) .cell.grass.road{
    background: #690;
    background: #ba2;
    background: #ffd320;/*ods*/
    background: #ecbe0a;
    background: #ecc90a;
    color: #925;
}
.miniroll .cell.jungle{
    background: #250;
    background: #062;
    background: #007826;/*ods*/

    background: #061;
    color: #999;
}
.miniroll .cell.jungle.fog{
    border-color:#0614;
}
.miniroll table:not(.noroad) .cell.jungle.road{
    background: #673;
    background: #6c0;/*ods*/

    background: #391;
    color: #040;
}
.miniroll .cell.swamp{
    background: #240;
    background: #143;
    background: #363;/*ods*/

    background: #353;
}
.miniroll .cell.swamp.fog{
    border-color:#3534;
}
.miniroll table:not(.noroad) .cell.swamp.road{
    background: #460;
    background: #473;
    background: #693;/*ods*/

    background: #683;
    color: #356;
}
.miniroll .cell.ice{
    background: #bce;
    background: #bdf;
    background: #fff;/*ods*/
    background: #def;
    color: #000;
}
.miniroll .cell.ice.fog{
    border-color:#fff4;
}
.miniroll table:not(.noroad) .cell.ice.road{
    background: #5be;
    background: #666;/*ods*/

    background: #2ef;
    color: #35d;
}
.miniroll .cell.hill{
    background: #666;
    background: #999;/*ods*/

    background: #a73;
    background: #777;
    color: #ccc;
}
.miniroll .cell.hill.fog{
    border-color:#7774;
}
.miniroll table:not(.noroad) .cell.hill.road{
    background: #444;
    background: #96C;/*ods*/

    background: #447;
    background: #d96;
    background: #874;
    background: #65c;
    background: #546;
    border-color: #962 !important;
}
.miniroll .cell.mtn{
    background: #555;
    color: #dd9;
}
.miniroll .cell.mtn.fog{
    border-color:#5554;
}
.miniroll table:not(.noroad) .cell.mtn.road{
    background: #65c;
    background: #546;
    background: #333;
    border-color: #73d !important;
    color: #bbb !important;
}

.miniroll .cell.party{
    color: #240;
    background: #eb5;
}
.miniroll .cell.fr{
    color: #af0 !important;
}
.miniroll .cell.nt{
    color: #ff0 !important;
}
.miniroll .cell.hst{
    color: #fb0 !important;
}
.miniroll .cell.human{
    background: #ca7 !important;
}
.miniroll .cell.party{
    background: #277 !important;
}

.miniroll .info.min >*{
    /*    visibility: collapse;*/
    overflow: hidden;
}
.miniroll .info.less{
    height: 54px;
}
.miniroll .info{
    height: 128px;
    border-color: #166;
    vertical-align: top;
}
.miniroll .info.more{
    height: 180px;
}
.miniroll .info.max{
    height: 100%;
}

.miniroll .help{
    cursor: help;
}

.miniroll .party{
/*    display: table-row;
    display: flex;
    display: grid;
    grid-template-columns: 1fr 3fr 3fr 3fr auto;*/
    /*      width: -moz-available*/
}
.miniroll .party.info{
/*    display: inline-flex;*/
/*    flex-direction: row;*/
}
.miniroll .info{
    display: flex;
}
.miniroll .label{
    display: inline-block;
}

.miniroll .party > *{
    /*    display: table-cell;*/
    border: 1px solid #111;
}
.miniroll .party .title{
    background: #122;
    background: #333;
    color: #aaa;
    padding: 4px;
    min-width: 90px;
    min-width: 82px;
}

.miniroll .encounter .ent{
    border-color: #166;
}

.miniroll .mode.min::before{
    display: inline-block;
    content: "<Wayfarer\'s Rest'>";
    visibility: visible;
    width: -moz-available;
    text-align: center;
    position: relative;
    padding-bottom: 3px;
    color: #d7a;
    margin-top: -18px;
}
.miniroll .mode.min{
    visibility: collapse;
    height: unset;
    display: table;
    height: 18px;
}
.miniroll .mode.less{
    height: 50px;
}
.miniroll .mode{
    height: 100px;
}
.miniroll .mode.more{
    height: 200px;
}
.miniroll .mode.max{
    height: unset;
}
.miniroll .mode .label{
    background-color: #322;
    padding: 6px;   
}
.miniroll .mode > *{
    margin: 9px 9px 23px 9px;
    border: 1px solid black;
    background: #454;
}
.miniroll .mode button{
    padding: px 4px;
    margin: 1px 3px;
    margin: 4px;
    background: inherit;
    color: black;
    color: #bbb;
    border: 2px outset;
    border-radius: 3px;
    border-color: #aaa;
}

.miniroll .inspect.min{
    display: none;
}
.miniroll .inspect.less{/*2 lines*/
    max-height: 24px;
    max-height: 44px;
    max-height: 37px;
    max-height: 42px;
}
.miniroll .inspect{/*3 lines*/
    height: 88px;
    height: 61px;
    height: 68px;
    height: 84px;
/*    overflow: auto;*/
/*    scrollbar-width: thin;*/
/*    height: 100px;*/
}
.miniroll .inspect.more{/*5 lines*/
    height: 176px;
    height: 102px;
    height: 114px;
    height: 136px;
/*    height: 40vh;*/
}
.miniroll .inspect.max{/*any lines*/
    height: unset;
    height: 171px;
    height: 190px;
    height: 191px;
    height: 192px;
    height: 100%;
}

.miniroll .inspect td{
    text-align: center;
}
.miniroll .inspect td ~ td{
    border-left: 1px dotted;
}
.miniroll .inspect td.hl{
    background: #333;
}
.miniroll .inspect tr.hl > *{
    border-top: 1px solid #333;
}
.miniroll .inspect th{
    background: #232;
    padding: 2px 4px;
    border-top: 2px solid #000;
}
.miniroll .inspect tr:not(:first-of-type) td{
    border-top: 1px dotted;
}
.miniroll .focus{
    outline-offset: 2.5px;
    outline: 1.5px solid #6b6;
    outline: 1.5px solid #cec !important;
}
.miniroll .focused{
    outline-offset: 2px;
    outline: 1px solid ;
}
.miniroll .viewing{
    outline-offset: 1.5px;
    outline: 2.5px solid #6b6;
}

.miniroll .attack .label{
    color: #29958b;    
}

.miniroll .options .option{
    margin: 1px 2px 1px 0px;
    background: #999;
    color: #111;
    font-variant: small-caps;
    font-size: larger;
    
    display: inline-block;
    padding: 0px 2px;
    height: 19px;
}
.miniroll .option.empty{
    display: none;
}

.miniroll .options .active:not(.focus){
    background-color: #6a6;
}

.miniroll .party.offense > .ent, .miniroll .party.defense > .ent{
    display: grid;
    justify-items: center;
}
.miniroll .action.tumbler.lr{
    width: fit-content;
    padding: 1px 6px;
    border-radius: 14px;
    border-bottom: 1px solid;
}
.miniroll .action.tumbler.ud{
    margin: 2px 1px;
    padding: 2px 4px;
    border: 1px solid;
    border-radius: 4px;
    background: #432;
    color: #a84;
    color: #985;
}

.miniroll .defense .action.tumbler.lr{
    background: #256;
    color: #fda;
    border-color: #bbb;
}
.miniroll .offense .action.tumbler.lr{
    background: #632;
    color: #fda;
    border-color: #bbb;
}

.miniroll .prompt{
    padding: 2px 3px;
    padding: 5px;
}
.miniroll .main .prompt{
    max-width: 200px;
    white-space: wrap;
}
.miniroll .main .prompt .ent{
/*    border: 1px solid #166;*/
    padding: 2px 2px;
}

.miniroll .msg{
    white-space: wrap;
    border: 1px dashed #777;
    padding: 3px 6px;
    display: inline-block;
    margin-right: 5px;
    margin-bottom: 4px;
    background: #333;

}

.miniroll .tag{
    white-space: nowrap;
    display: inline;
}

.miniroll .ent .actions .skills::before{
    content: "skills:";
    display: block;
}
.miniroll .ent .actions .spells::before{
    content: "spells:";
    display: block;
}
.miniroll .ent .actions .abilities::before{
    content: "abilities:";
    display: block;
}
.miniroll .ent .actions .futures::before{
    content: "future actions:";
    display: block;
}
.miniroll .ent .actions .futures .lvl::before{
    content: "[";
}
.miniroll .ent .actions .futures .lvl::after{
    content: "]:";
}
.miniroll .ent .actions .futures .lvl{
    margin-left: 8px;
}

.miniroll .ent .actions > * > * > *{
    display: inline-block;
    padding: 0px 2px;
}
.miniroll .ent .actions .known .name{
    margin-left: 8px;
}
.miniroll .ent .actions .charges::before{
    content:": ";
}
.miniroll .ent .vitals .max_health::before{
    content: ' / ';
}
.miniroll .ent .vitals .max_health::after{
    content: ' hp';
}


.miniroll .ent .combat{
    display: table;
}
.miniroll .ent .combat > *{
    display: table-row;
}
.miniroll .ent .combat > * > *{
    display: table-cell;
    padding: 1px 2px;
}
.miniroll .ent .combat > * > * ~ *{
    border-left: 1px solid;
}
.miniroll .ent .combat > * ~ * > *{
    border-top: 1px solid;
}

.miniroll .ent .combat .label{
    background-color: #243;
    text-align: center;
}

.miniroll .ent .stats{
    display: table;
}
.miniroll .ent .stats .row{
    display: table-row;
}
.miniroll .ent .stats .stat{
    display: table-cell;
    padding: 1px 2px;
}
.miniroll .ent .stats .stat.value{
    padding-left: 8px;
    text-align: right;
}
.miniroll .ent .eq .slot{
    display: table-row;
}
.miniroll .ent .eq .slot::before{
    content: attr(data-prefix);
    display: table-cell;
}
.miniroll .ent .eq .slot .label{
    padding: 0px 3px;
}
.miniroll .info.min .plate{
    display: inline;
}
.miniroll .ent.min .plate .lvl{
    display: none;
}
.miniroll .ent .plate .lvl::before{
/*    content: '[ ';*/
    content: ' ';
}
.miniroll .ent .plate .lvl::after{
    content: '-';
}
.miniroll .ent .plate .cl::after{
/*    content: ' ]  ';*/
    content: ' ';
}
.miniroll .ent .pos::before{
    content: '';
}
.miniroll .ent .pos{
    padding: 0px 3px;
    color: #b45;
    color: #adf;
    background-color: #388;
}
.miniroll .ent .index::before{
    content: '#';
    background-color: revert;
}
.miniroll .ent .index{
    padding: 0px 3px;
    background-color: #388;
    color: #ae8;
}
.miniroll .encounter .ent .index{
    background-color: #ba7; 
    color: #347;
}

.miniroll .status{
    background: #a74;
    color: #ccc;
    text-align: center;
}
.miniroll .statuses .status{
    background: #a74;
    color: #ccc;
    text-align: center;
}
.miniroll .statuses .status.unc{
    display: block;
    background: #999;
    margin-top: -17px;
    color: #a15;
}

.miniroll .targets{
    width: 100px;
}
.miniroll .targets > .btn{
    display: inline-block;
    width: 25px;
    margin: 0;
    padding: 0;
    text-align: center;
}
</style>
<script>
///site.js 
const DEFAULT_PATH = '/tool/miniroll'
window.select = {
    _log:{
        LOG_ERR: true,
        LOG_WARN: true,
        LOG_NOTE: true,
        LOG_PATH: false,
        LOG_GEN: false,
        LOG_ON: false,
        LOG_ACT: false,
        LOG_RES: false,
        LOG_DSP: false,
        LOG_DFT: true, // only for nulls

        time: function(){
            // "YYYYMMDD_hhmmDO" D east/west O offset-hr-utc
            // return (new Date()).getTime().toString()
            let d = new Date()
            d.d = d.getDate()
            return String(d.getFullYear()) + 
                (d.getMonth() > 8 ? 
                    (1+d.getMonth()) :
                ('0' + (1 + d.getMonth()))) +
                (d.d > 9 ? (d.d) : ('0' + d.d)) + '_' +
                (d.getHours() > 9 ? 
                    d.getHours() :
                ('0' + d.getHours())) +
                d.getMinutes() +
                (d.getTimezoneOffset() > 0 ?
                    ('w' + (d.getTimezoneOffset() / 60)) :
                ('e' + (d.getTimezoneOffset() / 60)));
        },

        // optional settings: store/display/console/recovery
        // optional readers of settings: ...path error_ on_ action_ generate_ display_ view_ note_ debug_ recover_  
        _path: null,
        path: function(
            path, ... _data){
            // store?
            // log?
            if (this.LOG_PATH || this.LOG_PATH == null && this.LOG_DFT)
                console.log("log path:", ...arguments)

            // display?
            this._path = [path, _data]
        },
        generate_: function(
            gen_path, opts){
            // store?
            // log?
            if (this.LOG_GEN || this.LOG_GEN == null && this.LOG_DFT)
                console.log("log generate:", ...arguments)

            // display?
        },

        // WIP: move to page/dsp/state -specific
        ignore_errs: [
            'retry road' // TEMP. only for miniroll
            ],

        error_: function(...data){
            let err = data.length && data instanceof Error && data.shift()
            if (!err) err = new Error()

            // WIP stack format
            // let stack = err.stack.split('\n').map((i)=>(i.split('@')[0] + '@' + i.substring(i.lastIndexOf('/') ))).join('\n')

            // ignore? either message or first-data
            if (this.ignore_errs.includes(err.message)) return;
            if (data.length && this.ignore_errs.includes(data[0])) return;

            // log?
            if (this.LOG_ERR || this.LOG_ERR == null && this.LOG_DFT)
                console.error("log error:", ...data, "\n", err);
            // store?
            // display?
        },
        note_: function(...data){
            // log?
            if (this.LOG_NOTE || this.LOG_NOTE == null && this.LOG_DFT)
                console.log("log note:", ...data)
            // store?
            // display?            
        },
        warn_: function(...data){
            // log?
            if (this.LOG_WARN || this.LOG_WARN == null && this.LOG_DFT)
                console.warn("log warn:", ...data)
            // store?
            // display?            
        },

        on_: function(
            on_path, input_action){ 
            // log?
            if (this.LOG_ON || this.LOG_ON == null && this.LOG_DFT)
                console.log("log input/on:", ...arguments)
            // store?
            // display?            
        },
        action_: function(
            action_path, arg){
            // log?
            if (this.LOG_ACT || this.LOG_ACT == null && this.LOG_DFT)
                console.log("log action:", ...arguments)
            // store?
            // display?            
        },
        result_: function(
            path, result){
            // log?
            if (this.LOG_RES || this.LOG_RES == null && this.LOG_DFT)
                console.log("log result:", ...arguments)
            // store?
            // display?            
        },
        display: function(
            path){
            // log?
            if (this.LOG_DSP || this.LOG_DSP == null && this.LOG_DFT)
                console.log("log display:", ...arguments)
            // store?
            // display?
        },
    },

    _selection:null, // current value. prefer _word as value rather than key to _word_
    _selection_: {}, // key is path stored at Each._path
    selections: function(path){
        // => [/tool/miniroll/overrides, /tool/miniroll, /tool]
        let sels = [], 
            sel
        if (path){
            if (path._path){
                path = path._path
            }
            sel = select._selection_[path]
            if (!sel)
                path = ""
        }
        if (!path){
            sel = select._selection
            if (!sel)
                return []
            path = sel._path
        }
        while(sel && path){
            sels.push(sel)
            path = sel._path.substring(0, sel._path.lastIndexOf('/'))
            sel = select._selection_[path]
        }
        if (!sels[0])
            return []
        return sels
    },
    first_selection_: function(
        type, key, _from){
        let sels, seli
        // return [mixed-symbol-full-path , result]
        // get [type][key] 
        // _from first match between selection-selecting-display, selection-state, or selection for each in stacked-possible-selections 

        sels = select.selections(_from && _from._path || _from)
        for (let sel of sels){
            if (!sel) continue;
            if ( ((seli = sel._selecting) instanceof Element) && seli[type] && key 
                 in seli[type] ){
                return [sel._path + 
                    '>_selecting.' + type + '.' + key,
                    seli[type][key] ];
            }
            // _state expected as either State-value(ref-from-'_state_' or any) or key

            if ( (seli = sel._state) && seli[type] && key in seli[type] ){
                return [sel._path + 
                    '>_state.' + '.' + type + '.' + key,
                    seli[type][key] ];
            }
            if ( sel._state_ && (seli = sel._state_[sel._state]) && seli[type] && key in seli[type] ){
                return [sel._path + 
                    '>_state_.' + sel._state + '.' + type + '.' + key,
                    seli[type][key] ];
            }

            if (sel && sel[type] && key in sel[type]){
                if (sel instanceof Element){
                    return ['site>html>*.' + 
                        type + '.' + key,
                        sel[type][key] ]
                }else{
                    return [sel._path + '>' + 
                        type + '.' + key,
                        sel[type][key] ]
                }
            }
        }
    },

    selection: function(
        sel){
        // from possible string or fuller-path or already-a-value
        // a fuller-path includes path + '>' + dot-keys. retrieve selection from it.
        if (!sel) return select._selection;
        if (sel.constructor.name == 'String'){
            // 
            if (sel.includes('>')){
                sel = sel.substring(0, sel.indexOf('>'))
            }
            return select._selection_[sel]
        }
        return sel
    },

    path: function(
        new_path, __queue){
        // nav to new path/selection/page/script-stack (selection as path/loadable-script, selecting as display) 
        // load base paths. load in order
        let sel, paths = [],
            i = new_path.indexOf('/', 1);

        while(i != -1){
            paths.push(new_path.substring(0, i))
            i = new_path.indexOf('/', i + 1)
        }
        paths.push(new_path)

        // if any path not found. try to load it and queue remaining path changes
        while (paths.length){
            if (!(paths[0] in select._selection_)){
                if (!__queue) __queue = [];
                if (!Array.isArray(__queue)) __queue = [__queue]
                // queue followup repeat. queue should only reach 1-length because break now.
                __queue.unshift(new_path)
                // set 
                new_path = paths[0]
                break;
            }
            if (paths.length == 1){
                select._selection = select._selection_[paths[0]]
                if (__queue && Array.isArray(__queue) && __queue.length){
                    return select.path(__queue.shift(), __queue)
                }else{
                    return view.refresh_selection()
                }
            }
            paths.shift()
        }

        let script = document.createElement('script')
        script.src = new_path.slice(1) + '.js'
        select._log.path(new_path)

        script.onload = function(){
            console.log('script.onload:', this, arguments)

            sel = select._selection

            if (!sel || new_path != sel._path){
                // bare selection/page
                sel = {_path: new_path, _mod: {_cur:0, _max:1}}
            }
            select._selection = sel
            select._selection_[new_path] = sel

            if (__queue && Array.isArray(__queue) && __queue.length){
                return select.path(__queue.shift(), __queue)
            }else{
                view.refresh_selection()
            }
        }
        script.onerror = function(){
            console.log("SCRIPT ERROR:", this, arguments, "\nnew_path:", new_path, "\ncurrent_path:", select._selection && select._selection._path, "target_path:", __queue && __queue[0])

            sel = {_path: new_path, _mod: {_cur:0, _max:1}}
            select._selection = sel
            select._selection_[new_path] = sel

            if (__queue && Array.isArray(__queue) && __queue.length){
                return select.path(__queue.shift(), __queue)
            }else{
                view.refresh_selection()
            }
        }

        document.head.appendChild(script)
        document.head.removeChild(script)
        return 0
    },
    _test_all_element_events: function(el, _white_list, _black_list){
        if (!(el instanceof Element)) return;
        // wip: derive this based on the element supplied
        const list = ['onabort', 'onanimationcancel', 'onanimationend', 'onanimationiteration', 'onanimationstart',
            'onauxclick', 'onbeforeinput', 'onbeforetoggle', 'onblur', 'oncancel', 'oncanplay', 'oncanplaythrough',
            'onchange', 'onclick', 'onclose', 'oncontextlost', 'oncontextmenu', 'oncontextrestored', 'oncopy',
            'oncuechange', 'oncut', 'ondblclick', 'ondrag', 'ondragend', 'ondragenter', 'ondragexit', 'ondragleave',
            'ondragover', 'ondragstart', 'ondrop', 'ondurationchange', 'onemptied', 'onended', 'onerror',
            'onfocus', 'onformdata', 'onfullscreenchange', 'onfullscreenerror', 'ongotpointercapture', 'oninput',
            'oninvalid', 'onkeydown', 'onkeypress', 'onkeyup', 'onload', 'onloadeddata', 'onloadedmetadata',
            'onloadstart', 'onlostpointercapture', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover',
            'onmouseup', 'onpaste', 'onpause', 'onplay', 'onplaying', 'onpointercancel', 'onpointerdown',
            'onpointerenter', 'onpointerleave', 'onpointermove', 'onpointerout', 'onpointerover', 'onpointerup',
            'onprogress', 'onratechange', 'onreset', 'onresize', 'onscroll', 'onscrollend', 'onsecuritypolicyviolation',
            'onseeked', 'onseeking', 'onselect', 'onselectionchange', 'onselectstart', 'onslotchange', 'onstalled',
            'onsubmit', 'onsuspend', 'ontimeupdate', 'ontoggle', 'ontransitioncancel', 'ontransitionend',
            'ontransitionrun', 'ontransitionstart', 'onvolumechange', 'onwaiting', 'onwebkitanimationend',
            'onwebkitanimationiteration', 'onwebkitanimationstart', 'onwebkittransitionend', 'onwheel',
            ]
        const b_lists = {
            mouse_pointer: [
                            'onmouseover', 'onmousemove', 'onmouseout', // keep: up, down
                            'onpointerover', 'onpointermove', 'onpointerout',
                            'onpointerenter', 'onpointerleave', // keep: cancel, up, down
                            ]
        }
        if (_black_list in b_lists)
            _black_list = b_lists[_black_list];
        console.log("TEST: attaching events to:", el,"\nevent list:",list)
        for (let _on of (Array.isArray(_white_list)? _white_list: list)){
            if (Array.isArray(_black_list) && _black_list.includes(_on))
                continue;
            el[_on] = function(){
                console.log('called test-event el.' + _on, " el:", el, " event:", arguments)
            }
        }
    },

    generate_: function(name, options, _from){
        // make classes/displays
        let cmp, rules, result, sel
        sel = select.first_selection_('_generate_', name, _from)
        if (!sel){
            select._log.warn_('missing generate from:', name, _from)
            return
        }
        rules = sel[1]
        try{
        // Generate rules

        // 1-constructor-used and is required at rules <selection._generate_[*]>
        // EXCEPTION naming:
        // .generate(options) .className(options) _attr_.*(options)
        // .init(result) .children(result) .finalize(result)

        if (rules.generate_){
            result = rules.generate_(name, options)
        }else if (rules.generate){
            result = rules.generate(options)
        }else if (rules._generate){
            result = select.generate_(rules._generate.name || rules._generate, rules._generate.options || options, _from)
        }else if (rules._element){
            if (rules._namespace){
                result = document.createElementNS(rules._element, rules._namespace)
            }else{
                result = document.createElement(rules._element)
            }
        }else{
            result = new window[rules._class]()
        }

        if (result == null){
            console.log("error valid constructor missing at:", sel)
            return
        }

        for (let rule of [rules, options]){
            if (!rule)continue;

            if (rule.init_){
                rule.init_(result, options)
            }else if (rule.init){
                rule.init(result)
            }
        }

        for (let rule of [rules, options]){
            if (!rule)continue;

            if (rule.className_){
                cmp = rule.className_(result, options)
                if (cmp)
                    result.className += ' ' + cmp
            }
            if (rule.className){
                cmp = rule.className(options)
                if (cmp)
                    result.className += ' ' + cmp
            }
            if (rule._classNames){
                result.className += ' ' + rule._classNames.join(' ')
            }
            if (rule._className){
                result.className += ' ' + rule._className
            }

            if (rule._prop__){
                for (let [k,v_] of Object.entries(rule._prop__)){
                    cmp = v_(result, options)
                    // ignore UNDEFINED, allow NULL
                    if (cmp !== undefined)
                        result[k] = cmp
                }
            }
            if (rule._prop_){
                for (let [k,v] of Object.entries(rule._prop_)){
                    result[k] = v
                }
            }
            if (rule._attr__){
                for (let [k,v_] of Object.entries(rule._attr__)){
                    cmp = v_(result, options)
                    if (cmp != undefined)
                        result.setAttribute(k, cmp)
                }
            }
            if (rule._attr_){
                for (let [k,v] of Object.entries(rule._attr_)){
                    if (v instanceof Function){
                        cmp = v(options)
                        if (cmp != undefined)
                            result.setAttribute(k, cmp)
                    }else{
                        if (v != undefined)
                            result.setAttribute(k, v)
                    }
                }
            }
            if (rule.children_){
                rule.children_(result, options)
            }
            if (rule.children){
                rule.children(result)
            }
            if (rule._children_pre_dsp){
                // get/create display and add as child. see display-naming.
                for (let ch of rule._children_pre_dsp){
                    cmp = view.display(ch, _from)
                    if (!(cmp instanceof Element)){
                        console.log("failed getting display child:", cmp,"\nfrom {name,options}:", ch);
                    }else{
                        result.appendChild(cmp)
                    }
                }
            }
            if (rule._children_gen_opts){
                // create and add as child. (display can be reused, gen not.)
                for (let ch of rule._children_gen_opts){
                    cmp = select.generate_(ch.gen||ch, ch.opts||options, _from)
                    if (!(cmp instanceof Element)){
                        console.log("failed generating generate child:", cmp,"\nfrom {name,options}:", ch);
                    }else{
                        result.appendChild(cmp)
                    }
                }
            }
            if (rule._children_dsp){
                // get/create display and add as child
                for (let ch of rule._children_dsp){
                    cmp = view.display(ch, _from)
                    if (!(cmp instanceof Element)){

                        select._log.warn_("ignore add-display-child. non-element", cmp, " using:", ch);
                    }else{
                        result.appendChild(cmp)
                    }
                }
            }
        }
        for (let rule of [rules, options]){
            if (!rule)continue;
            if (rule.finalize_){
                rule.finalize_(result, options)
            }
            if (rule.finalize){
                rule.finalize(result)
            }
        }
        if (sel[0] != '/tool>_generate_.log_item'){
            select._log.generate_(sel[0], options)
        }
        }catch(e){
            select._log.error_(e, 'from select.generate_')
            throw e;
        }
        return result
    },

    action_: function(
        name, arg, _from){
        // console.log("ACTION => ", name, arg)

        let sel = select.first_selection_('_action_', name, _from)
        const vert = ['up', 'down']
        const horz = ['left', 'right']

        if (!sel){
            select._log.action_('', name)
            return;
        }

        // ...wip dont interrupt browser scroll
        if (document.activeElement){
            if (document.activeElement.scrollTopMax){
                if (vert.includes(sel[1].name)){
                    return
                }
            }
            if (document.activeElement.scrollLeftMax){
                if (horz.includes(sel[1].name)){
                    return
                }
            }
        }

        select._log.action_(sel[0], arg)
        if (sel[0].endsWith('_') && Array.isArray(arg)){
            return select._log.result_(sel[0], sel[1](...arg) )
        } 
        return select._log.result_(sel[0], sel[1](arg) )
    },
    on_: function(onname, inputname){
        // wip: doc name differences
        let sel;
        if (onname != null){
            select.first_selection_('_on_', onname)
        }
        if (!sel && inputname){
            sel = select.first_selection_('_on_', inputname)
        }

        if (!sel){
            select._log.on_(onname || '', [inputname, ''])
            return;
        }
        select._log.on_(sel[0], [inputname, sel[1][0]])
        return select.action_(sel[1][0], sel[1][1])
     },

    _input_time_:{// for determination of hold- or double- by input_
        // input_name: time
    },
    // _hold_min_msec: 580,
    _hold_min_msec: 480,
    _dbl_max_msec: 270,
    _input_on_: {
        'keyup_Enter': 'ok',
        'keyup_End': 'ok',
        'keyup_Control': 'back',
        'keyup_Delete': 'back',
        'keyup_Shift': 'mod',
        'keyup_PageDown': 'mod',
        'keyup_1': 'mod',

        'keyup_ArrowLeft': 'left',
        'keyup_ArrowUp': 'up',
        'keyup_ArrowDown': 'down',
        'keyup_ArrowRight': 'right',
    },
    _input_: {},
    input_: function(type, name, _event){    
        // wip: doc name differences

        if (!select._selection){
            select.path(DEFAULT_PATH)
            return
        }
        
        let cmp, time = select._log.time()
        let pre=0, onname = select._input_on_[type + name]
        switch(type){
            case 'mousedown_':
            case 'keydown_':
            case 'mousewheel_':
                cmp = select._input_[type]

                if (cmp && (time - cmp[1]) <= select._dbl_max_msec &&
                     (cmp[0] == name || 
                      cmp[0].startsWith('dbl_') && 
                        cmp[0] == 'dbl_'+ name)){
                    pre = 1
                    name = 'dbl_' + name
                }

                select._input_[type] = [String(name), time]
                if (type == 'mousewheel_')break;
                return;
            case 'keyup_':
                cmp = 1
            case 'mouseup_':
                cmp = cmp? select._input_.keydown_ : select._input_.mousedown_

                if (!cmp) return;
                if (cmp[0] == name);
                else if(cmp[0].startsWith('dbl_') && cmp[0] == 'dbl_'+ name){
                    pre = 1
                    name = cmp[0]
                }
                else return;

                if ((time - cmp[1]) >= select._hold_min_msec){
                    pre = 1
                    name = 'hold_' + name
                }
                select._input_[type] = [String(name), time]
                // if (type == 'mouseup_') return;
                break;
            default:
                if (type){
                    name = type + name
                    type = ''
                }
                cmp = select._input_[name] || select._input_['dbl_'+name]
                if (cmp && (time - cmp) <= select._dbl_max_msec ){
                    name = 'dbl_' + name
                }
                select._input_[name] = time
        }

        let mod = select._selection._mod || {}
        if (mod._cur && mod._max == 1){
            name = "mod_" + name
        }else if (mod._cur){
            name = "mod" + String(mod._cur) + "_" + name
        }

        name = type + name
        if (onname && (pre || mod._cur)) onname += String((mod._cur || 0) * 2 + pre)

        return select.on_(onname, name)
    },

    ok: function(){return select.input_('','ok')},
    back: function(){return select.input_('','back')},
    cycle: function(){return select.input_('','cycle')},
    left: function(){return select.input_('','left')},
    up: function(){return select.input_('','up')},
    down: function(){return select.input_('','down')},
    right: function(){return select.input_('','right')},
    
    Keydown: function(event){if(event.repeat)return;return select.input_('keydown_', event.key, event)},
    Keyup: function(event){return select.input_('keyup_', event.key, event)},

    Mousedown: function(event){return select.input_('mousedown_', event.button, event)},
    Mouseup: function(event){return select.input_('mouseup_', event.button, event)},
    // Mouseclick: function(event){return select.input_('mouseclick_', event.button, event)},
    
    Mousewheel: function(event){/*test deltaX*/;return select.input_('mousewheel_', (event.deltaY < 0? 'up':event.deltaY > 0? 'down': event.deltaX < 0? 'left': 'right'), event)},

    // Keypress: function(event){return select.input_('keypress_'+event.key, event)},
    // Gesture: function(event){},
    // Button: function(event){},
    // Key: function(event){},
    // Char: function(event){},
}
onkeydown = select.Keydown
onkeyup = select.Keyup

onmousedown = select.Mousedown
onmouseup = select.Mouseup

onwheel = select.Mousewheel

// view .. display
var view = {
    MIN: -2, LESS: -1, NORM: 0, MORE: 1, MAX: 2, // +hide == 6-total-sizes ??
    _refreshing: null,
    _page_phrase_: {
        // a page may use only these.

        // #bodyhead (no phrase. reserved for tool and main menus)
        bodytop: "top",

        bodyleft: "left side",
        bodyup: "up above",
        bodycell: "main cell center middle",
        bodydown: "down below",
        bodyright: "right side",

        bodybot: "bot",
        // #bodyfoot (no phrase. reserved for tool and inputs)
        // #bodybrand (no phrase. reserved for tool and menu toggle)

    },

    // refresh site-page areas
    head: function(display){view.site_display_(document.all.bodyhead, display)},
    foot: function(display){view.site_display_(document.all.bodyfoot, display)},

    bottom: function(display){view.site_display_(document.all.bodybot, display)},
    top: function(display){view.site_display_(document.all.bodytop, display)},

    left: function(display){view.site_display_(document.all.bodyleft, display)},
    up: function(display){view.site_display_(document.all.bodyup, display)},
    down: function(display){view.site_display_(document.all.bodydown, display)},
    right: function(display){view.site_display_(document.all.bodyright, display)},

    main: function(display){view.site_display_(document.all.bodycell, display)},
    cell: function(display){view.site_display_(document.all.bodycell, display)},
    center: function(display){view.site_display_(document.all.bodycell, display)},
    middle: function(display){view.site_display_(document.all.bodycell, display)},

    bodybrand: function(display){view.site_display_(document.all.bodybrand, display)},

    display: function(name, _from){
        // get value-only . entry gets [path, value]
        var r = view.entry_display_from_(name, _from)
        if (r) return r[1]
    },
    entry_display_from_: function(name, from){
        // bad name for what it does. can refresh.

        // get from._display_[name]
        let dsp, res, sel, gen = (name[-1+name.length] == '_')
        from = select.selection(from)
        sel = select.first_selection_('_display_', name, from)

        if (!sel || !sel[1]){
            select._log.warn_('missing display:', sel, name, from)
            return
        }
        res = sel[1]

        while (1){
            // gen-always is 'name_' form. 'name' can be re-used. name_ can reuse manually but not here.

            if (!gen && res._value){
                // reuse value
                dsp = res._value
                break
            }
            select._log.display(sel[0])

            // Display rules
            // do not use from?
            if (res.generate){
                dsp = res.generate()
            }else if (res._generate_name){
                dsp = select.generate_(res._generate_name, res._generate_options || {})
            }else if (res._generate){
                if (Array.isArray(res._generate)){
                    dsp = select.generate_(res._generate[0], res._generate[1])
                }else{
                    dsp = select.generate_(res._generate, res._generate_options || {})
                }
            }

            if (gen && res._value && res._value.parentElement){
                res._value.parentElement.insertBefore(dsp, res._value)
                res._value.parentElement.removeChild(res._value)
            }

            res._value = dsp
            break;
        }

        return [sel[0], dsp];
    },

    site_display_: function(site, display){
        let s = (site instanceof Element)? site: view.site(site)
        let d = (display instanceof Element)? display: view.display(display)
        if (!s){
            select._log.error_("unknown site", site)
            return
        }else if (!d){
            select._log.error_("unknown display", display)
            return
        }
        s.innerHTML = ""
        s.appendChild(d)
        return s
    },
    display_html_: function(display, html){
        let d = (display instanceof Element)? display: view.display(display)
        if (!d){
            select._log.error_("unknown display", display)
            return
        }
        d.innerHTML = String(html)
        // ...
        return d
    },
    display_text_: function(display, text){
        let d = (display instanceof Element)? display: view.display(display)
        if (!d){
            select._log.error_("unknown display", display)
            return
        }
        d.innerText = String(text)
        return d
    },
    display_concat_: function(display, concat){
        let d = (display instanceof Element)? display: view.display(display)
        if (!d){
            select._log.error_("unknown display", display)
            return
        }
        d.innerText += String(concat)
        return d
    },
    display_root_: function(display, root){
        let d = (display instanceof Element)? display: view.display(display)
        let r = (root instanceof Element)? root: view.display(root)
        if (!d){
            select._log.error_("unknown display", display)
            return
        }else if (!r){
            select._log.error_("unknown display/root", root)
            return
        }
        d.innerHTML = ""
        d.appendChild(r)
        return d
    },
    display_child_: function(display, child){
        let d = (display instanceof Element)? display: view.display(display)
        let c = (child instanceof Element)? child: view.display(child)
        if (!d){
            select._log.error_("unknown display", display)
            return
        }else if(!c){
            select._log.error_("unknown display/child", child)
            return
        }
        d.appendChild(c)
        return d
    },

    prompt: function(prompt){
        return view.display_text_('prompt', prompt)
    },

    refresh: function(display, _from){
        this.display(display, _from)
    },

    refresh_selection: function(){
        // call every _view_[k]:v  as view[k](v) expecting k as site-region or phrase in _page_phrase_)
        // called on base-selections first. possible redundancy or reserve site areas.

        let sel = select._selection, 
            sites = Object.keys(view._page_phrase_),
            paths = [],
            path = sel && sel._path,
            i = path && path.indexOf('/', 1);

        if (!path) return;

        view._refreshing = Object.keys(view._page_phrase_)

        while(i != -1){
            paths.push(path.substring(0, i))
            i = path.indexOf('/', i + 1)
        }
        paths.push(path)

        while (paths.length){
            if (!(sel = select._selection_[paths.shift()])){
                console.log("error: refresh_selection called before all selections cached.", Error().stack)
                continue
            }
            if (sel._view_){
                for (let [k,v] of Object.entries(sel._view_)){
                    try{
                        // console.log("view." + k, view[k], v)
                        view[k](v)
                    }catch(e){
                        console.log(e, '\nerror trying to call view[k](v):', k, v)
                    }
                }
            }
        }
    },
}

// optional set_display_how_data(name, how, data) :: generic for view.display_*
// optional: Object.prototype.toString = function(){ ... :: read-friendly JSON-like replace [object Map/...] avoiding-recursion( with either non-invertable {..} or invertable this-path- encoding/decoding '_this.' ..  )

window.onload=function(_){
    select.path(DEFAULT_PATH)
}
// end site.js
</script>
<script>
// tool.js
(function(){
var __path = '/tool'
var __sel, __prop, __action
if (!select._selection_[__path]){
__sel = select._selection = select._selection_[__path] = {
    _path: __path,
    _mod: {_cur:0,_max:1},
    _prop_: {},
    _selecting: null,
    _on_: {
        ok: ['ok'],
        back: ['back'],
        mod: ['cycle_mod'],
        left: ['left'],
        up: ['up'],
        down: ['down'],
        right: ['right'],

        ok2: ['ok'],
        back2: ['back'],
        mod2: ['cycle_mod'],
        left2: ['left'],
        up2: ['up'],
        down2: ['down'],
        right2: ['right'],
 
        // wip. .. and display requires transpose name
        "keyup_mod_\\": ['view_io_'],
        "keyup_\\": ['view_io_'],
        "keyup_mod_Backspace": ['view_log_'],
        "keyup_Backspace": ['view_log_'],

        "keyup_mod_hold_\\": ['view_io_', '1'],
        "keyup_hold_\\": ['view_io_', '1'],
        "keyup_mod_hold_Backspace": ['view_log_', '1'],
        "keyup_hold_Backspace": ['view_log_', '1'],
    },
    _action_: {
        cycle_mod: function(){
            select._selection._mod._cur += 1
            if (select._selection._mod._cur > 
                select._selection._mod._max)
                select._selection._mod._cur = 0
            view.refresh_mod()
        },
        ok: function(){
            console.log("default-ok-action does nothing. may override _action_.ok() in selecting-display or selection-state or selection-page")
        },
        back: function(){
            // wip dependent on backable-logging awaiting set_selection and select._log._selectings|._actives
            console.log("default-back-action does nothing or awaiting backable-logging. may override _action_.back() in selecting-display or selection-state or selection-page")
        },
        left: function(){
            console.log("default-left-action does nothing. may override _action_.left() in selecting-display or selection-state or selection-page")
        },
        up: function(){
            console.log("default-up-action does nothing. may override _action_.up() in selecting-display or selection-state or selection-page")
        },
        down: function(){
            console.log("default-down-action does nothing. may override _action_.down() in selecting-display or selection-state or selection-page")
        },
        right: function(){
            console.log("default-right-action does nothing. may override _action_.right() in selecting-display or selection-state or selection-page")
        },

        path: function(path){
            // EXCEPTION expect only-and-all-base-paths-to-begin-with-/  . '/tool' here. common-names are bare. 
            if (!path.startsWith('/')){
                path = select._selection._path + '/' + path
            }
            return select.path(path)
        },
        set_selecting: function(sel){
            // old._action_.onselecting_blur_(new)
            // old -focus, -active(1-per-parent, so if-same-parent)
            // new +focus +action
            // new._action_.onselecting_focus(old)
            try{
                let o
                if (!(sel instanceof Element)) throw new TypeError('sel must be Element'); // review caller or data
                if (!select._selection) throw new Error('no current path-selection'); // should never occur.
                if (o = select._selection._selecting){
                    if (sel === o) 
                        return true;
                    if (o._action_ && o._action_.onselecting_blur){
                        o._action_.onselecting_blur(sel)
                    }
                    if (o.parentElement == sel.parentElement){
                        o.classList.remove('active')
                    }else{
                        // console.log('wip creating new active-display. push to backable-log/actives to allow back to pop refocus last-active')
                    }
                    o.classList.remove('focus')
                }
                select._selection._selecting = sel
                sel.classList.add('focus')

                // console.log('wip push/override/move-to-top to backable-log/actives
                sel.classList.add('active')

                if (sel._action_ && sel._action_.onselecting_focus){
                    sel._action_.onselecting_focus(o)
                }
                return true
            }catch(e){
                select._log.error_(e, 'from set_selecting', sel)
            }
        },


        toggle_hide_force_: function(toggle, hide, _force_expand){
            try{
                // and calls set_selecting if unhidden
                // force-OFF if not _force but not undefined
                // hide class removed by default
                let rem = hide? null: 'hidden',
                    cl = hide? 'hidden': 'collapse';

                if (!(toggle instanceof Element)) throw new TypeError('toggle must be element');
                if (rem) toggle.classList.remove(rem);
                if (_force_expand || _force_expand === undefined && toggle.classList.contains(cl)){
                    toggle.classList.remove(cl)
                    select.action_('set_selecting', toggle)
                    return false
                }else{
                    toggle.classList.add(cl)
                    return true
                }
            }catch(e){
                select._log.error_(e, 'from toggle_hide_force_', arguments)
            }
            return null
        },
        shrink_dsp_force_grow_: function(dsp, force, _grow){
            // call manually or by component_sizeable
            //  view.MIN:-2 view.LESS:-1 view.MORE:1 view.MAX:2
            // _grow not implimented
            // at MIN, ignore
            // to MIN, cycle to MORE (not to MAX)
            // MIN is soft-lock, and MAX is fleeting
            //    alt-click in MIN forces MAX
            //    alt-click anywhere else forces MIN
            //       alt-click depends on implimentation. may use combination of _mod system (2+ input-states), hold-click, dbl-click, hold-dbl-click, ...

            // if dsp has class 'sib', single MAX(rest MIN) or single MORE(rest LESS) or all NORM. click other to swap. click same to cycle max/more/norm

            if (!(dsp instanceof Element))
                return;

            let sz, 
                use_sib = dsp.classList.contains('sib')

            const set_min = function(_dsp){
                if (!_dsp) _dsp = dsp
                _dsp.classList.add('min')
                _dsp.classList.remove('less')
                _dsp.classList.remove('more')
                _dsp.classList.remove('max')
                _dsp.scrollTop = 0
                _dsp.scrollLeft = 0
            }
            const set_less = function(_dsp){
                if (!_dsp) _dsp = dsp
                _dsp.classList.remove('min')
                _dsp.classList.add('less')
                _dsp.classList.remove('more')
                _dsp.classList.remove('max')
            }
            const set_norm = function(_dsp){
                if (!_dsp) _dsp = dsp
                _dsp.classList.remove('min')
                _dsp.classList.remove('less')
                _dsp.classList.remove('more')
                _dsp.classList.remove('max')
            }
            const set_more = function(_dsp){
                if (!_dsp) _dsp = dsp
                _dsp.classList.remove('min')
                _dsp.classList.remove('less')
                _dsp.classList.add('more')
                _dsp.classList.remove('max')
            }
            const set_max = function(_dsp){
                if (!_dsp) _dsp = dsp
                _dsp.classList.remove('min')
                _dsp.classList.remove('less')
                _dsp.classList.remove('more')
                _dsp.classList.add('max')
            }
            const set_size = function(_dsp){
                if (sz > view.MORE){
                    set_max(_dsp)
                }else if(sz > view.NORM){
                    set_more(_dsp)
                }else if (sz < view.LESS){
                    set_min(_dsp)
                }else if (sz < view.NORM){
                    set_less(_dsp)
                }else{
                    set_norm(_dsp)
                }
            }
            const dec_size = function(){
                sz -= 1
                if (sz == view.MIN){
                    sz = view.MORE
                }else if (sz < view.MIN)
                    sz = view.MIN
            }
            const save_size = function(){
                if (dsp.sz_name && dsp.sz_sel){
                    dsp.sz_sel._prop_[dsp.sz_name] = sz
                }
            }
            const ensure_sz = function(_dsp){
                if (sz == null){
                    upd_size(_dsp)
                }
            }
            const upd_size = function(_dsp){
                if ((_dsp || dsp).classList.contains('max')){
                    sz = view.MAX
                }else if((_dsp || dsp).classList.contains('more')){
                    sz = view.MORE
                }else if((_dsp || dsp).classList.contains('min')){
                    sz = view.MIN
                }else if((_dsp || dsp).classList.contains('less')){
                    sz = view.LESS
                }else{
                    sz = view.NORM
                }
            }

            if (force != null){
                sz = force
                set_size()
                save_size()
                return
            }else{
                sz = dsp.sz_sel._prop_[dsp.sz_name]

                if (!use_sib){
                    ensure_sz()
                    dec_size()
                    set_size()
                    save_size()
                    return
                }

                let max = dsp.sz_sel._prop_[dsp.sz_name + '_max'],
                    more = dsp.sz_sel._prop_[dsp.sz_name + '_more']

                ensure_sz(dsp.parentElement)
                if (max != null){
                    if (dsp.sz_ix != max){
                        // remove other max. dont expand clicked item yet.
                        dsp.sz_sel._prop_[dsp.sz_name + '_max'] = null
                    }else{
                        // shrink to more
                        max = dsp.sz_sel._prop_[dsp.sz_name + '_max'] = null
                        more = dsp.sz_sel._prop_[dsp.sz_name + '_more'] = dsp.sz_ix
                    }
                }else if (more != null){
                    // already more. change this to more
                    more = dsp.sz_sel._prop_[dsp.sz_name + '_more'] = null
                }else{
                    // even. max this. next click more this. next click even
                    // even. max this. other click, max that
                    max = dsp.sz_sel._prop_[dsp.sz_name + '_max'] = dsp.sz_ix
                }

                save_size()
                set_size(dsp.parentElement)
                for (let sibling of dsp.parentElement.children){
                    if (max != null){
                        if (max == sibling.sz_ix){
                            set_max(sibling)
                        }else{
                            set_min(sibling)
                        }
                    }else if (more != null){
                        if (more == sibling.sz_ix){
                            set_more(sibling)
                        }else{
                            set_less(sibling)
                        }
                    }else{
                        set_norm(sibling)
                    }
                }
            }
        },
        __sizeable_altclick: function(evt, force){
            // alt-type forces unlock/lock from/to view.MIN
            // EXCEPTION assumes min is visible and clickable

            if (evt && evt.stopPropagation){
                evt.stopPropagation()
            }
            // console.log('alt-clicked on sizable-dom:', this)

            if (force != null)
                return select.action_('shrink_dsp_force_grow_', [this, force])
            if (this.classList.contains('min'))
                return select.action_('shrink_dsp_force_grow_', [this, view.MAX])
            return select.action_('shrink_dsp_force_grow_', [this, view.MIN])
        },
        __sizeable_click: function(evt, force){
            if (evt && evt.detail == 2 && this.ondblclick){
                return;
            }
            // console.log('clicked on sizable-dom:', this)

            if (evt && evt.stopPropagation)evt.stopPropagation()
            return select.action_('shrink_dsp_force_grow_', [this, force])
        },
        __sizeable_refresh: function(evt){
            // console.log('clicked on refresh-dom:', this)

            if (evt && evt.stopPropagation)evt.stopPropagation()

            try{

            let force = this.sz_sel._prop_[this.sz_name]

            // refresh all? or refresh only non-sibling?
            return select.action_('shrink_dsp_force_grow_', [this, force])
            dsp.onclick(null, sel._prop_[name]);

            if (force != null)
            if (this.classList.contains('min'))
                return;
            select.action_('shrink_dsp_force_grow_', this)
            }catch(e){
                // if (LOG_COMPN_ERR .. THROW? )
                console.log(e)
                return
            }
        },

        add_component_sizable_: function(dsp, sel, name, ix){
            if (!dsp)
                return;
            if (!name){
                dsp.err_sizable_component = 'missing name'
            }else if (!(ix == null || ix >= 0)){
                if (dsp.err_sizable_component)
                    dsp.err_sizable_component += ',ix'
                else
                    dsp.err_sizable_component = 'missing ix'
            }
            if (dsp.err_sizable_component)
                return;

            dsp.sz_name = name
            dsp.sz_sel = sel || {_prop_:{}} // minimum

            if (ix != null){
                dsp.sz_ix = ix;
                dsp.classList.add('sib'); // ok if redundant
            }


            // wip convert to follow select._hold times with -click reading time and double-click-is-not-unique (just faster) but hold is valuable if input-mechanism allows it; possibly 2+ distinct buckets for accentuation like (no and no no, yes and yes yes, go and go go, back and back back) or bounce-reverse or restart

            dsp.ondblclick = dsp.onaltclick = __action.__sizeable_altclick
            dsp.onclick = __action.__sizeable_click
            dsp.refresh = __action.__sizeable_refresh
            dsp.refresh()
        },

        add_component_clickaction_: function(dsp, type){
            switch(type){
            case 'delete':
                dsp.onclick = ()=>(dsp.parentElement&& dsp.parentElement.removeChild(dsp))
                break;
            case 'visible':
            case 'collapse':
            case 'hidden':
            case 'hide':
            case 'toggle':
                dsp.onclick = ()=>(dsp.style.visibility = dsp.style.visibility == 'collapse'? 'visible': 'collapse')
                break;
            default:
                console.log('unimplimented click action', type)
            }
        },

        view_io_: function(_hide_toggle, _force){
            let d = select._selection_['/tool']._display_.io._value
            if (__action.toggle_hide_force_(d, _hide_toggle, _force)){
                d.scrollTop = 0
            }
        },
        view_log_: function(_hide_toggle, _force){
            let d = select._selection_['/tool']._display_.log._value
            if (__action.toggle_hide_force_(d, _hide_toggle, _force)){
                d.scrollTop = d.scrollTopMax
            }
        },
        view_mmenu_: function(_hide_toggle, _force){
            // expect OVERRIDE for each local-pages main-menu
                        if (__action.toggle_hide_force_(dsp, true)){
                            // hidden so accentuate this
                            this.classList.add('on')
                        }else{
                            // visible so dim this
                            this.classList.remove('on')
                        }

            return __action.view_log_(...arguments)
        },
        
    },
    _generate_:{
        div: {_element:'div'},
        table: {_element:'table'},
        tablehead: {_element:'thead'},
        tablelabel: {_element:'th'},
        tablebody: {_element:'tbody'},
        tablerow: {_element:'tr'},
        tablecell: {_element:'td'},

        log_item: {_element:'span',
            _className: 'log item',
            className: (opts)=>(
                !opts._item[2]?
                    'empty':
                opts._item[1]=='on'?
                    'input':
                undefined),
            _attr_: {
                "data-hover": function(opts){
                    let txt = 'Type: ' + opts._item[1]
                    if (opts._item[2]){
                        txt += '\n'
                        txt += 'Path: ' + opts._item[2]
                    }
                    if (opts._item[3] !== undefined){
                        txt += '\n'
                        txt += 'Data: ' + opts._item[3]
                    }
                    if (opts._item[4] !== undefined){
                        txt += '\n'
                        txt += 'Call: ' + opts._item[4]
                    }
                    if (opts._item[5] !== undefined){
                        txt += '\n'
                        txt += '5: ' + opts._item[5]
                    }
                    return txt
                },
                "data-type": (opts)=>opts._item[1]
            },
            _prop__: {
                innerText: function(dsp, opts){
                    let txt = opts._item[2]
                    if (!txt)
                        return ''
                    if (txt.includes('.')){
                        return txt.slice(1+txt.lastIndexOf('.'))
                    }
                    return txt
                },

                onclick: function(dsp, opts){
                    if (opts._item[2] && 
                          'on' == opts._item[1]){
                        return function onclick(event){
                            console.log('onclick log item:', this)
                            // select.on_()
                            select.action_('view_log_', 0)
                        }
                    }
                },
            },
        },
        table_io: {_element: 'table',
            _className: 'io collapseable',
            _attr_: {cellspacing: "0"},
            init_: function(table, _opts){
                // WIP testing. clearer display.

                // console.log('table_io.init_() opts:', _opts)
                let tr, td, sel, c, made, names, base,
                    keys = [],
                    brief = _opts && _opts._brief,
                    tbd = document.createElement('tbody')


                const row_on = [
                    ['ok', 'back', 'mod', 'left', 'up', 'down', 'right'],
                    ['ok1', 'back1', 'mod1', 'left1', 'up1', 'down1', 'right1'],
                    ['ok2', 'back2', 'mod2', 'left2', 'up2', 'down2', 'right2'],
                    ['ok3', 'back3', 'mod3', 'left3', 'up3', 'down3', 'right3'],
                    ]

                table.appendChild(tbd)
                for (let row of row_on){
                    tr = document.createElement('tr')
                    tbd.appendChild(tr)
                    base = [-1]
                    for (let on of row){
                        base[0] += 1
                        base[1] = row_on[0][base[0]]
                        base[2] = on.slice(base[1].length)

                        td = document.createElement('td')
                        tr.appendChild(td)

                        c = document.createElement('div')
                        c.className = "input"
                        c.innerText = on
                        for (let [i,o] of Object.entries(select._input_on_)){
                            if (o == base[1]){
                                names = [c.getAttribute('data-hover') || '']
                                if (names[0]) names[0] += ', '
                                switch(base[2]){
                                    case '':
                                        names.push(i)
                                        break
                                    case '1':
                                        names.push('dbl_')
                                        names.push(i)
                                        names.push(', ')
                                        names.push('hold_')
                                        names.push(i)
                                        break
                                    default:
                                        names.push('mod')
                                        names.push(Math.floor(Number(base[2]) / 2))
                                        // 'mod' === 'mod1'. mod1 implies max > 1
                                        if (names[-1+names.length] == 1){
                                            names.pop()
                                        }
                                        names.push('_')
                                        if (Number(base[2]) % 2){
                                            names.push('dbl_')
                                            names.push(i)
                                            names.push(', ')
                                            names.push('mod')
                                            names.push(names[-6+names.length])
                                            if ('mod' == names[-1+names.length]){
                                                names.pop()
                                            }
                                            names.push('_')
                                            names.push('hold_')
                                        }
                                        names.push(i)
                                }
                                c.setAttribute('data-hover', names.join(''))
                            }
                        }
                        td.appendChild(c)

                        td.onclick = ()=>select.on_(on, "click_" + on);

                        sel = select.first_selection_('_on_', on)
                        if (!sel)
                            continue

                        keys.push(on)
                        c = document.createElement('div')
                        c.className = "action"
                        c.innerText = sel[1][0]
                        td.appendChild(c)
                        if (sel[1][1] != undefined){
                            c = document.createElement('div')
                            c.className = "arg"
                            c.innerText = sel[1][1]
                            td.appendChild(c)
                        }
                    }
                }
                if (select._selection._mod && select._selection._mod._cur){
                    tbd.children[2].className = "mod"
                    tbd.children[3].className = "mod"
                }else{
                    tbd.children[0].className = "mod"
                    tbd.children[1].className = "mod"
                }

                sel = select._selection
                while(sel){
                    made = 0
                    if (sel._on_){
                        for (let _key of Object.keys(sel._on_)){
                            if (keys.includes(_key)) continue;
                            keys.push(_key)
                            if (!made){
                                made = 4
                                tbd = document.createElement('tbody')
                                table.appendChild(tbd)
                                tr = document.createElement('tr')
                                tbd.appendChild(tr)
                                td = document.createElement('th')
                                tr.appendChild(td)
                                td.colSpan = 7
                                td.innerText = "^ @" + sel._path.replaceAll('/', ' ')
                                tbd = document.createElement('tbody')
                                table.appendChild(tbd)
                                tr = document.createElement('tr')
                                tbd.appendChild(tr)
                            }else if (made == 1){
                                made = 4
                                tr = document.createElement('tr')
                                tbd.appendChild(tr)
                            }
                            made -= 1
                            td = document.createElement('td')
                            td.colSpan = made == 2 ? 3: 2
                            tr.appendChild(td)

                            td.onclick = ()=>select.on_(_key, "click_" + _key);

                            c = document.createElement('div')
                            c.className = "input"
                            c.innerText = _key
                            td.appendChild(c)

                            c = document.createElement('div')
                            c.className = "action"
                            c.innerText = sel._on_[_key][0]
                            td.appendChild(c)

                            if (sel._on_[_key][1] != undefined){
                                c = document.createElement('div')
                                c.className = "arg"
                                c.innerText = sel._on_[_key][1]
                                td.appendChild(c)
                            }


                        } 
                    }// if sel._on_
                sel = select.selections(sel)[1]
                }// while sel
            }, // end init_
        },
    },
    _display_: {
        // reusables. WIP most.
        io_tag_: {
            _generate_name: 'div',
            _generate_options: {
                _className: 'tag',
                _prop_: {
                    innerText: '\\',
                    onclick: function(_){
                        select.action_('view_io_')
                    },
                }
            }
        },
        io_label_: {
            _generate_name: 'div',
            _generate_options: {
                className: function(_){
                    if (select._selection && select._selection._mod && select._selection._mod._cur)
                        return 'mod'
                },
                _className: 'label collapseable',
                _prop__:{
                    innerText: function(dsp, opts){
                        let txt = ''
                        if (select._selection._mod && select._selection._mod._cur){
                            txt += 'mod'
                            if (select._selection._mod._cur > 1)
                                txt += String(select._selection._mod._cur)
                            txt += ' '
                        }
                        txt += 'I/O @' + select._selection._path.replaceAll('/', ' ')
                        return txt
                    },
                },
                _prop_:{
                    onclick: function(_){
                        select.action_('view_io_')
                    },
                }
            },
        },
        io_table_: { // _ suffix cause remake each time view..display(.)
            _generate_name: 'table_io',
            _generate_options: {_brief: 0},
        },
        io: {
            _generate_name: 'div',
            _generate_options: {
                _className: 'io',
                _children_dsp: ['io_tag_', 'io_label_', 'io_table_'],
            }
        },
        div_:{ _generate:'div'},
        prompt: { 
            _generate_name: 'div',
            _generate_options: {
                _className: 'prompt',
                _prop_: {
                    innerText: 'hello',
                    onclick: function(_){
                        // wip resize/overflow-page-scroll

                        view.display('brand').click()
                    },
                }
            }
        },
        log: { 
            _generate_name: 'div',
            _generate_options: {
                _className: 'log collapse hidden',
                _children_dsp: ['log_items'],
                _prop_:{innerText: 'LOG'},
            }
        },
        log_items: { 
            _generate_name: 'div',
            _generate_options: {
                _className: 'log_items'
            }
        },
        prompt_mmenu_log: { 
            // remake allows new current page_mmenu to replace
            _generate_name: 'div',
            _generate_options: {
                _className: 'prompt_mmenu_log',
                _children_dsp: ['prompt', 'mmenu_', 'log']
            }
        },
        mmenu_: { 
            // remake allows new current page_mmenu to replace
            _generate_name: 'div',
            _generate_options: {
                _className: 'mmenu',
                _children_dsp: ['site_mmenu', 'page_mmenu']
            }
        },
        site_mmenu: { 
            _generate_name: 'div',
            _generate_options: {
                _className: 'site_mmenu',
                _children_gen_opts: [
                    {gen:'div', opts:{_className: 'btn on dim', _prop_: {innerText: 'log', onclick:function(evt){
                        if (evt && evt.stopPropagation)evt.stopPropagation();

                        let dsp = view.display('log')
                        if (!dsp) return select._log.error_('expected "log" display')

                        if (__action.toggle_hide_force_(dsp, true)){
                            // hidden so accentuate this
                            this.classList.add('on')
                        }else{
                            // visible so dim this
                            this.classList.remove('on')
                        }
                }}}}],
            },
        },
        page_mmenu: { 
            _generate_name: 'div',
            _generate_options: {
                _className: 'tool page_mmenu',
            },
        },        
        brand: {
            _generate_name: 'div',
            _generate_options: {
                _className: 'brand',
                _prop_: {
                    innerText: 'My2',
                    onclick: function(){
                        // no flare
                        let d = __sel._display_.mmenu_._value
                        if (!d) return;

                        if (d.classList.contains('hidden')){
                            d.classList.remove('hidden')
                        }else{
                            d.classList.add('hidden')
                        }
                    }
                }
            }
        }
    },
    _view_: {
        head: 'prompt_mmenu_log',
        foot: 'io',
        main: 'div_',
        bodybrand: 'brand',
    },
}// __sel
__prop = __sel._prop_
__action = __sel._action_
}// if
})()
// end tool.js    
</script>
<script>
// tool/miniroll.js

// base functionality (@ v1.0) awaiting major: ent-storage  display-fg/animations  movement/interactions  input-interfaces/action/encounter/targets  npc-reaction-objectives/communication/region-communities  data  popups-settings-shortcuts-help-menus-final-look-code-cleanup
//  making this v0.3 with min-viable: structure/foundation/scheme  game-design/char-creation  wrel-coords/bg-block-generation
(function(){
// ... settings
const LOG_LOCALE_DRAW_ITEM = false
const LOG_STATE_CHANGE = false
const LOG_SELECT_LOCALE_TILE = false


const UNIQUE_ROAD_PROB = 0.03;// 3/100 roads have unique. ~100 in a region. 6 total uniques. 50% expected on a road. 
const UNIQUE_OWNER_Q_PROP = 1; // when world-default-region npc-letter is given
const UNIQUE_OWNER_T_PROP = 0.3;
const UNIQUE_OWNER_C_PROP = 0.3;
const UNIQUE_OWNER_U_PROP = 0.3;
const UNIQUE_OWNER_R_PROP = 0.3;
const UNIQUE_OWNER_K_PROP = 0.3;
const UNIQUE_NONROAD_PROB = 0.01 // spread of remaining regional uniques.
const ROAD_OWNER_PROB = 0.08;// ~1/12 roads owned randomly
const NONROAD_OWNER_PROB = 0.2


// fixed
const MX_WORLD_X = 59
const MX_WORLD_Y = 29
const SZ_WORLD_X = 60
const SZ_WORLD_Y = 30
const MX_REGION_ENVIRON = 8
const SZ_REGION_ENVIRON = 9
const MX_LOCALE_X = 99
const MX_LOCALE_Y = 9
const SZ_LOCALE_X = 100
const SZ_LOCALE_Y = 10

const ALPHA_UC = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'


// best view depth: ctrl-k ctrl-6
var __path = '/tool/miniroll'
var __sel, __prop, __action
if (!select._selection_[__path]){// load once (unless unset) on load path. else & after read multiple.
__sel = select._selection = select._selection_[__path] = {
    _path: __path,
    _mod: {_cur:0,_max:1},
    _state: null,
    _state_:{
        // can add _action_ or other selection-/selecting- like props

        // reserved
        // onblur(next) onfocus(last)[once] onrefreshfirst()[each] -refresh-state-displays- onrefreshlast()[each]
        creation: {
            _action_: {test: function(){console.log('state test')}},
            onfocus: function(){
                __prop._wrel_ = new Map()
                __action._init_world()

                __prop._inspect_sz = view.MAX
                document.all.inspect_help.click()
            },
            onblur: function(next){
            },
        },
        debug: {
            onfocus: function(){
                view.prompt('Debug Mode')
            },
        },
        world: {
            onfocus: function(last){
                view.prompt('world view')
                __prop._inspect_sz = view.MIN
                __prop._party_info_sz = view.MIN
            }
        },
        region: {
            onfocus: function(last){
                view.prompt('region view')
                __prop._inspect_sz = view.MIN
                __prop._party_info_sz = view.MIN
            }
        },
        environ: {
            onfocus: function(last){
                view.prompt('environ view')
                __prop._inspect_sz = view.MIN
                __prop._party_info_sz = view.MIN
            }
        },
        locale: {
            onfocus: function(last){
                view.prompt('locale view')
                __prop._inspect_sz = view.MIN
                __prop._targets_sz = view.LESS
                __prop._encounter_info_sz = view.LESS
                __prop._party_info_sz = view.LESS

            },
        },
    },
    _prop_: {
        _debug: {},
        _stats: ['str', 'con', 'dex', 'cha', 'int', 'wis'],
        _eq_slots: ['w', 'w2', 't', 'r', 'a', 'o', 'b', 'h', 'f', 'g', 'j', 'j2', 'n'],
        _eq_oh_slots: ['w2', 't', 'r', 'o'],

        _creation: {
            _ent: null,
            _stat_base: 0,    
            _stat_roll: [6],
            _stat_reroll: [6],//[1,5][1,4][2,3]
            _stat_rolls: 3,
            _stat_max: 18, // to-max-msg to-block-reroll
            _stat_rerolls: 12,
            // 18+12 = 30 d6 rolled == ave ~5 6s

            _party_size: 3, 
            _ix: 0, 
        },
        _max_hp_roll: 8,

        _state_displays_: {
            _before: [
                    ],
            _after: ['status_',  // intended simple message/info or warn-error. auto-disappear. fogotten.
                    'inspect_',  // intended resizeable html. inspect(type, data) any time. reload recent.
                    'results_',
                    'party_'// sized with action_. separate to allow expand-collapse-info while scrolling actions
                    ],
            creation: ['creation_', 'creation_top_'],

            // name=> targets not only in encounter.
            locale: [
                'locale_',  // load/default 2d-map either down-view or side-view or side-view-pov
                'locale_top_',
                'coord_label_',  
                'block_menu_',  
                'encounter_', 
                'action_',    // load/default available actions and inputs
                'targets_'  // all in region by entity, interactables, containers, piles
                ],
            environ: [
                'environ_top_',
                'environ_',  
                'coord_label_',
                'block_menu_'
                ],
            region: [
                'region_top_',
                'region_',  
                'coord_label_',
                'block_menu_' 
                ],
            world: [ 
                'world_',
                'world_top_',
                'block_menu_' 
                ],
            debug: [ 
                // 'debug_'
                ],
            portal: [
                // 'portal_'
                ],
            interact: [
                // 'interact_'
                ],
        },

        _help_inspect: null, // html inited-once in creation_
        _inspect: null, 
        _inspect_as_html: null, 
        _last_inspect: null, 
        _last_inspect_as_html: null, 
        _last_last_inspect: null, 
        _last_last_inspect_as_html: null, 
        _status_txt: null,
        _status_txt: null,
        _last_status_txt: null,
        _last_status_type: null,

        _world_dsp: null,
        _region_dsp: null,
        _environ_dsp: null,
        _locale_dsp: null,
        _locale_data: null,
        _ground_info: null,

        _viewing_bg: true, 
        _viewing_block_gap: 2,
        _viewing_block_sz: 14,
        _viewing_cycle: 4, // cycles

        // _viewing_world: 1, // cycles
        // _viewing_region: 1, // cycles
        // _viewing_environ: 1, // cycles
        // _viewing_locale: 1, // cycles

        _targets_sz: 0,
        _environ_sz: 0,
        _inspect_sz: 2, 
        _party_info_sz: 0,
        _encounter_info_sz: -1,

        _wrel_: null, // Map dynamic game data. {coords: Region or Environ or Locale or Block} 
        _wrel: null, // current coord/lookup

        _results: [],

        // helper game data
        _party: [],
        _encounter: [],

        _prompts: {
            gm: {
                intro: ['GM:  pick your 3 champions!', 'GM:  Send me some champions. My monster mills needs manning.', 'GM: hello. would. you like. to play. a game?', 'GM: Pick your \'heroes\' or whatever ..'],
                create_WAR: ['Here is a little something extra. You look like you need it.', 'You are NO match for my minions.', 'But I will call you Ugg, `cause you are ugglyyy!', 'Smash. Butterfly. Snap. Now eat your gruel.', 'There was a time when I would be excited to greet you... but why try any more...', 'The Head of meat.', 'Pound for pound, you are one sweet hound.', 'You are a genetic dead end.', 'I wondered when you would show up. Ok, I\'m over it.', 'I just dropped loads of loot for you. It\'s somewhere somewhere around the corner.', 'You handle hopelessness well.', 'You have a healthy appetite for danger.', 'If I had a child, I would name them dumb-name-here instead of you.'],
                create_ROG: ['Here is a little something extra. You look like you need it.', 'Slick as an otter, you are.', 'How many shadows must a rogue walk down, before you call him a man?', 'Do me a favor, backstab yourself.', 'Grovel, puny emo.', 'You are like James Bond ... the Timothy Dalton one.', 'Put down the scissors, leather man.', 'Warmest regards, blood sac.', 'You have been plucked from the sea of bits. You\'re welcome...', 'Those stats don\'t do your gullability justice.', 'What marsh did you slither out of?', 'What do you and a toad have in common? ...just wondering', 'Where\'s your raccoon mask, lightfoot?', 'I will crit your tippy toes off, little darling.'],
                create_MND: ['Here is a little something extra. You look like you need it.', 'Try thinking your way out of your inevitable papercut-demise.', 'For you, I forsee red ... pouring from you.', 'Do you have enough charges ... or will you be like a porcupine without a quill?', 'Good morning, evening, whatever you prefer. Enjoy these last pleasantries.', 'Shame on you and yer witchy ways, you wayward warlock.', 'I see a lot of mouth to mouth in your future, the cpr kind.', 'Those are some fancy sandals you got there.', 'You may get your revenge, nerd. Probably not though.', 'Good news. THis dodgeball game has magic.', 'Where\'s the beef!? I just see gristle.', 'The earth shook when you arrived, but they made the stars no longer align.'],
                levelup_suffix: ['.', '.', '.','.','.','.','.','.','.','.','.','.','.', '.. well look at you.'],
            },
        },
        _stat_lvl_effects_: {
            str: {
                _sv_resilience: {
                    __8: -2,
                    __10: -1,
                    _16: 1,
                    _17: 1,
                    _18: 2,
                    _19: 2
                },
                _m_acc: {
                    __8: 1,
                    _17: -1,
                    _18: -2,
                    _19: -3
                },
                _m_dmg: {
                    __8: -1,
                    _16: 1,
                    _17: 1,
                    _18: 2,
                    _19: 3
                },
                _acc_2h1: {
                    _15: 1,
                    _16: 2,
                    _17: 3,
                    _18: 4,
                    _19: 4
                },
                _acc_w2: {
                    _14: 1,
                    _15: 1,
                    _16: 2,
                    _17: 2,
                    _18: 3,
                    _19: 3
                },
                max_1h_wt: {
                    __8: 5,
                    __14: 10,
                    _15: 15,
                    _16: 15,
                    _17: 20,
                    _18: 25,
                    _19: 30,
                },
                max_b_wt: {
                    __8: 10,
                    _8: 10,
                    __10: 10,
                    _10: 25,
                    __14: 35,
                    _14: 45,
                    _15: 55,
                    _16: 65,
                    _17: 75,
                    _18: 85,
                    _19: 95,
                },
                skill_: {
                    _10: 'enrage',
                    _14: 'shout',
                    _16: 'protect',
                    _18: 'slam',
                },
                ability_: {
                    _8: 'open',
                    _14: 'smith',
                    _17: 'intimidate',
                },
            },
            con: {
                _sv_resilience: {
                    __8: -4,
                    _14: 1,
                    _15: 1,
                    _16: 2,
                    _17: 2,
                    _18: 3,
                    _19: 3,
                },
                _carry_wt: {
                    _14: 50,
                    _15: 60,
                    _16: 70,
                    _17: 80,
                    _18: 100,
                    _19: 120,
                },
                _hp_onlvl: {
                    _15: 1,
                    _16: 2,
                    _17: 3,
                    _18: 4,
                    _19: 5
                },
                _onday_heal_roll: {
                    __8: -1,
                    _17: 1,
                    _18: 2,
                    _19: 4,
                },
                _onday_unc_heal_roll: {
                    _18: 1,
                    _19: 2,
                },
                _sv_fever: {
                    _18: 1,
                    _19: 3,
                },
                skill_: {
                    _14: 'charge',
                    _16: 'deepbreath',
                    _18: 'resist',
                },
                ability_: {
                    _8: 'walk',
                    _12: 'relax',
                    _15: 'rush',
                },
            },
            dex: {
                _eva: {
                    _15: 1,
                    _16: 2,
                    _17: 3,
                    _18: 4,
                    _19: 5
                },
                _r_acc: {
                    __8: -2,
                    _16: 1,
                    _17: 2,
                    _18: 2,
                    _19: 3
                },
                _acc_2h1: {
                    _17: 1,
                    _18: 2,
                    _19: 2
                },
                _acc_w2: {
                    _10: 2,
                    _11: 2,
                    _12: 2, // 10-40 = -30% acc  ok-rng 10-13
                    _13: 2,
                    _14: 3,
                    _15: 3,
                    _16: 3,
                    _17: 4,
                    _18: 4,
                    _19: 5, // 25-40 == -15% acc max
                },
                _carry_wt:{
                    _14: 30,
                    _15: 35,
                    _16: 40,
                    _17: 50,
                    _18: 60,
                    _19: 75,
                },
                _sv_reflex: {
                    __8: -4,
                    _14: 1,
                    _15: 1,
                    _16: 2,
                    _17: 2,
                    _18: 3,
                    _19: 3
                },
                skill_: {
                    _14: 'backstab',
                    _16: 'trip',
                    _18: 'expose',
                },
                ability_: {
                    _8: 'meal',
                    _10: 'search',
                    _12: 'sneak',
                    _14: 'craft',
                    _16: 'unlock',
                },
            },
            cha: {
                _sv_reflex: {
                    __8: -1,
                    _16: 1,
                    _17: 1,
                    _18: 2,
                    _19: 2
                },                  
                favor: {
                    __7: -2,
                    _7: -1,
                    _13: 1,
                    _14: 2,
                    _15: 3,
                    _16: 4,
                    _17: 5,
                    _18: 6,
                    _19: 7
                },
                skill_: {
                    _14: 'rally',
                    _16: 'distract',
                    _19: 'gaze', // stupify
                },
                ability_: {
                    _8: 'rumor',
                    _12: 'notice',
                    _14: 'entertain',
                    _16: 'persuade',
                },
                spell_: {
                    _14: 'exploit',
                    _16: 'conjure',
                    _18: 'charm',
                },
            },
            int: {
                _s_dmg: {
                    _17: 1,
                    _18: 1,
                    _19: 2,
                },
                _s_charges: {
                    _14: 1,
                    _15: 2,
                    _16: 3,
                    _17: 4,
                    _18: 5,
                    _19: 5
                },
                _sv_fortitude: {
                    __8: -2,
                    _16: 1,
                    _17: 1,
                    _18: 2,
                    _19: 2
                },
                spell_: {
                    _14: 'bolt',
                    _16: 'confuse',
                    _18: 'poison',
                },
                skill_: {
                    _10: 'await',
                    _14: 'assess',
                },
                ability_: {
                    _8: 'rest',
                    _12: 'steal',
                    _14: 'brew',
                    _16: 'learn',
                    _18: 'trick',
                },
            },
            wis: {
                _s_charges: {
                    _14: 1,
                    _15: 1,
                    _16: 2,
                    _17: 2,
                    _18: 2,
                    _19: 3
                },
                _s_acc: {
                    _18: 1,
                    _19: 1
                },
                _sv_fortitude: {
                    __8: -4,
                    _14: 1,
                    _15: 1,
                    _16: 2,
                    _17: 2,
                    _18: 3,
                    _19: 3
                },
                spell_: {
                    _14: 'inspire',
                    _16: 'heal',
                    _18: 'bless',
                    _19: 'storm'
                },
                skill_: {
                    _8: 'flee',
                    _10: 'inspect',
                    _14: 'trap',
                    _16: 'revive', // heal upto x ~10
                },
                ability_:{
                    _8: 'wait',
                    _12: 'forage',
                    _14: 'mend',
                    _17: 'nurse', // 1d6 mean is 3.5 . if mean==1, then ( -2.5 + roll(6) )
                },
            },
        },
        _effect_labels_: {
            // == {b:brief, d:desciptive, }
            skill_: {_: 'Skill'}, 
            ability_: {_: 'Ability'}, 
            spell_: {_: "Spell"},
            _sv_resilience: {_: 'resilience', __: 'health resilience (5%)'},
            _m_acc: {_: 'melee-acc', __: 'melee acc (x5%)'}, 
            _m_dmg: {_: 'melee dmg'},
            max_b_wt: {_:'max armor wt'}, 
            max_1h_wt: {_:'max 1h weapon wt'}, 
            _acc_2h1: {_:"acc 2h with 1", __:"acc (x5%) for 2h wep in 1-hand. -30% base penalty"}, 
            _acc_w2: {_:"acc dual-wield", __:'acc (x5%) for dual-wield off-hand. -40% base penalty'},
            _hp_onlvl: {_:"hp lvl-up bonus (10 uses)"}, 
            _onday_heal_roll: {_: "bonus sleep heal", __:"bonus max sleep heal (4 base)"}, 
            _onday_unc_heal_roll: {_:'bonus unconcious heal', __:"bonus max unc sleep heal (1 base)"}, 
            _sv_fever: {_:"poison save bonus"}, 
            _carry_wt: {_:"carry wt (lbs) bonus"},
            _eva: {_:'evade (x5%)'}, 
            _r_acc: {_:'range acc (x5%)'}, 
            _sv_reflex: {_:'reflex bonus (x5%)'}, 
            favor: {_: 'favor bonus', __:"initial favor bonus"}, 
            _sv_fortitude: {_:'mental fortitude bonus (x5%)'},
            _s_dmg: {_:"spell dmg"}, 
            _s_charges: {_:"spell charges"},
            _s_acc: {_:"spell acc (x5%)"},
        },
        _class_lvl_effects_: {
            WAR: [null,
                {xp:1000, acc: 1, hp:10},   
                {xp:1300, acc: 2, hp:10},   
                {xp:1700, acc: 3, hp:10},   
                {xp:2200, acc: 4, hp:10},   
                {xp:2800, acc: 5, hp:10},   
                {xp:3600, acc: 6, hp: 8},   
                {xp:4600, acc: 7, hp: 8},   
                {xp:6000, acc: 8, hp: 8},   
                {xp:7700, acc: 9, hp: 8},   
                {xp:10000,acc:10, hp: 8},   
                {xp:13000,acc:11, hp: 6},   
                {xp:17000,acc:12, hp: 6},   
                {xp:22000,acc:13, hp: 6},   
                {xp:28000,acc:14, hp: 6},   
                {xp:36000,acc:15, hp: 6},   
                {xp:46000,acc:16, hp: 4},   
                {xp:60000,acc:17, hp: 4},   
                {xp:77000,acc:18, hp: 4},   
                {xp:100000,acc:19, hp: 4},  
                {xp:0,    acc:20, hp: 4},   
                ],
            ROG: [null,
                {xp:1000, acc: 0, hp: 6},   
                {xp:1300, acc: 1, hp: 6},   
                {xp:1700, acc: 1, hp: 6},   
                {xp:2200, acc: 2, hp: 6},   
                {xp:2800, acc: 2, hp: 6},   
                {xp:3600, acc: 3, hp: 5},   
                {xp:4600, acc: 3, hp: 5},   
                {xp:6000, acc: 4, hp: 5},   
                {xp:7700, acc: 4, hp: 5},   
                {xp:10000,acc: 5, hp: 5},   
                {xp:13000,acc: 6, hp: 4},   
                {xp:17000,acc: 7, hp: 4},   
                {xp:22000,acc: 8, hp: 4},   
                {xp:28000,acc: 9, hp: 4},   
                {xp:36000,acc:10, hp: 4},   
                {xp:46000,acc:11, hp: 3},   
                {xp:60000,acc:12, hp: 3},   
                {xp:77000,acc:13, hp: 3},   
                {xp:100000,acc:14,hp: 3},   
                {xp:0,    acc:15, hp: 3},   
                ],
            WAR: [null,
                {xp:1000, acc: 0, hp: 6},   
                {xp:1300, acc: 0, hp: 6},   
                {xp:1700, acc: 1, hp: 6},   
                {xp:2200, acc: 1, hp: 6},   
                {xp:2800, acc: 1, hp: 6},   
                {xp:3600, acc: 2, hp: 4},   
                {xp:4600, acc: 2, hp: 4},   
                {xp:6000, acc: 2, hp: 4},   
                {xp:7700, acc: 3, hp: 4},   
                {xp:10000,acc: 3, hp: 4},   
                {xp:13000,acc: 4, hp: 3},   
                {xp:17000,acc: 4, hp: 3},   
                {xp:22000,acc: 5, hp: 3},   
                {xp:28000,acc: 5, hp: 3},   
                {xp:36000,acc: 6, hp: 3},   
                {xp:46000,acc: 6, hp: 2},   
                {xp:60000,acc: 7, hp: 2},   
                {xp:77000,acc: 8, hp: 2},   
                {xp:100000,acc:9,hp: 2},    
                {xp:0,    acc:10, hp: 2},   
                ],
        },

        _gen_bg_: {
            // [ sp16, sp12, sp8, sp4,  cl25, cl13, cl5,  ln20, ln14, ln9]
            f: [ 'w', 'm', 'm', 'g',    'w',  'm',  'g',  'm',  'w', 'w'],
            s: [ 'j', 'w', 'w', 'w',    'm',  'm',  'w',  'w',  'w', 'w'],// swamp-mtn/hill is desolate-foggy-open-flat
            j: [ 'm', 'm', 'w', 's',    'w',  'm',  's',  'm',  'w', 'w'],
            g: [ 'f', 'm', null, null,  'f',  'm',  'w',  'w',  'w', 'w'],
            m: [ 'c', 'f', 'i', 'g',    'w',  'i',  'f',  'w',  null, 'f'],
            c: [ 'i', 'm', 'm', null,   'i',  'm',  'f',  'i',  'w', 'f'],
            w: [ null, null,'m', null,  'f',  'f',  'f',  null, null, null],
            d: [ null, null,'m', null,  null, 'g',  'w',  null, 'w', null],
            i: [ 'c', 'm', 'f', 'w',    'w',  'm',  'f',  'f',  'w', 'm'],
        },
        _block_rule_: {
            road_bias: {
                c: 1,
                w: 3,
                i: 5,
                d: 9,
                s: 11,
                j: 13,
                m: 15,
                g: 19, //17,
                f: 21, //15,
            },
            map: {
                // pending letter del-c c-to-m m-to-h new-h
                c: {cl: 'mtn'},
                C: {cl: 'mtn road'},
                d: {cl: 'desert'},
                D: {cl: 'desert road'},
                m: {cl: 'hill'},
                M: {cl: 'hill road'},
                s: {cl: 'swamp'},
                S: {cl: 'swamp road'},
                j: {cl: 'jungle'},
                J: {cl: 'jungle road'},
                f: {cl: 'forest'},
                F: {cl: 'forest road'},
                w: {cl: 'water'},
                W: {cl: 'water road'},
                g: {cl: 'grass'},
                G: {cl: 'grass road'},
                i: {cl: 'ice'},
                I: {cl: 'ice road'},
            },
            locale: {
                fg: {},
                mg: {},
                bg: {
                    // upper-case are semi-solid.
                    'A': {cl: 'air', // darker-clouds
                        mv:{_:1}, // transparent
                        dur:null, 
                        use:['conduct', 'seed', 'energize', 'blow', 'evap'],
                        args:['fill_a', 'fill_w', 'fill_e'],}, 
                    'a': {cl: 'bg_air', // lighter-clouds
                        mv:{_:1},
                        dur:null, 
                        use:['conduct', 'seed', 'energize', 'blow', 'evap'],
                        args:['fill_a', 'fill_w', 'fill_e'],}, 
                    'B': {cl: 'block',      
                        mv:{_:0, climb:0.5}, // solid. climb/boulder 2x cost
                        dur:{hp:99, loot:'block', to:'b',
                            res:{s:1.0,m:1.0,e:0.5,v:0.2,f:1.0,h:0.8,c:0.9,d:1.0}}, // stone resistance
                        use:['break', 'climb', 'mine'], 
                        args: ['dur', 'type']},   
                    'b': {cl: 'bg_block',
                        mv:{_:1, }, 
                        dur:null, use:['build']},
                    'C': {cl: 'rg_chest',// static unique per region
                        mv:{_:0.5, }, // semi-solid
                        dur: {hp: 50, loot: null, to:null, // 0-dur == args-reset and unclaimable-until-repair
                            res:{p:0.9,b:0.9,s:0.9,m:0.9,e:0.9,v:0.9,f:0.9,h:0.9,c:0.9,d:0.9},}, // raid resistance
                        use:['claim', 'break', 'repair', 'unclaim', 'access', 'exchange'], 
                        inv_wt:2000,
                        args: ['owner', 'access', 'dur', 'inv', 'wt', 'rgn']},// rgn resource reserve/min, at, demand/max. 2-npc-objective-priorities: at<min or at<max
                    'c': {cl: 'chest', // constructs are carryable(1h) or haulable(2h). c, k,
                        mv:{_:1, }, 
                        dur:{hp:60, loot:'chest', to:null, // to-arg-tile
                            res:{p:0.5,b:0.5,s:0.5,m:1.0,e:0.8,v:0.5,f:1.0,h:0.5,c:1.0,d:1.0},}, // chest
                        use:['break', 'carry', 'haul', 'repair', 'transfer', 'access', 'trade'], 
                        inv_wt:200,
                        args:['tile', 'owner', 'access', 'dur', 'inv', 'wt']},
                    'D': {cl: 'l_door',     
                        mv:{_:0, }, dur:null, // solid
                        use:['unlock', 'bash'], // bash effectiveness based on key-min-difficulty
                        arg: 'key'}, // key-arg-req/lock generated (based on door location)
                    'd': {cl: 'ul_door',
                        mv:{_:1, }, 
                        dur:null, 
                        use:['lock'], args: ['key']},
                    'E': {cl: 'earth',      
                        mv:{_:0, climb:1}, // solid. climb/boulder normal cost
                        dur:{hp:60, loot:'earth', to:'e',
                            res:{p:0.5,b:0.5,s:1.0,m:1.0,e:0.0,v:0.8,f:1.0,h:1.0,c:1.0,d:1.0}}, // dirt resistance
                        use:['break', 'dig', 'mine'], 
                        args:['dur', 'type']},
                    'e': {cl: 'bg_earth',
                        mv:{_:1, }, 
                        dur:null, use:['build']},
                    'F': {cl: 'floral',   
                        mv:{_:0.5, }, // semi-solid 
                        dur:{hp:5, loot:'floral', to:'f',
                            res:{p:0.7,b:1.0,s:0.0,m:1.0,e:0.5,v:0.5,f:0.5,h:0.5,c:0.5,d:0.0}}, // plant resistance
                        use:['break', 'forage'], 
                        args:['dur','type']},
                    'f': {cl: 'bg_floral',  
                        mv:{_:1, }, dur:null, 
                        use:['build', 'grow'], args: ['time']},
                    'G': {cl: 'greenery',   
                        mv:{_:0.5, }, // semi-solid 
                        dur:{hp:10, loot:'greenery', to:'g',
                            res:{p:0.7,b:1.0,s:0.0,m:1.0,e:0.5,v:0.5,f:0.5,h:0.5,c:0.5,d:0.0}}, // plant resistance
                        use:['break', 'forage'], args:['dur','type']},
                    'g': {cl: 'bg_green',
                        mv:{_:1, }, dur:null, 
                        use:['build', 'grow'], args: ['time']},
                    'H': {cl: 'terminal', // state-machine. can be equivalent to logic-gates
                        mv:{_:0.5, }, // semi-solid
                        dur:{hp:20, loot:'terminal', to:null,
                            res:{p:0.7,b:0.9,s:0.0,m:1.0,e:1.0,v:0.5,f:1.0,h:0.6,c:1.0,d:1.0},},
                        use:['break', 'repair', 'deconstruct', 'input', 'states'], // review-edit-states. input-state-command
                        args: ['tile', 'dur', 'in', 'out', 'states', 'state']},// input-logic, output-direction, states-rules, current-state
                    'h': {cl: 'chair',
                        mv:{_:1, }, // cannot stand on chair/bed neener neener
                        dur:{hp:10, loot:'chair', to:null, // broken chair sometimes makes all-raw-materials but still needs time and tool/s to re-construct
                            res:{p:0.8,b:0.0,s:0.6,m:1.0,e:0.5,v:0.0,f:1.0,h:0.6,c:1.0,d:0.5}}, // chair resistance
                        use:['sit', 'lay', 'carry', 'break'],
                        args: ['tile', 'dur', 'type']}, 
                    'I': {cl: 'iceb',   
                        mv:{_:0, boulder:0.5}, // solid. boulder 2x cost
                        dur:{hp:80, loot:'ice', to:'i',
                            res:{p:0.5,b:0.8,s:0.8,m:1.0,e:0.2,v:0.0,f:1.0,h:0.0,c:1.0,d:1.0}}, // ice resistance
                        use:['break', 'forage'], 
                        args:['dur', 'type']},
                    'i': {cl: 'bg_iceb',     
                        mv:{_:1, }, dur:null, 
                        use:['build'],},
                    'J': {cl: 'jem',
                        mv:{_:0.5, }, // semi-solid
                        dur: null, // 
                        use:['harvest', 'prospect'], // prospect peaks content? or rerolls?
                        args:['type', 'content']},
                    'j': {cl: 'bg_jungle', // aesthetic alt-green
                        mv:{_:1, }, dur: null,
                        use:['build', 'grow'], args: ['time']},
                    'K': {cl: 'rg_kraft',   // ~merchant. multi-services. claimable unique per region. grants access or fees. if the raw-material is money, is equivalent to a merchant.
                        mv:{_:0.5, }, // semi-solid 
                        dur: {hp: 50, loot: null, to:null, // 0-dur == args-reset and unclaimable-until-repair
                            res:{p:0.9,b:0.9,s:0.9,m:0.9,e:0.9,v:0.9,f:0.9,h:0.9,c:0.9,d:0.9},}, // raid resistance. 
                            // at 90% dmg resistance and 50 hp, 10+ dmg attacks hit for 1 dmg. 9- does 0 dmg. Still, 3 pc x 1 dmg/rnd . 50/3 is 17 rounds or 2 minutes. 6 minutes for 1 making progress every round. 50% hit, now 12 minutes. duration-action like run/jog/walk.
                        use:['claim', 'unclaim', 'break', 'repair', 'access', 'craft', 'auto'],
                        inv_wt: 2000,
                        args: ['region', 'owner', 'dur', 'inv', 'wt', 'recipes', 'wip']}, // wip is queue, notes, responses(low-resource).
                    'k': {cl: 'kraft', // personal craft/merchant
                        mv:{_:1, },
                        dur:{hp:60, loot:'kraft', to:null,
                            res:{p:0.5,b:0.5,s:0.5,m:1.0,e:0.8,v:0.5,f:1.0,h:0.5,c:1.0,d:1.0},}, // chest
                        use:['break', 'transfer', 'haul', 'deconstruct', 'repair', 'access', 'craft', 'auto'], 
                        inv_wt:200,
                        args:['owner', 'tile', 'dur', 'inv', 'wt']},
                    'L': {cl: 'logic',
                        mv:{_:0.5, }, // semi-solid
                        dur:{hp:20, loot:'logic', to:null,
                            res:{p:0.7,b:0.9,s:0.0,m:1.0,e:1.0,v:0.5,f:1.0,h:0.6,c:1.0,d:1.0},},
                        use:['break', 'repair', 'output', 'deconstruct', 'downgrade'], // set-output-logic+, set-output-direction, set-input-directions
                        args: ['tile', 'dur', 'ins', 'out', 'logic']},// input-directions, output-dir, logic
                    'l': {cl: 'bg_logic',
                        mv:{_:1, }, 
                        dur:{hp:20, loot:'bg_logic', to: null,
                            res:{p:0.7,b:0.9,s:0.0,m:1.0,e:1.0,v:0.5,f:1.0,h:0.6,c:1.0,d:1.0},},
                        use:['break', 'repair', 'deconstruct', 'upgrade'],
                        args:['tile', 'dur'],}, // all directions connected
                    'M': {cl: 'magma',
                        mv:{_:0.5, sink: -3, swim: 0.1, heat:4000}, // semi-solid. neg-sink is float onround. 
                        dur: null,
                        use:['fill', 'drink'], 
                        args: ['fill', 'solutes']}, 
                    'm': {cl: 'bg_magma',   
                        mv:{_:1, }, 
                        dur:null, 
                        use:['fill'], args: ['fill']}, 
                    'N': {cl: 'fence', // and conductive logic-gate
                        mv:{_:0, }, // solid
                        dur:{hp:20, loot:'fence', to:null,
                            res:{p:0.9,b:0.0,s:0.0,m:1.0,e:1.0,v:0.5,f:1.0,h:1.0,c:1.0,d:1.0},},
                        use:['break', 'repair', 'input', 'downgrade', 'deconstruct'], 
                        args: ['tile', 'dur']},
                    'n': {cl: 'bg_fence',
                        mv:{_:1, },
                        dur:{hp:20, loot:'bg_fence', to:null,
                            res:{p:0.9,b:0.0,s:0.0,m:1.0,e:1.0,v:0.5,f:1.0,h:1.0,c:1.0,d:1.0},},
                        use:['break', 'repair', 'upgrade', 'deconstruct'],
                        args:['tile', 'dur']},
                    'O': {cl: 'portal', // auto-made-to/from-on-edges or constructed-at-rare-bg-spots (saves locale. travel shortcut.)
                        mv:{_:-1, }, // vacuum
                        dur: null, // cannot delete, either auto- or manual- created
                        use:['port'], args: ['dest']}, 
                    'o': {cl: 'bg_portal',
                        mv:{_:1, }, dur:null, 
                        use:['construct_portal', 'set_destination'], 
                        args: ['dest']}, 
                    'P': {cl: 'platform',   
                        mv:{_:0.5,}, // semi-solid
                        dur:{hp:80, loot:'platform', to:null,
                            res:{p:0.7,b:0.9,s:0.0,m:1.0,e:1.0,v:0.5,f:1.0,h:0.6,c:1.0,d:1.0},},
                        use:['break', 'repair'], args: ['dur', 'tile']},
                    'p': {cl: 'power', // also mill/forge
                        mv:{_:1, }, 
                        dur:{hp:20, loot:'power', to:null,
                            res:{p:0.7,b:0.9,s:0.0,m:1.0,e:1.0,v:0.5,f:1.0,h:0.6,c:1.0,d:1.0},},
                        use:['break', 'repair', 'outputs', 'inputs', 'deconstruct', 'fuel'], // set-output-force set-output-directions -input-raw -input-fuel  -refuel -fuel-type
                        inv_wt: 200,
                        args: ['inv', 'tile', 'dur', 'inv', 'wt', 'fill', 'ins', 'outs', 'type', 'force']},// in-raw-or-fuel out-dirs force-type force-magnitude
                    'Q': {cl: 'rg_quorum',     
                        mv:{_:0.5, }, // semi-solid 
                        dur: {hp: 50, loot: null, to:null, // indestructable. but claim reset and unusable until repaired
                            res:{p:0.9,b:0.9,s:0.9,m:0.9,e:0.9,v:0.9,f:0.9,h:0.9,c:0.9,d:0.9},}, // raid resistance
                        // regional-repair is automatic, and only uses local resources, siege-like. but some regional actions share-banks. If set landscape objective, half resources come from Q, half from C/U. If not objective, half from T not Q. 
                        use:['claim', 'unclaim', 'break', 'repair', 'deconstruct', 'access', 'inv', 'vote', 'dictate', 'objectives', 'contract', 'exchange'], 
                        inv_wt: 2000, // owner sets access. region-capital-funds. possible misappropriation.
                        args: ['region', 'owner', 'access', 'dur', 'inv', 'wt', 'votes', 'objectives', 'contracts']}, // current and avail contracts (region-trading(resource,recipes) and bounty/quest-like)
                    'q': {cl: 'quest',  
                        mv:{_:1, }, 
                        dur: null,
                        use:['quest'], // start-quest. progress quest. pickup-quest-item.
                        args:['tile', 'quest']}, // quest-key-logic. tile if last-time-use
                    'R': {cl: 'rg_research', // recipes limited by chance bgs for R and K. 
                        mv:{_:0.5, }, // semi-solid 
                        dur: {hp: 50, loot: null, to:null, // indestructable. but claim reset and unusable until repaired
                            res:{p:0.9,b:0.9,s:0.9,m:0.9,e:0.9,v:0.9,f:0.9,h:0.9,c:0.9,d:0.9},}, // raid resistance
                        use:['claim', 'unclaim', 'break', 'repair', 'deconstruct', 'access', 'research', 'recipes', 'wip', 'exchange'], 
                        inv_wt: 2000,
                        args: ['region', 'owner', 'access', 'dur', 'inv', 'wt', 'recipes', 'bgs', 'wip']}, // bgs (wre-this determines possible recipes) Q may contract-buy research-recipe from-nearby-regions.
                    'r': {cl: 'research', // research recipe creation.
                        mv:{_:1, },
                        dur:{hp:60, loot:'research', to:null,
                            res:{p:0.5,b:0.5,s:0.5,m:1.0,e:0.8,v:0.5,f:1.0,h:0.5,c:1.0,d:1.0},}, // chest
                        use:['break', 'transfer', 'haul', 'deconstruct', 'repair', 'access', 'research', 'recipes', 'wip', 'exchange'], 
                        inv_wt :200,
                        args:['owner', 'tile', 'dur', 'inv', 'wt']},
                    'S': {cl: 'sand',       
                        mv:{_:0, climb: 0.2 }, 
                        dur:{hp:40, loot:'sand', to:'s'}, 
                        use:['dig', 'climb'], args: ['fill']},
                    's': {cl: 'bg_sand',
                        mv:{_:1, }, dur:null, 
                        use:['build', 'fill'], args: ['fill']},
                    'T': {cl: 'rg_toggle', 
                        mv:{_:0.5, }, // semi-solid 
                        dur: {hp: 50, loot: null, to:null, // indestructable. but claim reset and unusable until repaired
                            res:{p:0.9,b:0.9,s:0.9,m:0.9,e:0.9,v:0.9,f:0.9,h:0.9,c:0.9,d:0.9},}, // raid resistance
                        use:['claim', 'unclaim', 'break', 'repair', 'deconstruct', 'menu', 'wip', 'exchange'], 
                        inv_wt: 2000,
                        args: ['region', 'owner', 'access', 'dur', 'changes', 'wip', 'inv', 'wt']},
                    't': {cl: 'toggle', // constructed manual switch
                        mv:{_:1, },
                        dur:{hp:20, loot:'fence', to:null,
                            res:{p:0.9,b:0.0,s:0.0,m:1.0,e:1.0,v:0.5,f:1.0,h:1.0,c:1.0,d:1.0},},
                        use:['break', 'transfer', 'haul', 'deconstruct', 'repair', 'access', 'toggle', 'in'], // auto toggle by set in-dir (on-low-to-high) 
                        args:['owner', 'tile', 'dur', 'in']},
                    'U': {cl: 'rg_umbra',// static unique per region
                        mv:{_:0.5, }, // semi-solid
                        dur: {hp: 50, loot: null, to:null, // 0-dur == args-reset and unclaimable-until-repair
                            res:{p:0.9,b:0.9,s:0.9,m:0.9,e:0.9,v:0.9,f:0.9,h:0.9,c:0.9,d:0.9},}, // raid resistance
                        use:['claim', 'break', 'repair', 'unclaim', 'access', 'exchange'], 
                        inv_wt:2000, // holds different liquids. not one (for practical reasons)
                        args: ['owner', 'access', 'dur', 'inv', 'wt', 'rgn']},// rgn resource reserve/min, at, demand/max. 2-npc-objective-priorities: at<min or at<max
                    'u': {cl: 'umbra', // constructs are carryable(1h) or haulable(2h). c, k,
                        mv:{_:1, }, 
                        dur:{hp:60, loot:'chest', to:null, // to-arg-tile
                            res:{p:0.5,b:0.5,s:0.5,m:1.0,e:0.8,v:0.5,f:1.0,h:0.5,c:1.0,d:1.0},}, // chest
                        use:['break', 'carry', 'haul', 'repair', 'transfer', 'access', 'trade'], 
                        inv_wt:200, 
                        args:['tile', 'owner', 'access', 'dur', 'inv', 'wt']},
                    'V': {cl: 'vernal',     
                        mv:{_:0.5, }, // semi-solid 
                        dur:{hp:20, loot:'vernal', to:'v',
                            res:{p:0.7,b:1.0,s:0.0,m:1.0,e:0.5,v:0.5,f:0.5,h:0.5,c:0.5,d:0.0}}, // plant resistance
                        use:['break', 'forage'], args: ['dur', 'type']},
                    'v': {cl: 'bg_vernal',
                        mv:{_:1, }, dur:null, 
                        use:['build', 'grow'], args: ['time']},
                    'W': {cl: 'water',
                        mv:{_:0.5, sink: 1, swim: 0.25}, 
                        dur:null, 
                        use:['fill', 'drink'], 
                        args: ['fill', 'solutes']},  
                    'w': {cl: 'bg_water',
                        mv:{_:1, }, 
                        dur:null, 
                        use:['fill'], args: ['fill']},
                    'X': {cl: 'harm',
                        mv:{_:0.5, sink: 2, harm: 4}, // sink/fall through harm and get tangled/scraped/poked/poisoned/barbed/stung/bit/eaten/burned/harmed by it.
                        dur:{hp:15, loot:'harm', to:'x',// default vine-like. hp/res dependent on type.
                            res:{p:0.7,b:1.0,s:0.0,m:1.0,e:0.5,v:0.5,f:0.5,h:0.5,c:0.5,d:0.0}}, // plant resistance
                        use:['break', 'forage'], args: ['dur', 'type']},
                    'x': {cl: 'bg_harm',    
                        mv:{_:1, }, dur:null, 
                        use:['grow'], // cannot build over? 
                        args: ['retime']}, // auto-regrow and non-saving unlike time (F,G,V)
                    'Y': {cl: 'on_light',   
                        mv:{_:0}, 
                        dur:{hp:20, loot:'light', to:null,
                            res:{p:0.7,b:0.9,s:0.0,m:1.0,e:1.0,v:0.5,f:1.0,h:0.6,c:1.0,d:1.0},},
                        use:['break', 'repair', 'snuff', 'carry'], args: ['tile', 'type', 'fill']},
                    'y': {cl: 'off_light',  
                        mv:{_:1, }, 
                        dur:{hp:20, loot:'light', to:null,
                            res:{p:0.7,b:0.9,s:0.0,m:1.0,e:1.0,v:0.5,f:1.0,h:0.6,c:1.0,d:1.0},},
                        use:['break', 'repair', 'ignite', 'carry'], args: ['tile', 'type', 'fill']},
                    'Z': {cl: 'mover',        
                        mv:{_:0.5}, 
                        dur:{hp:60, loot:'mover', to:null,
                            res:{p:0.5,b:0.0,s:0.5,m:1.0,e:1.0,v:0.5,f:1.0,h:0.0,c:0.5,d:1.0},},
                        use:['break', 'sit', 'repair', 'transfer', 'deconstruct', 'access', 'trade'], 
                        inv_wt: 200,
                        args: ['tile', 'dur', 'owner', 'type', 'inv', 'wt']},
                    // mover example 2x3
                    // ZZZ // 5 passenger. each seat is storage and umbra? seat is store. pilot is umbra for fuel ? 
                    // ZzZ // pilot could be anywhere. also a seat.
                    // all must sit down to fit in 2-height. can eject or hurt passenger if stand?
                    'z': {cl: 'pilot',
                        mv:{_:0.5}, 
                        dur:{hp:60, loot:'pilot', to:null,
                            res:{p:0.5,b:0.0,s:0.5,m:1.0,e:1.0,v:0.5,f:1.0,h:0.0,c:0.5,d:1.0},},
                        use:['break', 'sit', 'repair', 'transfer', 'deconstruct', 'access', 'pilot', 'fuel', 'trade'],
                        inv_wt: 200, 
                        args: ['tile', 'dur', 'owner', 'fuel', 'inv', 'wt']},
                },
            },
        },

        
        _locale_tpl_: {
            // seems way too much space used. if iterate to consistent lettering, can convert a lot to parse phrase.

            // TODO refactor: add 10th bg and make air-strip completely separate 11th line.
            // 11-line allows 4 levels and can use 5+5 (and possible 2-lvl in each).
            // 2-lvl transition would benefit from 5w to reduce bad platforms 
            // _fhf1 = '11111' // fixed half-line full/mix/open/open-platform
            // _fhm1 = '26681'
            // _fhm2 = '66376'
            // _fhm3 = '10216'
            // _fho1 = '66666'
            // _fhop1 ='6P6P6'
            // _fhop2 ='P6P66'
            // _fhop3 ='6P66P'
            // _fhop4 ='P6PP6'

            // d-ouble (2-lines) q-quad l-linker(1..or rename s-ingle) a-air(1)  w-ipe(9:q+l+q)
            // as:: { p-ick i-tems c-ondition l-iteral
            //      [#, on-true, on-false] === { c:[] }  
            //      [...items] === { i:[] } 
            //      [item] ~ == { l:'' } 
            //  potentially add repeat(but didnt see enough gain bc 3 max): {r:[#N, ...repeat-each-N]} === [#, not-2-items(2=c)]
            // wip: more consistent. convert to parser

            // data
            _xe1: ['do','1116666611', // 3
                        '276P666P66', // 4
                        '7766P6P667', // 5
                        '6686616676', // 6
                        '6661111166', 'df_'],
            _xe2: ['_o','6P16677666',
                        'P661111PP6', // 3
                        '2667866662', // 4
                        '6P666666P7', // 5
                        '67P6622168', // 6
                        '6661211116', 'df_'],
            _xe3: ['do','1666666611', // 3
                        '9P66677P66', // 4
                        '66P666P766', // 5
                        '6862116676', // 6
                        '6611121216', 'df_'],
            _xe4: ['do','1666666611', // 3
                        '6P66666P66', // 4
                        '66P666P666', // 5
                        '6661116666', // 6
                        '6611241166', 'df_'],
            _xe5: ['do','1116666121', // 3
                        '266P6PP666', // 4
                        '6866166666', // 5
                        '6611511766', // 6
                        '6113221110', 'df_'],
            _x1:  ['do','1666667661', // 3
                        '6666606791', // 4
                        '6661618671', // 5
                        '6611666761', // 6
                        '1111666661', 'de_'],
            _x2:  ['do','1666666661', // 3
                        '1666116666', // 4
                        '1666666666', // 5
                        '6666666166', // 6
                        '6111661111', 'de_'],
            _x3:  ['do','1666666661', // 3
                        '6616661661', // 4
                        '6666666616', // 5
                        '6661666666', // 6
                        '1166661666', 'de_'],
            _x4:  ['do','1166666661', // 3
                        '6166666616', // 4
                        '6611166166', // 5
                        '6666661666', // 6
                        '1166666611', 'de_'],
            _x5:  ['do','1666666661', // 3
                        '6161666166', // 4
                        '6666616666', // 5
                        '1666666666', // 6
                        '1166666666', 'de_'],
            _wC1: ['do','1666666661', // 3
                        '6P666C66P6', // 4
                        '6611111166', // 5
                        '6P666666P6', // 6
                        'P66666666P', 'df_'],
            _wK1: ['do','1666666661', // 3
                        '6P666K66P6', // 4
                        '6611111166', // 5
                        '6P666666P6', // 6
                        'P66666666P', 'df_'],
            _wQ1: ['do','1666666661', // 3
                        '6P666Q66P6', // 4
                        '6611111166', // 5
                        '6P666666P6', // 6
                        'P66666666P', 'df_'],
            _wR1: ['do','1666666661', // 3
                        '6P666R66P6', // 4
                        '6611111166', // 5
                        '6P666666P6', // 6
                        'P66666666P', 'df_'],
            _wT1: ['do','1666666661', // 3
                        '6P666T66P6', // 4
                        '6611111166', // 5
                        '6P666666P6', // 6
                        'P66666666P', 'df_'],
            _wU1: ['do','1666666661', // 3
                        '6P666U66P6', // 4
                        '6611111166', // 5
                        '6P666666P6', // 6
                        'P66666666P', 'df_'],
            _wC2: ['do','10776C6661', // 3
                        '6P76211PP6', // 4
                        '6622221166', // 5
                        '6P677666P6', // 6
                        'P66677666P', 'df_'],
            _wK2: ['do','10776K6661', // 3
                        '6P76211PP6', // 4
                        '6622221166', // 5
                        '6P677666P6', // 6
                        'P66677666P', 'df_'],
            _wQ2: ['do','10776Q6661', // 3
                        '6P76211PP6', // 4
                        '6622221166', // 5
                        '6P677666P6', // 6
                        'P66677666P', 'df_'],
            _wR2: ['do','10776R6661', // 3
                        '6P76211PP6', // 4
                        '6622221166', // 5
                        '6P677666P6', // 6
                        'P66677666P', 'df_'],
            _wT2: ['do','10776T6661', // 3
                        '6P76211PP6', // 4
                        '6622221166', // 5
                        '6P677666P6', // 6
                        'P66677666P', 'df_'],
            _wU2: ['do','10776U6661', // 3
                        '6P76211PP6', // 4
                        '6622221166', // 5
                        '6P677666P6', // 6
                        'P66677666P', 'df_'],
            _wC3: ['_o','66k6Y6r666',
                        'PBBBBBPPBP', // 3
                        'PBbbbbPbBP', // 4
                        'PBbCbbbPBP', // 5
                        'PBBBBBPbBP', // 6
                        'PbgbfbgPbP',
                        'PhhhhhhPbP',
                        'BBBBBBBWBB'],
            _wK3: ['_o','66k6Y6r666',
                        'PBBBBBPPBP', // 3
                        'PBbbbbPbBP', // 4
                        'PBbKbbbPBP', // 5
                        'PBBBBBPbBP', // 6
                        'PbgbfbgPbP',
                        'PhhhhhhPbP',
                        'BBBBBBBWBB'],
            _wQ3: ['_o','66k6Y6r666',
                        'PBBBBBPPBP', // 3
                        'PBbbbbPbBP', // 4
                        'PBbQbbbPBP', // 5
                        'PBBBBBPbBP', // 6
                        'PbgbfbgPbP',
                        'PhhhhhhPbP',
                        'BBBBBBBWBB'],
            _wR3: ['_o','66k6Y6r666',
                        'PBBBBBPPBP', // 3
                        'PBbbbbPbBP', // 4
                        'PBbRbbbPBP', // 5
                        'PBBBBBPbBP', // 6
                        'PbgbfbgPbP',
                        'PhhhhhhPbP',
                        'BBBBBBBWBB'],
            _wT3: ['_o','66k6Y6r666',
                        'PBBBBBPPBP', // 3
                        'PBbbbbPbBP', // 4
                        'PBbTbbbPBP', // 5
                        'PBBBBBPbBP', // 6
                        'PbgbfbgPbP',
                        'PhhhhhhPbP',
                        'BBBBBBBWBB'],
            _wU3: ['_o','66k6Y6r666',
                        'PBBBBBPPBP', // 3
                        'PBbbbbPbBP', // 4
                        'PBbUbbbPBP', // 5
                        'PBBBBBPbBP', // 6
                        'PbgbfbgPbP',
                        'PhhhhhhPbP',
                        'BBBBBBBWBB'],


            // fixed: 10h mod10w
            _fe1a: ['_a','qoe_',
                    'J433J5J422', // l
                    'do_', '_m',
                    '111J3222J1'],
            _fe1b: ['_a', // range
                    '600EB66666', 
                    '6990EB6666', 
                    '68890EB666', 
                    'P77890EB6P', 
                    'PP67890EBP', 
                    'P667890EBP', 
                    'P77890EB6P', 
                    'P889XX666P', 
                    'PXXX66666P'],
            _f1a: ['_fe1a'],

            _fe2a: ['_a', // grotto
                    '6667766667', 
                    '6BEBBEBBBE', 
                    'EEBXWVJXWW', 
                    'EGFWXWVFYX', 
                    'EFJGFJWGWW', 
                    '6BFGWFGXGW', 
                    '76BEBBBEBE', 
                    '6666776667', 
                    '1666776667', 
                                '_a',
                                '6667766667',
                                'EBBEPPPEE6',
                                'GGGGWWWBGE',
                                'WGGGGWWGBE',
                                'XGGGWWFJGB',
                                'XWGGWWWFEB',
                                'EBBWWBEB66',
                                '76bWwb6666',
                                '686bWwb661',
                                ],
            _f2a: ['_fe2a'],

            _fe3a: ['_a', 'qoe_', 'l_', 'qoe_',
                    '_a',
                    // WIP test all interactables
                    'JJBJGJWRJJ',
                    'WGJGJWJWRW',
                    '6PPPPPPPP6',
                    '1678766761',
                    '6P6rkcu6P6',
                    '66PPPPPP66',
                    '6PXJEJSJP6',
                    'EJ2JBIJSJ1',
                    'JEJBJBIWS6',
                    '_a', 'qoe_', 'l_', 'qoe_'],
            _f3a: ['_fe3a'],

            // inn
            _fe4a: {p:['_fe1a', '_fe2a', '_fe3a', ['_fe1a', '_fe2a'], ['_fe1a', '_fe3a'], ['_fe2a', '_fe3a'], ['_fe3a', '_fe2a', '_fe1a']]},
            _f4a: ['_fe4a'],

            _fe5a: ['_a', // fort
                    'wwwwwwwwww', 
                    'wwwwwwwwww', 
                    'wwwwwXBBBB', 
                    'PwwwwwXXXB', 
                    'PwwewwwwXB', 
                    'PwwwewwwwB', 
                    'PwwwwwwwwB', 
                    'P666667778', 
                    'EEE6666966', 
                        '_a',   'dbbbubbbbb',
                                'dbhbcbbPPB', 
                                'BBBBBBPbgY', 
                                'fggYggvPbf', 
                                'chhchhcvPb', 
                                'hhchhchhbP', 
                                'BBBBBBBBBB', 
                                '666bbbb776', 
                                '667bbbb666', 
                                    '_a',   'chbubhchhu',
                                            'BBPPPBBBBB', 
                                            'WBbXbBWDff', 
                                            'uWbbbWuDhh', 
                                            'PBXbXBPPPP', 
                                            'bBXbwBbccu', 
                                            'BBwbXBBBBB', 
                                            '6667776606', 
                                            '6ww7w67677', 
                                                '_a',   'hbbbkhbdbb',
                                                        'BhbbPPbdbb', 
                                                        'YBhhbgPBBB', 
                                                        'bgBBBPgbff', 
                                                        'bbDYbgPbff', 
                                                        'PbDrhPbkuc', 
                                                        'BBBBBBBBBB', 
                                                        '7666bbbbb6', 
                                                        '6667bbbbb6', 
                                                            '_a',   'bbbbbdwww6',
                                                                    'BBPPbdwwww', 
                                                                    'BbbtBBNNNw', 
                                                                    'EhhBlllX6P', 
                                                                    'BBBXXXX66P', 
                                                                    'BXXwww666P', 
                                                                    'Bwww66666P', 
                                                                    'ww6666776P', 
                                                                    '66677766EE'
                                ],
            _f5a: ['_fe5a'],

            _fe6a: ['_a',// maze
                    '6666666666', 
                    '6666666666', 
                    'PEEEEEPEEE', 
                    'P66616P666', 
                    'P66616P666', 
                    'PEEEEEEEEE', 
                    'P666666666', 
                    'P666666666', 
                    'PEEEEEEEEE', 
                        '_a',   '6626666666', 
                                '6626666666', 
                                'EEEEEEPEEE', 
                                '6666P66646', 
                                '6666P66646', 
                                'EEPEEEPEEE', 
                                '66P676P66F', 
                                '66P676P66F', 
                                'EEEEEEEEEE', 
                                    '_a',   '665666G666', 
                                            '665666G666', 
                                            'EPEEEEEEEE', 
                                            '6P666166V6', 
                                            '6P666166V6', 
                                            'EEEPEEEEEE', 
                                            '626P666G66', 
                                            '626P666G66', 
                                            'EEEEEEEEEE', 
                                                '_a',   '6656666666', 
                                                        '6656666666', 
                                                        'EEEEPEEEEE', 
                                                        '6666P66636', 
                                                        '6666P66636', 
                                                        'PEEEEEPEEE', 
                                                        'P646F6P666', 
                                                        'P646F6P666', 
                                                        'EEEEEEEEEE', 
                                                            '_a',   '66616666S6', 
                                                                    '66616666S6', 
                                                                    'PEEEEPEEEE', 
                                                                    'P6666P6626', 
                                                                    'P6666P6626', 
                                                                    'EEEEEEEEEE', 
                                                                    '66G6656666', 
                                                                    '66G6656666', 
                                                                    'EEEEEEEEEE', 
                                                                        '_a',   '6664666666', 
                                                                                '6664666666', 
                                                                                'EPEEEEEEEP', 
                                                                                '6P6666366P', 
                                                                                '6P6666366P', 
                                                                                'EEEEPEEEEP', 
                                                                                '6366P6666P', 
                                                                                '6366P6666P', 
                                                                                'EEEEEEEEEP'
                                ],
            _f6a: ['_fe6a'],

            //// x-crossing
            xe: {p:['_xe1','_xe2','_xe3', '_xe4', '_xe5']},
            x: {p:['_x1','_x2','_x3', '_x4', '_x5', '_xe1','_xe2','_xe3', '_xe4', '_xe5']},

            //// d-dual
            do: ['_o', '_o'],
            doc: ['_oc', '_oc'],
            docc: ['_occ', '_occ'],
            dod: ['_od', '_od'],
            dodd: ['_odd', '_odd'],
            docd: ['_oc', '_od'],
            doc_: {p:['doc', 'docc']},
            dod_: {p:['dod', 'dodd']},
            do_: {p:['doc_', 'doc_', 'do', 'docd']},

            de: ['_m', '_f'],
            dec: ['_mc', '_fc'],
            decc: ['_mcc', '_fcc'],
            ded: ['_md', '_fd'],
            dedd: ['_mdd', '_fdd'],
            decd: ['_mc', '_fd'],
            dec_: {p:['dec', 'decc']},
            ded_: {p:['ded', 'dedd']},
            de_: {p:['dec_', 'dec_', 'de', 'decd']},

            dm: ['_m', '_m'],
            dmc: ['_mc', '_mc'],
            dmcc: ['_mcc', '_mcc'],
            dmd: ['_md', '_md'],
            dmdd: ['_mdd', '_mdd'],
            dmcd: ['_mc', '_md'],
            dmc_: {p:['dmc', 'dmcc']},
            dmd_: {p:['dmd', 'dmdd']},
            dm_: {p:['dmc_', 'dmc_', 'dm', 'dmcd']},

            df: ['_f', '_f'],
            dfc: ['_fc', '_fc'],
            dfcc: ['_fcc', '_fc'], // some-flex-in-lower (c allows all 5 rel-bg. cc does not)
            dfd: ['_fd', '_fd'],
            dfdd: ['_fdd', '_fdd'],
            dfcd: ['_fc', '_fd'],
            dfc_: {p:['dfc', 'dfcc']},
            dfd_: {p:['dfd', 'dfdd']},
            df_: {p:['dfc_', 'dfd_', 'df', 'dfcd']},

            d_: {p:['do_', 'de_', 'dm_', 'df_']},

            //// l-linker
            l: {p:['_f', '_f', '_m']},
            lc: {p:['_fc', '_mc']},
            lcc: {p:['_fcc', '_mcc']},
            ld: {p:['_fd', '_md']},
            l_: {p:['l', 'lc', 'lcc', 'ld']},
            lc_: {p:['lc', 'lcc']},

            //// q-quad
            qoo: ['do_', 'do_'],
            qoe: ['do_', 'de_'],
            qom: ['do_', 'dm_'],
            qof: ['do_', 'df_'],
            qff: ['df_', 'df_'],
            qmf: ['dm_', 'df_'],
            qmm: ['dm_', 'dm_'],
            qooc: ['doc_', 'doc_'],
            qoec: ['doc_', 'dec_'],
            qoecc: ['docc', 'decc'],
            qoed: ['dod_', 'ded_'],
            qomc: ['doc_', 'dmc_'],
            qomcc: ['docc', 'dmcc'],
            qomd: ['dod_', 'dmd_'],
            qofc: ['doc_', 'dfc_'],
            qofcc: ['docc', 'dfcc'],
            qofd: ['dod_', 'dfd_'],
            qffc: ['dfc_', 'dfc_'],
            qffcc: ['dfcc', 'dfcc'],
            qffd: ['dfd_', 'dfd_'],
            qmfc: ['dmc_', 'dfc_'],
            qmfcc: ['dmcc', 'dfcc'],
            qmfd: ['dmd_', 'dfd_'],
            qmmc: ['dmc_', 'dmc_'],
            qmmcc: ['dmcc', 'dmcc'],
            qmmd: ['dmd_', 'dmd_'],

            qoo_: {p:['qoo', 'qooc']},
            qoe_: {p:['qoe','qoec', 'qoecc', 'qoed']},
            qom_: {p:['qom','qomc', 'qomcc', 'qomd']},
            qof_: {p:['qof','qofc', 'qofcc', 'qofd']},
            qff_: {p:['qff','qffc', 'qffcc', 'qffd']},
            qmf_: {p:['qmf','qmfc', 'qmfcc', 'qmfd']},
            qmm_: {p:['qmm','qmmc', 'qmmcc', 'qmmd']},

            qoc: {p:['qooc', 'qoec', 'qomc', 'qofc']},

            qmcc: {p:['qmfcc', 'qmmcc']},
            qmc: {p:['qmcc', 'qmfc', 'qmmc']},
            qm_: {p:['qmf_', 'qmm_']},
            
            qfcc: {p:['qffcc']},
            qfc: {p:['qffc', 'qffcc']},
            qf_: {p:['qff_']},

            qc_: {p:['qfc', 'qfc', 'qfc', 'qmc', 'qmc', 'qoc']},
            qo_: {p:['qoo_', 'qoe_', 'qom_', 'qof_']},
            q_: {p:['qo_', 'qf_', 'qm_', 'qoe_', 'qom_', 'qof_', 'qff_', 'qmf_', 'qmm_']},

            //// w-wipe (e=>oe o=>oo p=>o* [path/passable]
            weM: ['qoe_', '_M', '_M', '_M', '_M', '_M'],
            wpM: ['qo_', '_M', '_M', '_M', '_M', '_M'],
            wee: ['qoe_', 'l_', 'qoe_'],
            we_c: ['qoec', 'lc_', 'qc_'],
            we_: ['qoe_', 'l_', 'q_'],
            w_ec: ['qc_', 'lc_', 'qoec'],
            w_e: ['q_', 'l_', 'qoe_'],
            woe: ['qoo_', '_o', 'qoe_'],
            wop: ['qoo_', '_o', 'qo_'],
            wpp: ['qo_', 'l', 'qo_'],
            w_p: ['q_', 'l', 'qo_'],
            wp_: ['qo_', 'l', 'q_'],
            wcp: ['qc_', 'l', 'qo_'],
            wpc: ['qo_', 'l', 'qc_'],

            wC: {p:['_wC1', '_wC2', '_wC3' ]},
            wK: {p:['_wK1', '_wK2', '_wK3' ]},
            wQ: {p:['_wQ1', '_wQ2', '_wQ3' ]},
            wR: {p:['_wR1', '_wR2', '_wR3' ]},
            wT: {p:['_wT1', '_wT2', '_wT3' ]},
            wU: {p:['_wU1', '_wU2', '_wU3' ]},


            //// air-wipe-multi  p-path(qo_) vs e-easy-path(qoe_)  vs o-open(qoo_)
            af_wee: ['_af','wee'],
            af_wee_2: ['af_wee','af_wee'],
            af_wee_3: ['af_wee','af_wee','af_wee'],
            af_wpp: ['_af', 'wpp'],
            af_wpp_2: ['af_wpp','af_wpp'],
            af_wpp_3: ['af_wpp','af_wpp','af_wpp'],
            af_wec: ['_af', 'we_c'],
            af_wce: ['_af', 'w_ec'],
            af_w_e: ['_af', 'w_e'],
            af_we_: ['_af', 'we_'],
            af_woe: ['_af', 'woe'],
            af_wcp: ['_af', 'wcp'],
            af_wpc: ['_af', 'wpc'],
            af_w_p: ['_af', 'w_p'],
            af_wp_: ['_af', 'wp_'],
            af_wop: ['_af', 'wop'],

            ab_wee: ['_ab','wee'],
            ab_wee_2: ['ab_wee','ab_wee'],
            ab_wee_3: ['ab_wee','ab_wee','ab_wee'],
            ab_wpp: ['_ab', 'wpp'],
            ab_wpp_2: ['ab_wpp','ab_wpp'],
            ab_wpp_3: ['ab_wpp','ab_wpp','ab_wpp'],
            ab_wec: ['_ab', 'we_c'],
            ab_wce: ['_ab', 'w_ec'],
            ab_w_e: ['_ab', 'w_e'],
            ab_we_: ['_ab', 'we_'],
            ab_woe: ['_ab', 'woe'],
            ab_wcp: ['_ab', 'wcp'],
            ab_wpc: ['_ab', 'wpc'],
            ab_w_p: ['_ab', 'w_p'],
            ab_wp_: ['_ab', 'wp_'],
            ab_wop: ['_ab', 'wop'],

            a_wee: ['_a','wee'],
            a_wee_2: ['a_wee','a_wee',],
            a_wee_3: ['a_wee','a_wee','a_wee'],
            a_wpp: ['_a', 'wpp'],
            a_wpp_2: ['a_wpp','a_wpp'],
            a_wpp_3: ['a_wpp','a_wpp','a_wpp'],
            a_wec: ['_a', 'we_c'],
            a_wce: ['_a', 'w_ec'],
            a_w_e: ['_a', 'w_e'],
            a_we_: ['_a', 'we_'],
            a_woe: ['_a', 'woe'],
            a_wcp: ['_a', 'wcp'],
            a_wpc: ['_a', 'wpc'],
            a_w_p: ['_a', 'w_p'],
            a_wp_: ['_a', 'wp_'],
            a_wop: ['_a', 'wop'],

            // air-crossing
            af_xe: ['_af','xe'],
            ab_xe: ['_ab','xe'],
            a_xe: ['_a','xe'],
            af_x: ['_af', 'x'],
            ab_x: ['_ab','x'],
            a_x: ['_a','x'],

            // air-fixed ... no specific air. too messy.
            afe1: {p:['_fe1a', '_fe1b']},
            af1: {p:['_f1a']},
            af2: {p:['_f2a']},
            afe2: {p:['_fe2a']},
            af3: {p:['_f3a']},
            afe3: {p:['_fe3a']},
            af4: {p:['_f4a']},
            afe4: {p:['_fe4a']},
            af5: {p:['_f5a']},
            afe5: {p:['_fe5a']},
            af6: {p:['_f6a']},
            afe6: {p:['_fe6a']},
            af_: {p:['af1', 'af2', 'af3', 'af4', 'af5', 'af6']},
            afe_: {p:['afe1', 'afe2', 'afe3', 'afe4', 'afe5', 'afe6']},

            //// from ENTRANCES
            af_xf1: [ 'af_x', 'af1'],           
            af_xfe1: [ 'af_xe', 'afe1'],
            af_xf: [ 'af_x', 'af_'],
            af_xfe: [ 'af_xe', 'afe_'],
            ab_xf1: [ 'ab_x', 'af1'],           
            ab_xfe1: [ 'ab_xe', 'afe1'],
            ab_xf: [ 'ab_x', 'af_'],
            ab_xfe: [ 'ab_xe', 'afe_'],
            a_xf1: [ 'a_x', 'af1'],         
            a_xfe1: [ 'a_xe', 'afe1'],
            a_xf: [ 'a_x', 'af_'],
            a_xfe: [ 'a_xe', 'afe_'],

            af_xetc: ['af_xe', {p:['af_wec', 'af_wce']}],
            af_xetc_2: ['af_xe', 'af_wec', 'af_wec'],
            af_xetc_3: ['af_xe', 'af_wec', 'af_wec', 'af_wec'],
            ab_xetc: ['ab_xe', {p:['ab_wec', 'ab_wce']}],
            ab_xetc_2: ['ab_xe', 'ab_wec', 'ab_wec'],
            ab_xetc_3: ['ab_xe', 'ab_wec', 'ab_wec', 'ab_wec'],
            a_xetc:  ['a_xe',  {p:['a_wec', 'a_wce']}],
            a_xetc_2:  ['a_xe',  'a_wec', 'a_wec'],
            a_xetc_3:  ['a_xe',  'a_wec', 'a_wec', 'a_wec'],

            af_xtc: ['af_x', {p:['af_wpc', 'af_wcp']}],
            af_xtc_2: ['af_x', 'af_wpc', 'af_wpc'],
            af_xtc_3: ['af_x', 'af_wpc', 'af_wpc', 'af_wpc'],
            ab_xtc: ['ab_x', {p:['ab_wpc', 'ab_wcp']}],
            ab_xtc_2: ['ab_x', 'ab_wpc', 'ab_wpc'],
            ab_xtc_3: ['ab_x', 'ab_wpc', 'ab_wpc', 'ab_wpc'],
            a_xtc:  ['a_x',  {p:['a_wpc', 'a_wcp']}],
            a_xtc_2:  ['a_x',  'a_wpc', 'a_wpc'],
            a_xtc_3:  ['a_x',  'a_wpc', 'a_wpc', 'a_wpc'],

            af_xetm: ['af_xe', {p:['af_wec', ['_af', 'weM'], 'af_wce']}],
            af_xetm_2: ['af_xe', 'af_wec', 'af_wec' ],
            af_xetm_3: ['af_xe', 'af_wec', [0.5, 'af_wec', ['_af', 'weM']], 'af_wec'],
            ab_xetm: ['ab_xe', {p:['ab_wec', ['_ab', 'weM'], 'ab_wce']}],
            ab_xetm_2: ['ab_xe', 'ab_wec', 'ab_wec' ],
            ab_xetm_3: ['ab_xe', 'ab_wec', [0.5, 'ab_wec', ['_ab', 'weM']], 'ab_wec'],
            a_xetm:  ['a_xe',  {p:['a_wec', ['_a', 'weM'], 'a_wce']}],
            a_xetm_2:  ['a_xe',  'a_wec', 'a_wec' ],
            a_xetm_3:  ['a_xe',  'a_wec', [0.5, 'a_wec', ['_a', 'weM']], 'a_wec'],

            af_xtm: ['af_x', {p:['af_wpc', ['_af', 'wpM'], 'af_wcp']}],
            af_xtm_2: ['af_x', 'af_wpc', 'af_wpc' ],
            af_xtm_3: ['af_x', 'af_wpc', [0.5, 'af_wpc', ['_af', 'wpM']], 'af_wpc'],
            ab_xtm: ['ab_x', {p:['ab_wpc', ['_ab', 'wpM'], 'ab_wcp']}],
            ab_xtm_2: ['ab_x', 'ab_wpc', 'ab_wpc' ],
            ab_xtm_3: ['ab_x', 'ab_wpc', [0.5, 'ab_wpc', ['_ab', 'wpM']], 'ab_wpc'],
            a_xtm:  ['a_x',  {p:['a_wpc', ['_a', 'wpM'], 'a_wcp']}],
            a_xtm_2:  ['a_x',  'a_wpc', 'a_wpc' ],
            a_xtm_3:  ['a_x',  'a_wpc', [0.5, 'a_wpc', ['_a', 'wpM']], 'a_wpc'],

            af_xebo: ['af_xe', {p:['af_woe', 'af_w_e', 'af_we_']}],
            af_xebo_2: ['af_xe', [0.5, 'af_w_e', 'af_woe'], [0.5, 'af_w_e', 'af_woe']],
            af_xebo_3: ['af_xe', 'af_w_e', [0.5, 'af_w_e', 'af_woe'], 'af_w_e'],
            ab_xebo: ['ab_xe', {p:['ab_woe', 'ab_w_e', 'ab_we_']}],
            ab_xebo_2: ['ab_xe', [0.5, 'ab_w_e', 'ab_woe'], [0.5, 'ab_w_e', 'ab_woe']],
            ab_xebo_3: ['ab_xe', 'ab_w_e', [0.5, 'ab_w_e', 'ab_woe'], 'ab_w_e'],
            a_xebo:  ['a_xe',  {p:['a_woe', 'a_w_e', 'af_we_']}],
            a_xebo_2:  ['a_xe',  [0.8, 'a_w_e', 'a_woe'], [0.8, 'a_w_e', 'a_woe']],
            a_xebo_3:  ['a_xe',  'a_w_e', [0.5, 'a_w_e', 'a_woe'], 'a_w_e'],

            af_xbo: ['af_x', {p:['af_wop', 'af_w_p', 'af_wp_']}],
            af_xbo_2: ['af_x', [0.5, 'af_w_p', 'af_wop'], [0.5, 'af_w_p', 'af_wop']],
            af_xbo_3: ['af_x', 'af_w_p', [0.5, 'af_w_p', 'af_wop'], 'af_w_p'],
            ab_xbo: ['ab_x', {p:['ab_wop', 'ab_w_p', 'ab_wp_']}],
            ab_xbo_2: ['ab_x', [0.5, 'ab_w_p', 'ab_wop'], [0.5, 'ab_w_p', 'ab_wop']],
            ab_xbo_3: ['ab_x', 'ab_w_p', [0.5, 'ab_w_p', 'ab_wop'], 'ab_w_p'],
            a_xbo:  ['a_x',  {p:['a_wop', 'a_w_p', 'af_wp_']}],
            a_xbo_2:  ['a_x',  [0.8, 'a_w_p', 'a_wop'], [0.8, 'a_w_p', 'a_wop']],
            a_xbo_3:  ['a_x',  'a_w_p', [0.5, 'a_w_p', 'a_wop'], 'a_w_p'],

            af_xeb: ['af_xe', {p:['af_w_e', 'af_w_e', 'af_we_']}],
            af_xeb_2: ['af_xe', [0.7, ['af_w_e', 'af_w_e'], ['af_we_', 'af_we_']]],
            af_xeb_3: ['af_xe', [0.7, ['af_w_e', 'af_w_e', 'af_w_e'], ['af_we_', 'af_we_', 'af_we_']]],
            ab_xeb: ['ab_xe', {p:['ab_w_e', 'ab_w_e', 'ab_we_']}],
            ab_xeb_2: ['ab_xe', [0.7, ['ab_w_e', 'ab_w_e'], ['ab_we_', 'ab_we_']]],
            ab_xeb_3: ['ab_xe', [0.7, ['ab_w_e', 'ab_w_e', 'ab_w_e'], ['ab_we_', 'ab_we_', 'ab_we_']]],
            a_xeb:  ['a_xe',  {p:['a_w_e', 'a_w_e', 'af_we_']}],
            a_xeb_2: ['a_xe', [0.7, ['a_w_e', 'a_w_e'], ['a_we_', 'a_we_']]],
            a_xeb_3: ['a_xe', [0.7, ['a_w_e', 'a_w_e', 'a_w_e'], ['a_we_', 'a_we_', 'a_we_']]],

            af_xb: ['af_x', {p:['af_w_p', 'af_w_p', 'af_wp_']}],
            af_xb_2: ['af_x', [0.7, ['af_w_p', 'af_w_p'], ['af_wp_', 'af_wp_']]],
            af_xb_3: ['af_x', [0.7, ['af_w_p', 'af_w_p', 'af_w_p'], ['af_wp_', 'af_wp_', 'af_wp_']]],
            ab_xb: ['ab_x', {p:['ab_w_p', 'ab_w_p', 'ab_wp_']}],
            ab_xb_2: ['ab_x', [0.7, ['ab_w_p', 'ab_w_p'], ['ab_wp_', 'ab_wp_']]],
            ab_xb_3: ['ab_x', [0.7, ['ab_w_p', 'ab_w_p', 'ab_w_p'], ['ab_wp_', 'ab_wp_', 'ab_wp_']]],
            a_xb:  ['a_x',  {p:['a_w_p', 'a_w_p', 'af_wp_']}],
            a_xb_2: ['a_x', [0.7, ['a_w_p', 'a_w_p'], ['a_wp_', 'a_wp_']]],
            a_xb_3: ['a_x', [0.7, ['a_w_p', 'a_w_p', 'a_w_p'], ['a_wp_', 'a_wp_', 'a_wp_']]],

            af_xe1: ['af_xe', [0.5, 'af_we_', 'af_w_e' ]],
            ab_xe1: ['af_xe', [0.5, 'ab_we_', 'ab_w_e' ]],
            a_xe1: ['af_xe', [0.5, 'a_we_', 'a_w_e' ]],
            af_xe2: ['af_xe', [0.5, ['af_we_', 'af_we_'], ['af_w_e', 'af_w_e'] ]],
            ab_xe2: ['af_xe', [0.5, ['ab_we_', 'ab_we_'], ['ab_w_e', 'ab_w_e'] ]],
            a_xe2: ['af_xe', [0.5, ['a_we_', 'a_we_'], ['a_w_e', 'a_w_e'] ]],
            af_xe3: ['af_xe', [0.5, ['af_we_', 'af_we_', 'af_we_'], ['af_w_e', 'af_w_e', 'af_w_e'] ]],
            ab_xe3: ['af_xe', [0.5, ['ab_we_', 'ab_we_', 'ab_we_'], ['ab_w_e', 'ab_w_e', 'ab_w_e'] ]],
            a_xe3: ['af_xe', [0.5, ['a_we_', 'a_we_', 'a_we_'], ['a_w_e', 'a_w_e', 'a_w_e'] ]],

            af_x1: ['af_x', [0.5, 'af_wp_', 'af_w_p' ]],
            ab_x1: ['af_x', [0.5, 'ab_wp_', 'ab_w_p' ]],
            a_x1: ['af_x', [0.5, 'a_wp_', 'a_w_p' ]],
            af_x2: ['af_x', [0.5, ['af_wp_', 'af_wp_'], ['af_w_p', 'af_w_p'] ]],
            ab_x2: ['af_x', [0.5, ['ab_wp_', 'ab_wp_'], ['ab_w_p', 'ab_w_p'] ]],
            a_x2: ['af_x', [0.5, ['a_wp_', 'a_wp_'], ['a_w_p', 'a_w_p'] ]],
            af_x3: ['af_x', [0.5, ['af_wp_', 'af_wp_', 'af_wp_'], ['af_w_p', 'af_w_p', 'af_w_p'] ]],
            ab_x3: ['af_x', [0.5, ['ab_wp_', 'ab_wp_', 'ab_wp_'], ['ab_w_p', 'ab_w_p', 'ab_w_p'] ]],
            a_x3: ['af_x', [0.5, ['a_wp_', 'a_wp_', 'a_wp_'], ['a_w_p', 'a_w_p', 'a_w_p'] ]],

            af_C: ['_af','wC'],
            ab_C: ['_ab','wC'],
            a_C: ['_a','wC'],
            af_K: ['_af','wK'],
            ab_K: ['_ab','wK'],
            a_K: ['_a','wK'],
            af_Q: ['_af','wQ'],
            ab_Q: ['_ab','wQ'],
            a_Q: ['_a','wQ'],
            af_R: ['_af','wR'],
            ab_R: ['_ab','wR'],
            a_R: ['_a','wR'],
            af_T: ['_af','wT'],
            ab_T: ['_ab','wT'],
            a_T: ['_a','wT'],
            af_U: ['_af','wU'],
            ab_U: ['_ab','wU'],
            a_U: ['_a','wU'],

            //////////////// ENTRANCES ///////////////////
            // road == e => qoe == 2-open,1-mixed,1-full.    path => 2-open,2-any
            // fixed are buildings and such.
            // unique are the 6 uniques per regions. C K Q R T U
            // rare builtin to any, although harm-rare cannot occur with road/easy

            // ROAD as init-2ln-rd-1-3 + easy-cross + (1-3 rd or 1-6 easy-fixed) + repeat: easy-cross + (1-3 rd or 1 easy-fixed(avoiding multi fixed bc may not fit. first always fits (30+10+60))
            af_wee_:[0.5, 'af_wee', [0.7, 'af_wee_2', 'af_wee_3']],
            ab_wee_:[0.5, 'ab_wee', [0.7, 'ab_wee_2', 'ab_wee_3']],
            a_wee_: [0.5, 'a_wee',  [0.7, 'a_wee_2',  'a_wee_3']],

            // NON-ROAD use path instead, else the same...
            af_wpp_:[0.5, 'af_wpp',  [0.7, 'af_wpp_2', 'af_wpp_3']],
            ab_wpp_:[0.5, 'ab_wpp',  [0.7, 'ab_wpp_2', 'ab_wpp_3']],
            a_wpp_: [0.5, 'a_wpp',   [0.7, 'a_wpp_2',  'a_wpp_3']],

            af_xetc_:[0.6,'af_xetc', [0.6, 'af_xetc_2', [0.6, 'af_xetc_3', 'af_xf1']]],
            ab_xetc_:[0.6,'ab_xetc', [0.6, 'ab_xetc_2', [0.6, 'ab_xetc_3', 'ab_xf1']]],
            a_xetc_: [0.6,'a_xetc',  [0.6, 'a_xetc_2',  [0.6, 'a_xetc_3', 'a_xf1']]],
            af_fxetc_:[0.0, 'af_xetc_', 'af_xfe'],
            ab_fxetc_:[0.0, 'ab_xetc_', 'ab_xfe'],
            a_fxetc_:[0.0, 'a_xetc_', 'a_xfe'],

            af_xetm_:[0.6,'af_xetm', [0.6, 'af_xetm_2', [0.6, 'af_xetm_3', 'af_xf1']]],
            ab_xetm_:[0.6,'ab_xetm', [0.6, 'ab_xetm_2', [0.6, 'ab_xetm_3', 'ab_xf1']]],
            a_xetm_: [0.6,'a_xetm', [0.6, 'a_xetm_2', [0.6, 'a_xetm_3', 'a_xf1']]],
            af_fxetm_:[0.9, 'af_xetm_', 'af_xfe'],
            ab_fxetm_:[0.9, 'ab_xetm_', 'ab_xfe'],
            a_fxetm_:[0.9, 'a_xetm_', 'a_xfe'],

            af_xebo_:[0.6,'af_xebo', [0.6, 'af_xebo_2', [0.6, 'af_xebo_3', 'af_xf1']]],
            ab_xebo_:[0.6,'ab_xebo', [0.6, 'ab_xebo_2', [0.6, 'ab_xebo_3', 'ab_xf1']]],
            a_xebo_: [0.6,'a_xebo', [0.6, 'a_xebo_2', [0.6, 'a_xebo_3', 'a_xf1']]],
            af_fxebo_:[0.9, 'af_xebo_', 'af_xfe'],
            ab_fxebo_:[0.9, 'ab_xebo_', 'ab_xfe'],
            a_fxebo_:[0.9, 'a_xebo_', 'a_xfe'],

            af_xeb_:[0.6,'af_xeb', [0.6, 'af_xeb_2', [0.6, 'af_xeb_3', 'af_xf1']]],
            ab_xeb_:[0.6,'ab_xeb', [0.6, 'ab_xeb_2', [0.6, 'ab_xeb_3', 'ab_xf1']]],
            a_xeb_: [0.6,'a_xeb', [0.6, 'a_xeb_2', [0.6, 'a_xeb_3', 'a_xf1']]],
            af_fxeb_:[0.9, 'af_xeb_', 'af_xfe'],
            ab_fxeb_:[0.9, 'ab_xeb_', 'ab_xfe'],
            a_fxeb_:[0.9, 'a_xeb_', 'a_xfe'],

            af_xe_:[0.6,'af_xe1', [0.6, 'af_xe2', [0.6, 'af_xe3', 'af_xf1']]],
            ab_xe_:[0.6,'ab_xe1', [0.6, 'ab_xe2', [0.6, 'ab_xe3', 'ab_xf1']]],
            a_xe_: [0.6,'a_xe1', [0.6, 'a_xe2', [0.6, 'a_xe3', 'a_xf1']]],
            af_fxe_:[0.9, 'af_xe_', 'af_xfe'],
            ab_fxe_:[0.9, 'ab_xe_', 'ab_xfe'],
            a_fxe_:[0.9, 'a_xe_', 'a_xfe'],

            af_xeC: ['af_xe', 'af_C'],
            ab_xeC: ['ab_xe', 'ab_C'],
            a_xeC: ['a_xe', 'a_C'],
            af_xeK: ['af_xe', 'af_K'],
            ab_xeK: ['ab_xe', 'ab_K'],
            a_xeK: ['a_xe', 'a_K'],
            af_xeQ: ['af_xe', 'af_Q'],
            ab_xeQ: ['ab_xe', 'ab_Q'],
            a_xeQ: ['a_xe', 'a_Q'],
            af_xeR: ['af_xe', 'af_R'],
            ab_xeR: ['ab_xe', 'ab_R'],
            a_xeR: ['a_xe', 'a_R'],
            af_xeT: ['af_xe', 'af_T'],
            ab_xeT: ['ab_xe', 'ab_T'],
            a_xeT: ['a_xe', 'a_T'],
            af_xeU: ['af_xe', 'af_U'],
            ab_xeU: ['ab_xe', 'ab_U'],
            a_xeU: ['a_xe', 'a_U'],

            af_xtc_:[0.6,'af_xtc', [0.6, 'af_xtc_2', [0.6, 'af_xtc_3', 'af_xf1']]],
            ab_xtc_:[0.6,'ab_xtc', [0.6, 'ab_xtc_2', [0.6, 'ab_xtc_3', 'ab_xf1']]],
            a_xtc_: [0.6,'a_xtc', [0.6, 'a_xtc_2', [0.6, 'a_xtc_3', 'a_xf1']]],
            af_fxtc_:[0.9, 'af_xtc_', 'af_xf'],
            ab_fxtc_:[0.9, 'ab_xtc_', 'ab_xf'],
            a_fxtc_:[0.9, 'a_xtc_', 'a_xf'],

            af_xtm_:[0.6,'af_xtm', [0.6, 'af_xtm_2', [0.6, 'af_xtm_3', 'af_xf1']]],
            ab_xtm_:[0.6,'ab_xtm', [0.6, 'ab_xtm_2', [0.6, 'ab_xtm_3', 'ab_xf1']]],
            a_xtm_: [0.6,'a_xtm', [0.6, 'a_xtm_2', [0.6, 'a_xtm_3', 'a_xf1']]],
            af_fxtm_:[0.9, 'af_xtm_', 'af_xf'],
            ab_fxtm_:[0.9, 'ab_xtm_', 'ab_xf'],
            a_fxtm_:[0.9, 'a_xtm_', 'a_xf'],

            af_xbo_:[0.6,'af_xbo', [0.6, 'af_xbo_2', [0.6, 'af_xbo_3', 'af_xf1']]],
            ab_xbo_:[0.6,'ab_xbo', [0.6, 'ab_xbo_2', [0.6, 'ab_xbo_3', 'ab_xf1']]],
            a_xbo_: [0.6,'a_xbo', [0.6, 'a_xbo_2', [0.6, 'a_xbo_3', 'a_xf1']]],
            af_fxbo_:[0.9, 'af_xbo_', 'af_xf'],
            ab_fxbo_:[0.9, 'ab_xbo_', 'ab_xf'],
            a_fxbo_:[0.9, 'a_xbo_', 'a_xf'],

            af_xb_:[0.6,'af_xb', [0.6, 'af_xb_2', [0.6, 'af_xb_3', 'af_xf1']]],
            ab_xb_:[0.6,'ab_xb', [0.6, 'ab_xb_2', [0.6, 'ab_xb_3', 'ab_xf1']]],
            a_xb_: [0.6,'a_xb', [0.6, 'a_xb_2', [0.6, 'a_xb_3', 'a_xf1']]],
            af_fxb_:[0.9, 'af_xb_', 'af_xf'],
            ab_fxb_:[0.9, 'ab_xb_', 'ab_xf'],
            a_fxb_:[0.9, 'a_xb_', 'a_xf'],

            af_x_:[0.6,'af_x1', [0.6, 'af_x2', [0.6, 'af_x3', 'af_xf1']]],
            ab_x_:[0.6,'ab_x1', [0.6, 'ab_x2', [0.6, 'ab_x3', 'ab_xf1']]],
            a_x_: [0.6,'a_x1', [0.6, 'a_x2', [0.6, 'a_x3', 'a_xf1']]],
            af_fx_:[0.9, 'af_x_', 'af_xf'],
            ab_fx_:[0.9, 'ab_x_', 'ab_xf'],
            a_fx_:[0.9, 'a_x_', 'a_xf'],

            af_xC: ['af_x', 'af_C'],
            ab_xC: ['ab_x', 'ab_C'],
            a_xC: ['a_x', 'a_C'],
            af_xK: ['af_x', 'af_K'],
            ab_xK: ['ab_x', 'ab_K'],
            a_xK: ['a_x', 'a_K'],
            af_xQ: ['af_x', 'af_Q'],
            ab_xQ: ['ab_x', 'ab_Q'],
            a_xQ: ['a_x', 'a_Q'],
            af_xR: ['af_x', 'af_R'],
            ab_xR: ['ab_x', 'ab_R'],
            a_xR: ['a_x', 'a_R'],
            af_xT: ['af_x', 'af_T'],
            ab_xT: ['ab_x', 'ab_T'],
            a_xT: ['a_x', 'a_T'],
            af_xU: ['af_x', 'af_U'],
            ab_xU: ['ab_x', 'ab_U'],
            a_xU: ['a_x', 'a_U'],
        },
        _locale_gen: {
            rel: {
                // set on load_wrel
                // 1-5 solid   6-0 bg
            },
            // TODO refactor. remove air from load and template. auto add during build
            // usage: load(wrel){true-ok}, build(){tile-array-to-generate-display}
            // wrel: null if cannot build
            // bgs: 3-char string of current wrel Region-Environ-Locale  only Locale may be uppercase if it is a road
            // optional props like _locale_tpl_: l c p i (only one of check-order: literal condition picks items)  
            load_wrel: function(wrel){
                wrel = __action.ensure_wrel(wrel)
                if (!wrel || (wrel = wrel.slice(0,6)).length != 6){
                    return;
                }
                if (this.wrel && this.wrel.join('') == wrel.join('')){
                    return true
                }
                this.wrel = wrel
                this.l = null // literal, maybe relative (called raw here)
                this.c = null // condition [chance, on-true-tpl, on-false-tpl]
                this.p = null // 
                this.i = null // items, name or literal-like
                this.owner = null 
                this.unique = null 
                let bgs = this.bgs = __action.__wrel_get_bgs(wrel)
                let rgn = __prop._wrel_.get(wrel[0] + '_' + wrel[1])

                let wn = wrel.join('_')
                if (__prop._wrel_.has(wn)){
                    this.lit = __prop._wrel_.get(wn)
                    return true
                }else if (__prop._wrel_.has('_' + wn)){
                    this.lit = __prop._wrel_.get('_' + wn)
                    __prop._wrel_.delete('_' + wn)
                    __prop._wrel_.set(wn, this.lit)
                    return true
                }
                
                // air effects weather chance. dependent on region and its sides. 
                let air = 0, grid = __action.__wrel_get_bg_grid9([wrel[0], wrel[1]])
                for (let ix of [1,3,4,5,7]){
                    switch(grid[ix]){
                    case 'j':
                    case 'c':
                    case 'i':
                        if (ix == 4){
                            air += 5
                        }else{
                            air += 2
                        }
                        break;
                    case 'm':
                    case 's':
                    case 'w':
                        if (ix == 4){
                            air += 3
                        }else{
                            air += 1
                        }
                        break;
                    default:
                        if (ix == 4)
                            air += 2;
                    }
                }

                // WIP
                // ADD SEASON-REGION BIAS (summer-clear vs summer-storm)
                // ADD REGION IN BIAS (from neighbor region). req store and compare region-fills
                // ADD REGION OUT BIAS (to neighbor region). req store and compare region-fills
                // ..consider region flow/transferance vs compression/internal-dissipation vs expansion/internal-generation
                // TWEAK REGION fills, and possibly neighbors 

                if (air > 9){ // req pair(7)+3 or trip(9)+1 or quad or low(3)+6+1 or low(3)+8
                    air = 'af_'
                }else if (air > 6){ // deepwater is 3+4. coastline is 3+3+[0-2].
                    air = 'a_'
                }else{
                    air = 'ab_'
                }

                if (bgs[2] == bgs[2].toUpperCase()){
                    // always start 2lane road (swipe-easy[top]-easy[bot])
                    this.i = [air + 'wee_'];

                    // xe: 10w easy transition both directions  
                    // xe_: xe + pick [see_1 see_2 see_3 set_1 set_2 set_3 seb_1 seb_2 seb_3] (at-least-1-easy-swipe times 1-3) road 10-30w either 2-open or either-1-open,
                    let cnt = SZ_LOCALE_X / 20 
                    // path favor-top: water craig/mtn
                    //      +favor-common, +allow-magma (ccC)
                    // favor-bot-open-top: desert grass
                    // favor-bot: mtn/hill

                    switch(bgs[1]){
                    case 'w':
                        cnt--;
                        this.i.push(air + 'fxetc_');
                        while(cnt-- > 0) this.i.push(air + 'xetc_');
                        break;
                    case 'c':
                        if (bgs[0] == 'c' && bgs[2] == 'C'){
                            cnt--;
                            this.i.push(air + 'fxetm_');
                            while(cnt-- > 0) this.i.push(air + 'xetm_');
                        }else{
                            cnt--;
                            this.i.push(air + 'fxetc_');
                            while(cnt-- > 0) this.i.push(air + 'xetc_');
                        }
                        break;
                    case 'd': case 'g':
                        cnt--;
                        this.i.push(air + 'fxebo_');
                        while(cnt-- > 0) this.i.push(air + 'xebo_');
                        break;
                    case 'm':
                        cnt--;
                        this.i.push(air + 'fxeb_');
                        while(cnt-- > 0) this.i.push(air + 'xeb_');
                        break;
                    default:
                        cnt--;
                        this.i.push(air + 'fxe_');
                        while(cnt-- > 0) this.i.push(air + 'xe_');
                        break;
                    }


                }else{
                    this.i = [ air + 'wpp_' ] // 10-30w wipe open-ish
                    // x_-: 20-70w: any-transition (10w) plus anything-else (10-60w)
                    // x: 10w any transition  
                    // x_: x + pick [s_1(x6) s_2(x5) s_3(x4) s_4(x3) s_5(x2) s_6] any swipe. weighted.
                    // s_*: insert air...prefix name
                    // 60w max allows at least 1 full always. (30[max of wo_] + 10 + 60)
                    // favor-bot: desert grass mtn/hill
                    // favor-top: water craig/mtn
                    //  +favor-common: water
                    //  +allow-magma : ccc
                    
                    let cnt = SZ_LOCALE_X / 20

                    switch(bgs[1]){
                    case 'w':
                        cnt--;
                        this.i.push(air + 'fxtc_');
                        while(cnt-- > 0) this.i.push(air + 'xtc_');
                        break;
                    case 'c':
                        if (bgs[0] == 'c' && bgs[2] == 'c'){
                            cnt--;
                            this.i.push(air + 'fxtm_');
                            while(cnt-- > 0) this.i.push(air + 'xtm_');
                        }else{
                            cnt--;
                            this.i.push(air + 'fxtc_');
                            while(cnt-- > 0) this.i.push(air + 'xtc_');
                        }
                        break;
                    case 'd': case 'g':
                        cnt--;
                        this.i.push(air + 'fxbo_');
                        while(cnt-- > 0) this.i.push(air + 'xbo_');
                        break;
                    case 'm':
                        cnt--;
                        this.i.push(air + 'fxb_');
                        while(cnt-- > 0) this.i.push(air + 'xb_');
                        break;
                    default:
                        cnt--;
                        this.i.push(air + 'fx_');
                        while(cnt-- > 0) this.i.push(air + 'x_');
                        break;
                    }
                }

                // bgs [region:minor-bg-and-weather, environ:2ndary-and-path, locale:primary-and-road]
                // for desert, mtn, forest: 
                //      3      2    1 45
                //      6      7    890
                switch(bgs[0]){
                case 'c':
                    this.rel['3'] = 'B'
                    this.rel['6'] = 'b'
                    break;
                case 'w':
                    // this.rel['3'] = 'S'
                    this.rel['3'] = 'E'
                    this.rel['6'] = 'w'
                    break;
                case 'i':
                    this.rel['3'] = 'I'
                    this.rel['6'] = 'i'
                    break;
                case 'm':
                    this.rel['3'] = 'V'
                    this.rel['6'] = 'b'
                    break;
                case 'd':
                    this.rel['3'] = 'S'
                    this.rel['6'] = 's'
                    break;
                case 's':
                    this.rel['3'] = 'G'
                    this.rel['6'] = 'g'
                    break;
                case 'j':
                    this.rel['3'] = 'G'
                    this.rel['6'] = 'g'
                    break;
                case 'f':
                    this.rel['3'] = 'E'
                    this.rel['6'] = 'g'
                    break;
                case 'g':
                    // this.rel['3'] = 'V'
                    // this.rel['3'] = 'W'
                    // this.rel['3'] = 'F'
                    this.rel['3'] = 'E'
                    this.rel['6'] = 'v'
                    break;
                }
                switch(bgs[1]){
                case 'c':
                    this.rel['2'] = 'B'
                    this.rel['7'] = 'b'
                    break;
                case 'w':
                    this.rel['2'] = 'W'
                    this.rel['7'] = 'w'
                    break;
                case 'i':
                    this.rel['2'] = 'I'
                    this.rel['7'] = 'i'
                    break;
                case 'm':
                    this.rel['2'] = 'B'
                    this.rel['7'] = 'v'
                    break;
                case 'd':
                    this.rel['2'] = 'S'
                    this.rel['7'] = 's'
                    break;
                case 's':
                    this.rel['2'] = 'W'
                    this.rel['7'] = 'w'
                    break;
                case 'j':
                    this.rel['2'] = 'G'
                    this.rel['7'] = 'j'
                    break;
                case 'f':
                    this.rel['2'] = 'E'
                    this.rel['7'] = 'g'
                    break;
                case 'g':
                    this.rel['2'] = 'V'
                    this.rel['7'] = 'v'
                    break;
                }
                switch(bgs[2].toLowerCase()){
                case 'c':
                    this.rel['1'] = 'B'
                    this.rel['4'] = 'B'
                    this.rel['5'] = 'W'
                    
                    this.rel['8'] = 'b'
                    this.rel['9'] = 'b'
                    this.rel['0'] = 'w'
                    break;
                case 'w':
                    this.rel['1'] = 'W'
                    this.rel['4'] = 'W'
                    this.rel['5'] = 'E'
                    
                    this.rel['8'] = 'w'
                    this.rel['9'] = 'g'
                    this.rel['0'] = 'e'
                    break;
                case 'i':
                    this.rel['1'] = 'I'
                    this.rel['4'] = 'W'
                    this.rel['5'] = 'E'
                    
                    this.rel['8'] = 'i'
                    this.rel['9'] = 'w'
                    this.rel['0'] = 'w'
                    break;
                case 'm':
                    this.rel['1'] = 'B'
                    this.rel['4'] = 'E'
                    this.rel['5'] = 'S'
                    
                    this.rel['8'] = 'v'
                    this.rel['9'] = 'e'
                    this.rel['0'] = 'g'
                    break;
                case 'd':
                    this.rel['1'] = 'S'
                    this.rel['4'] = 'S'
                    this.rel['5'] = 'E'
                    
                    this.rel['8'] = 's'
                    this.rel['9'] = 's'
                    this.rel['0'] = 's'
                    break;
                case 's':
                    this.rel['1'] = 'E'
                    this.rel['4'] = 'W'
                    this.rel['5'] = 'G'
                    
                    this.rel['8'] = 'w'
                    this.rel['9'] = 'e'
                    this.rel['0'] = 'g'
                    break;
                case 'j':
                    this.rel['1'] = 'E'
                    this.rel['4'] = 'F'
                    this.rel['5'] = 'G'
                    
                    this.rel['8'] = 'f'
                    this.rel['9'] = 'g'
                    this.rel['0'] = 'j'
                    break;
                case 'f':
                    this.rel['1'] = 'E'
                    this.rel['4'] = 'W'
                    this.rel['5'] = 'G'
                    
                    this.rel['8'] = 'g'
                    this.rel['9'] = 'g'
                    this.rel['0'] = 'e'
                    break;
                case 'g':
                    this.rel['1'] = 'V'
                    this.rel['4'] = 'W'
                    // this.rel['5'] = 'E'
                    this.rel['5'] = 'F'
                    
                    this.rel['8'] = 'v'
                    this.rel['9'] = 'f'
                    this.rel['0'] = 'w'
                    break;
                }
                return true
            },
            build: function(){
                let debug = __prop._debug.locale_gen_build = 1
                if (!this.wrel) return;
                const raw = { // bucket chances: 5/8  2/8  1/8 (then equal chance each char)
                    _: {
                        // air: top-row of sky. A is darker, higher-fills(pressure/weather).
                        a: { // _oa: mixed
                            b:{ // _oab: clear-ish
                                c: ['a', 'a', 'A'],
                                d: ['a', 'A'],
                            },
                            f:{ // _oaf: cloudy
                                c: ['A', 'A', 'a'],
                                d: ['A', 'a'],
                            },
                        },
                        o: { // open. transparent.
                            c: {
                                c: {
                                    c:{
                                        c: ['6', '778', '6'], // 6 0.7 0.3 0 0
                                        d: ['6',  '7', '8'], // 5 2 1 0 0
                                    },
                                    d: ['66677', '6778', '89'], //3.5 3.0 1.0 0.5 0
                                },
                                d: ['667', '788', '990'], // 3.3 2.3 1.3 .7 .3
                            },
                            d: {
                                d: {
                                    d: {
                                        d: ['67890'], // 1.6 all
                                        c: ['678', '90', '67'], // 2.2 2.2 1.7 1 1
                                    },
                                    c: ['67', '8890'], // 2.5 2.5 1.3 .7 .7
                                },
                                c: ['66778', '8990', '6'], // 3 2 1.5 1.0 0.5
                            },
                        },
                        f: { // fill. solid.
                            c: {
                                c: {
                                    c:{
                                        c: ['1', '223', '1'], // preJ: 6 0.7 0.3 0 0
                                        d: ['1',  '2', '3'], // preJ: 5 2 1 0 0
                                    },
                                    d: ['11122', '1223', '34'], // preJ: 3.5 3.0 1.0 0.5 0
                                },
                                d: ['112', '233', '445J'], // preJ: 3.3 2.3 1.3 .7 .3
                            },
                            d: {
                                d: {
                                    d: {
                                        d: ['12345J'], // preJ: 1.6 all
                                        c: ['123', '45', '12'], // preJ: 2.2 2.2 1.7 1 1
                                    },
                                    c: ['12', '3345'], // preJ: 2.5 2.5 1.3 .7 .7
                                },
                                c: ['11223', '3445J', '1'], // preJ: 3 2 1.5 1.0 0.5
                            },
                        },
                        m: { // mixed fill and open
                            c: {
                                c: {
                                    c:{
                                        c: ['16', '223778', '16'], // preJ: 6 0.7 0.3 0 0
                                        d: ['16',  '27', '38'], // preJ: 5 2 1 0 0
                                    },
                                    d: ['1112266677', '12236778', '3489'], // preJ: 3.5 3.0 1.0 0.5 0
                                },
                                d: ['112667', '233788J', '445990'], // preJ: 3.3 2.3 1.3 .7 .3
                            },
                            d: {
                                d: {
                                    d: {
                                        d: ['1234567890J'], // preJ: 1.6 all
                                        c: ['123678', '4590', '1267J'], // preJ: 2.2 2.2 1.7 1 1
                                    },
                                    c: ['1267', '33458890J'], // preJ: 2.5 2.5 1.3 .7 .7
                                },
                                d: ['1122366778', '34458990', '16J'], // preJ: 3 2 1.5 1.0 0.5
                            },
                        },
                        M: { // Magma ... wip. copied mixed
                            c: {
                                c: {
                                    c:{
                                        c: ['MM16', 'Mm223778', 'M16'],
                                        d: ['MM16',  'Mm27', 'M38'],
                                    },
                                    d: ['MM1112266677', 'Mm12236778', 'M3489'],
                                },
                                d: ['MM112667', 'Mm233788J', 'M445990'],
                            },
                            d: {
                                d: {
                                    d: {
                                        d: ['MM1234567890J'],
                                        c: ['MM123678', 'Mm4590', 'M1267'],
                                    },
                                    c: ['MM1267', 'Mm33458890'],
                                },
                                c: ['MM1122366778', 'Mm34458990', 'M16J'],
                            },
                        },
                    }
                }
                const PICK_AMT = 10, PICK_LEN = 8, PICK_RARE = 0, PICK_MID = 2
                // raw-name picks 10 at [5/8, 2/8, 1/8] chances

                let template = this, 
                    result = this.result = {bg:[], bgix:{}, holds: [], unique: null, owner: null}, 
                    done, x=0, y=0, row=0;
                const paint = function(str){
                    if (Array.isArray(str)){
                        let it, v;
                        for(it of str){
                            v = paint(it)
                            if(v)
                                return v;
                        }
                        return;
                    }

                    if (!str)
                        return 'no paint string'
                    for (let c of str){
                        if (done) return 'done early';// ok. width is variable but min-10 so 10 picks for min-100. only for randoms.
                        if (!c){
                            console.log("locale undefined background.")
                        }
                        if (Array.isArray(c)){
                            paint(c.join(''))
                        }

                        if ('_' == template.rel[c] || '_' == c)
                            debugger;
                        result.bg[x+row + SZ_LOCALE_X*y] = template.rel[c] || c

                        if (++row > 9){
                            row = 0
                            if (++y > 9){
                                y = 0
                                x += 10
                                if (x > MX_LOCALE_X)
                                    done = true
                            }
                        }
                    }
                }
                const collect = function(at){
                    let r = []
                    for (let v of Object.values(at)){
                        if (Array.isArray(v))
                            r.push(v)
                        else{
                            r = r.concat(collect(v))
                        }
                    }
                    return r
                }
                const transpose_raw = function(name){
                    // either valid name or tiles
                    let res = '', rem, rules, at = raw, roll, rule
                    for (let c of name){
                        if (at)
                            at = at[c]
                    }
                    if (!at){
                        if(LOG_LOCALE_DRAW_ITEM) console.log('locale LITERAL', name)
                        return name; // as tiles
                    }else{
                        if(LOG_LOCALE_DRAW_ITEM) console.log('locale LINE', name)
                    }
                    if (Array.isArray(at)){
                        rules = [at]
                    }else{
                        rules = collect(at)
                    }

                    rem = PICK_AMT
                    while(rem--){
                        rule = __action.pick_from_items(rules)
                        roll = __action.pick_in_range(PICK_LEN)
                        if (rule[2] && roll <= PICK_RARE){
                            res += __action.pick_from_items(rule[2])
                        }else if (rule[1] && roll <= PICK_MID){
                            res += __action.pick_from_items(rule[1])
                        }else{
                            res += __action.pick_from_items(rule[0])
                        }
                    }
                    return res
                }
                const transpose_logic = function(log){
                    if (Math.random() < log[0]){
                        return transpose_tpl(log[1])
                    }else{
                        return transpose_tpl(log[2])
                    }
                }
                const transpose_tpl = function(tpl){
                    if (__prop._locale_tpl_[tpl]){
                        if(LOG_LOCALE_DRAW_ITEM) console.log('----locale template', tpl)
                        tpl = __prop._locale_tpl_[tpl]
                    }
                    if (!tpl){
                        console.log("bad template for locale-gen bgs result res wrel", this.bgs, result, this.wrel, this.bgs )
                        return ''
                    }
                    if (Array.isArray(tpl)){
                        if (tpl.length == 3 && 'number' == typeof(tpl[0])){
                            return transpose_logic(tpl);
                        }
                        let _res = ''
                        for (let t of tpl){
                            _res += transpose_tpl(t)
                        }
                        return _res;
                    }
                    if (tpl.l){
                        return tpl.l;
                    }else if(tpl.c && Array.isArray(tpl.c) && tpl.c.length == 3){
                        return transpose_logic(tpl.c);
                    }else if(tpl.p){
                        return transpose_tpl(__action.pick_from_items(tpl.p))
                    }else if(tpl.i){
                        let _res = ''
                        for (let t of tpl.i){
                            _res += transpose_tpl(t)
                        }
                        return _res;
                    }else{
                        return transpose_raw(tpl);
                    }
                }

                paint(transpose_tpl(template))
                // overpaint ignored. normal.

                return result;
            },
        },
    },
    _selecting: null,
    _selectable_: {},
    _on_: {},
    _action_: {
        add_component_inspect_: function(dsp, type, data, as_html){
            dsp.classList.add('help')

            let value = '', generator
            switch(type){
            case 'ent':
                as_html = true
                generator = ()=>(select.generate_('info_ent', {ent: data}))
                break;
            case 'creation':
                as_html = true
                value = __prop._help_inspect
                break;
            default:
                value = '<unknown inspect:' + type + '>'
            }

            const onclick = function(evt){
                if (evt && evt.detail == 2)
                    return;
                if (evt && evt.stopPropagation)evt.stopPropagation()

                if (!value){
                    if (generator){
                        value = generator()
                    }else if (type == 'creation'){
                        value = __prop._help_inspect
                    }
                }else{
                    // console.log('re-use value:', value)
                }
                if (__prop._inspect && value != __prop._inspect){
                    if (__prop._last_last_inspect != __prop._inspect && __prop._last_last_inspect != __prop._last_inspect){
                        __prop._last_last_inspect = __prop._last_inspect
                        __prop._last_last_inspect_as_html = __prop._last_inspect_as_html
                    }
                    __prop._last_inspect = __prop._inspect
                    __prop._last_inspect_as_html = __prop._inspect_as_html
                }
                __prop._inspect = value
                __prop._inspect_as_html = as_html
                view.display('inspect_')
            }
            dsp.onclick = onclick;
            return true
        },

        // roll_dice_mods_(dice, mods, _allow_under_1)
        roll_dice: function(dice, _no_minimum){
            // => [ total, min, max]
            // min 1 by default.
            // negative preserved. (-2 rolls [-1, -2])
            // to make static +3, [1,1,1] or -2 [-1,-1]
            if (!Array.isArray(dice)) dice = [dice];
            let res = [0, 0, 0]
            for (let d of dice){
                if (d > 0){
                    res[1] += 1
                    res[2] += Math.ceil(d)
                    res[0] += Math.ceil(Math.random() * d)
                }else if (d < 0){
                    res[1] += -1 
                    res[2] += -Math.ceil(-d) 
                    res[0] += -Math.ceil(Math.random() * (-d)) 
                }
            }
            if (!_no_minimum){
                if (res[0] < 1) res[0] = 1;
                if (res[1] < 1) res[1] = 1;
            }
            return res
        },
        result_roll: function(dice, _no_min){
            return this.roll_dice(dice, _no_min)[0]
        },
        max_hp_roll: function(count){
            // (#) => sum # rolls of __prop._max_hp_roll
            // [#,bonus]
            // [#,bonus,override-base-roll]

            let res = 0, roll = __prop._max_hp_roll
            if (Array.isArray(count)){
                // [5, 3] == 5d8 + 3
                // [4,-1, 6] == 4d6 - 1 
                res = count[1]
                if (count[2]){
                    roll = count[2]
                }
                count = count[0]
            }
            while (count > 0){
                count--;
                res += this.result_roll(roll)
            }
            if (res < 1) res = 1;
            return res
        },
        pick_from_items: function(items){
            // => item
            if (Array.isArray(items)){
                return items[-1 + __action.result_roll(items.length)];
            }else if (items && 'string' == typeof(items) || 'String' == items.constructor.name){
                return items[-1 + __action.result_roll(items.length)];
            }
        },
        pick_in_range: function(range, _num_is_max_index){
            // => key / #
            // (max-index, 1)  [0, range]
            // (length)        [0, range)               
            // (array)         [0, range.length)
            return (-1 + 
                    __action.result_roll(
                        Array.isArray(range) ? 
                            range.length :
                        (_num_is_max_index ?
                            (1 + range) :
                        range)
                    ));
        },
        roll_rarity: function(){
            const adv_chance = 0.36
            // to spawn, must roll >= spawner
            // at 36% advance chance                        
            // RARITY                       
            // 0        no
            // 1        about 1 in          1.5   64 %
            // 2        about 1 in          4     25 %
            // 3        about 1 in          12     9 %
            // 4        about 1 in          33     3 %
            // 5        about 1 in          93     1 %
            // 6        about 1 in          258 
            // 7        about 1 in          718 
            // 8        about 1 in          1994    
            // 9        about 1 in          5539    

            let rarity = 0
            while (rarity < 9){
                if (Math.random() < adv_chance){
                    ++rarity
                }else{
                    break;
                }
            }
            return rarity;
        },
        refresh: function(){
            return this.set_state()
        },
        set_state: function(state, _force_refresh){
            // (current, falsy)  => ignore
            // (current, truthy) => refresh-current
            // (falsy)           => refresh-current
            // (falsy, truthy)   => onfocus-current, refresh-current
            // (new) => old.onblur/, set-state, new.onfocus/, new.onrefreshfirst/, redisplay-before-items, redisplay-old-items, redisplay-new-items, redisplay-after, new.onrefreshlast/

            let old = __sel._state
            if (old == state){
                if (!(old in __sel._state_)){
                    if (LOG_STATE_CHANGE)console.log('recover state as init_creation/; set_state/ (bad-current) :', state)
                    return __action.init_creation()
                }
                if (!_force_refresh){
                    if (LOG_STATE_CHANGE)console.log('ignoring set_state/ (current_state) :', state)
                    return
                }
                old = undefined
            }
            else if (!state){
                state = old
                if (!_force_refresh){
                    old = undefined // onfocus will not call
                }else{
                    old = null // onfocus will call
                }
            }
            else if (state in __sel._state_){
                if (old && __sel._state_[old].onblur)
                    __sel._state_[old].onblur(state)
                __sel._state = state
                if (LOG_STATE_CHANGE)console.log('set state to:', state)
            }
            else{
                if (old in __sel._state_){
                    if (LOG_STATE_CHANGE)console.log('ignore set_state/ (unknown) :', state);
                    return;
                }else{
                    if (LOG_STATE_CHANGE)console.log('recover state. init_creation/ (unknown), bad-current', state, __sel._state)
                    return __action.init_creation()
                }
            }
            if (old !== undefined && __sel._state_[state].onfocus)
                __sel._state_[state].onfocus()

            if (__sel._state_[state].onrefreshfirst)
                __sel._state_[state].onrefreshfirst()

            for (let d of (__prop._state_displays_._before || [])){
                view.display(d)
            }

            for (let d of (__prop._state_displays_[old] || [])){
                view.display(d)
            }

            for (let d of (__prop._state_displays_[state] || [])){
                view.display(d)
            }

            for (let d of (__prop._state_displays_._after || [])){
                view.display(d)
            }

            if (__sel._state_[state].onrefreshlast)
                __sel._state_[state].onrefreshlast()

            return state
        },
        init_creation: function(){
            let res = __prop._creation._ent = select.generate_('creation_ent')
            // console.log('creation ent', res)
            __action.set_state('creation', true)
            return res
        },

        _gen_name: function(start_letter_ix, _len=3){
            if (!(start_letter_ix >= 0 && start_letter_ix < 26)) 
                start_letter_ix = __action.pick_in_range(26)
            if (!(_len >= 2 && _len <= 5))
                _len = 3;

            let r = String.fromCodePoint(start_letter_ix + ('A').charCodeAt(0))
            while(--_len){
                r += String.fromCodePoint(__action.pick_in_range(26) + ('a').charCodeAt(0));
            }
            return r
        },
        ensure_wrel: function(wrel){
            if (typeof wrel == 'string' || wrel instanceof String){
                wrel = wrel.split('_')
            }
            if (Array.isArray(wrel)){
                if (wrel.some((i)=>Number.isNaN(Number(i))))
                    return null;
                switch(wrel.length){
                case 2: case 4: case 6: case 8:
                    return wrel;
                default:
                    return null;
                }
            }
            return null;
        },
        __wrel_get_: function(wrel, type, unrevealed, revealing){
            // exploring
            const tps = ['bg', 'mg', 'fg']
            let ix, d, k;
            if (!type){
                d = []
                d.push(__action.__wrel_get_(wrel, 'bg', unrevealed, revealing))
                d.push(__action.__wrel_get_(wrel, 'mg', unrevealed, revealing))
                d.push(__action.__wrel_get_(wrel, 'fg', unrevealed, revealing))
                return d;
            }
            if (!tps.includes(type))
                type = tps[0];
            if (!(wrel = __action.ensure_wrel(wrel)))
                return;

            switch(wrel.length){
            case 2:
                ix = SZ_WORLD_X*wrel[1] + wrel[0]
                switch(type){
                case 'bg':
                    // data is static array
                    return __prop._world_bg[ix]
                case 'fg':
                    // data is object
                    d = __prop._wrel_.get('fg')
                    if (d){
                        if (!d[ix] && unrevealed){
                            if (revealing){
                                d[ix] = d['_' + ix]
                                d['_' + ix] = undefined
                                return d[ix];
                            }
                            return d['_' + ix]
                        }
                        return d[ix]
                    }
                }
                return;
            case 4:
            case 6:
                ix = SZ_REGION_ENVIRON * wrel[-1+wrel.length] + wrel[-2+wrel.length];
                k = wrel.slice(0,-2).join('_')
                switch(type){
                case 'bg':
                    // data is array because all used. wrel key prefixable (unrevealed).
                    d = __prop._wrel_.get(k)
                    if (!d && unrevealed){
                        d = __prop._wrel_.get('_' + k)
                        if (d && revealing){
                            console.log('saving', k)
                            __prop._wrel_.set(k, d)
                            __prop._wrel_.delete('_' + k)
                        }
                    }
                    if (d)
                        return d[ix];
                    break;
                case 'mg':
                case 'fg':
                    // data is object because gaps. wrel key never prefixed. index keys (unrevealed) prefixable.
                    if (type == 'mg')
                        k += '_m';
                    else
                        k += '_f';

                    d = __prop._wrel_.get(k)
                    if (d && !d[ix] && unrevealed){
                        if (d['_' + ix] && revealing){
                            d[ix] = d['_' + ix]
                            d['_' + ix] = undefined;
                            return d[ix]
                        }
                        return d['_' + ix]
                    }
                    if (d)
                        return d[ix]
                    break;
                }
                return;
            case 8:
                // console.log('WIP get locale [bg, mg, fg]')
            }
        },
        __wrel_get_bg: function(wrel, unrevealed, revealing){
            return __action.__wrel_get_(wrel, 'bg', unrevealed, revealing)
        },
        __wrel_get_mg: function(wrel, unrevealed, revealing){
            return __wrel_get_(wrel, 'mg', unrevealed, revealing)
        },
        __wrel_get_fg: function(wrel, unrevealed, revealing){
            return __wrel_get_(wrel, 'fg', unrevealed, revealing)
        },
        __wrel_get_bg_name: function(wrel){
            switch(__action.__wrel_get_bg(wrel, true).toLowerCase()){
            case 'c': return 'craig'
            case 'w': return 'water'
            case 'i': return 'ice'
            case 'm': return 'mountain'
            case 's': return 'swamp'
            case 'd': return 'desert'
            case 'j': return 'jungle'
            case 'g': return 'grass'
            case 'f': return 'forest'
            }
        },

        __wrel_move_up: function(wrel){
            // result not fully ensured
            if (!(wrel = __action.ensure_wrel(wrel)))
                return null;

            wrel = Array.from(wrel)

            switch (wrel.length){
                case 2:
                    if (!(wrel[1] >= 0 && wrel[1] <= MX_WORLD_Y)){
                        return null
                    }else if (!wrel[1])
                        wrel[1] = MX_WORLD_Y
                    else
                        wrel[1] -= 1
                    break;
                case 4:
                    if (!(wrel[3] >= 0 && wrel[3] <= MX_REGION_ENVIRON)){
                        return null
                    }else if (!wrel[3]){
                        wrel[3] = MX_REGION_ENVIRON
                        if (!(wrel[1] >= 0 && wrel[1] <= MX_WORLD_Y)){
                            return null
                        }else if (!wrel[1])
                            wrel[1] = MX_WORLD_Y
                        else
                            wrel[1] -= 1
                    }else
                        wrel[3] -= 1
                    break;
                case 6:
                    if (!(wrel[5] >= 0 && wrel[5] <= MX_REGION_ENVIRON)){
                        return null
                    }else if (!wrel[5]){
                        wrel[5] = MX_REGION_ENVIRON
                        if (!(wrel[3] >= 0 && wrel[3] <= MX_REGION_ENVIRON)){
                            return null
                        }else if (!wrel[3]){
                            wrel[3] = MX_REGION_ENVIRON
                            if (!(wrel[1] >= 0 && wrel[1] <= MX_WORLD_Y)){
                                return null
                            }else if (!wrel[1])
                                wrel[1] = MX_WORLD_Y
                            else
                                wrel[1] -= 1
                        }else
                            wrel[3] -= 1
                    }else
                        wrel[5] -= 1
                    break;
                case 8:
                    if (!(wrel[7] > 0 && wrel[7] <= MX_LOCALE_Y))
                        return null
                    else
                        wrel[7] -= 1
                    break;
                default:
                    return
            }
            return wrel
        },
        __wrel_move_left: function(wrel){
            // result not fully ensured
            if (!(wrel = __action.ensure_wrel(wrel)))
                return null;

            wrel = Array.from(wrel)

            switch (wrel.length){
                case 2:
                    if (!(wrel[0] >= 0 && wrel[0] <= MX_WORLD_X)){
                        return null
                    }else if (!wrel[0])
                        wrel[0] = MX_WORLD_X
                    else
                        wrel[0] -= 1
                    break;
                case 4:
                    if (!(wrel[2] >= 0 && wrel[2] <= MX_REGION_ENVIRON)){
                        return null
                    }else if (!wrel[2]){
                        wrel[2] = MX_REGION_ENVIRON
                        if (!(wrel[0] >= 0 && wrel[0] <= MX_WORLD_X)){
                            return null
                        }else if (!wrel[0])
                            wrel[0] = MX_WORLD_X
                        else
                            wrel[0] -= 1
                    }else
                        wrel[2] -= 1
                    break;
                case 6:
                    if (!(wrel[4] >= 0 && wrel[4] <= MX_REGION_ENVIRON)){
                        return null
                    }else if (!wrel[4]){
                        wrel[4] = MX_REGION_ENVIRON
                        if (!(wrel[2] >= 0 && wrel[2] <= MX_REGION_ENVIRON)){
                            return null
                        }else if (!wrel[2]){
                            wrel[2] = MX_REGION_ENVIRON
                            if (!(wrel[0] >= 0 && wrel[0] <= MX_WORLD_X)){
                                return null
                            }else if (!wrel[0])
                                wrel[0] = MX_WORLD_X
                            else
                                wrel[0] -= 1
                        }else
                            wrel[2] -= 1
                    }else
                        wrel[4] -= 1
                    break;
                case 8:
                    if (!(wrel[6] > 0 && wrel[6] <= MX_LOCALE_X))
                        return null
                    else
                        wrel[6] -= 1
                    break;
                default:
                    return
            }
            return wrel
        },
        __wrel_move_down: function(wrel){
            // result not fully ensured
            if (!(wrel = __action.ensure_wrel(wrel)))
                return null;

            wrel = Array.from(wrel)

            switch (wrel.length){
                case 2:
                    if (!(wrel[1] >= 0 && wrel[1] <= MX_WORLD_Y)){
                        return null
                    }else if (wrel[1] == MX_WORLD_Y)
                        wrel[1] = 0
                    else
                        wrel[1] += 1
                    break;
                case 4:
                    if (!(wrel[3] >= 0 && wrel[3] <= MX_REGION_ENVIRON)){
                        return null
                    }else if (wrel[3] == MX_REGION_ENVIRON){
                        wrel[3] = 0
                        if (!(wrel[1] >= 0 && wrel[1] <= MX_WORLD_Y)){
                            return null
                        }else if (wrel[1] == MX_WORLD_Y)
                            wrel[1] = 0
                        else
                            wrel[1] += 1
                    }else
                        wrel[3] += 1
                    break;
                case 6:
                    if (!(wrel[5] >= 0 && wrel[5] <= MX_REGION_ENVIRON)){
                        return null
                    }else if (wrel[5] == MX_REGION_ENVIRON){
                        wrel[5] = 0
                        if (!(wrel[3] >= 0 && wrel[3] <= MX_REGION_ENVIRON)){
                            return null
                        }else if (wrel[3] == MX_REGION_ENVIRON){
                            wrel[3] = 0
                            if (!(wrel[1] >= 0 && wrel[1] <= MX_WORLD_Y)){
                                return null
                            }else if (wrel[1] == MX_WORLD_Y)
                                wrel[1] = 0
                            else
                                wrel[1] += 1
                        }else
                            wrel[3] += 1
                    }else
                        wrel[5] += 1
                    break;
                case 8:
                    if (!(wrel[7] >= 0 && wrel[7] < MX_LOCALE_Y))
                        return null
                    else
                        wrel[7] += 1
                    break;
                default:
                    return
            }
            return wrel
        },
        __wrel_move_right: function(wrel){
            // result not fully ensured
            if (!(wrel = __action.ensure_wrel(wrel)))
                return null;

            wrel = Array.from(wrel)

            switch (wrel.length){
                case 2:
                    if (!(wrel[0] >= 0 && wrel[0] <= MX_WORLD_X)){
                        return null
                    }else if (wrel[0] == MX_WORLD_X)
                        wrel[0] = 0
                    else
                        wrel[0] += 1
                    break;
                case 4:
                    if (!(wrel[2] >= 0 && wrel[2] <= MX_REGION_ENVIRON)){
                        return null
                    }else if (wrel[2] == MX_REGION_ENVIRON){
                        wrel[2] = 0
                        if (!(wrel[0] >= 0 && wrel[0] <= MX_WORLD_X)){
                            return null
                        }else if (wrel[0] == MX_WORLD_X)
                            wrel[0] = 0
                        else
                            wrel[0] += 1
                    }else
                        wrel[2] += 1
                    break;
                case 6:
                    if (!(wrel[4] >= 0 && wrel[4] <= MX_REGION_ENVIRON)){
                        return null
                    }else if (wrel[4] == MX_REGION_ENVIRON){
                        wrel[4] = 0
                        if (!(wrel[2] >= 0 && wrel[2] <= MX_REGION_ENVIRON)){
                            return null
                        }else if (wrel[2] == MX_REGION_ENVIRON){
                            wrel[2] = 0
                            if (!(wrel[0] >= 0 && wrel[0] <= MX_WORLD_X)){
                                return null
                            }else if (wrel[0] == MX_WORLD_X)
                                wrel[0] = 0
                            else
                                wrel[0] += 1
                        }else
                            wrel[2] += 1
                    }else
                        wrel[4] += 1
                    break;
                case 8:
                    if (!(wrel[6] >= 0 && wrel[6] < MX_LOCALE_X))
                        return null
                    else
                        wrel[6] += 1
                    break;
                default:
                    return
            }
            return wrel
        },
         __wrel_move_dir: function(wrel, dir){
            switch(dir){
            case 'u': return __action.__wrel_move_up(wrel)
            case 'd': return __action.__wrel_move_down(wrel)
            case 'l': return __action.__wrel_move_left(wrel)
            case 'r': return __action.__wrel_move_right(wrel)
            }
        },

        __wrel_get_bgs: function(wrel){
            let res
            if (wrel = __action.ensure_wrel(wrel)){
                switch (wrel.length){
                case 2: 
                    res = __action.__wrel_get_bg(wrel, true); 
                    break;
                case 4: 
                    res = __action.__wrel_get_bg(wrel.slice(0,2), true).toLowerCase() +
                          __action.__wrel_get_bg(wrel.slice(0,4), true); 
                    break; 
                case 6: 
                    res = __action.__wrel_get_bg(wrel.slice(0,2), true).toLowerCase() +
                          __action.__wrel_get_bg(wrel.slice(0,4), true).toLowerCase() + 
                          __action.__wrel_get_bg(wrel.slice(0,6), true);
                    break; 
                case 8: 
                    debugger
                    res = __action.__wrel_get_bg(wrel.slice(0,2), true).toLowerCase() +
                          __action.__wrel_get_bg(wrel.slice(0,4), true).toLowerCase() + 
                          __action.__wrel_get_bg(wrel.slice(0,6), true) + 
                          __action.__wrel_get_bg(wrel.slice(0,8), true).b;
                    break; 
                }
            }
            if (!res && wrel){
                console.log(wrel)
                debugger;

            }
            return res
        },
        __wrel_get_bg_grid9: function(wrel, jump){
            // get unrevealed but not revealing
            var grid = Array(9)

            if (!(wrel = __action.ensure_wrel(wrel)))
                return grid;

            let u = __action.__wrel_move_up(wrel), 
                d = __action.__wrel_move_down(wrel),
                l = __action.__wrel_move_left(wrel), 
                r = __action.__wrel_move_right(wrel),
                skip = new Set(),
                mx, my, len = wrel.length;

            switch(len){
            case 2:
                mx = MX_WORLD_X
                my = MX_WORLD_Y
                break;
            case 4:
            case 6:
                mx = MX_REGION_ENVIRON
                my = MX_REGION_ENVIRON
                break;
            case 8:
                mx = MX_LOCALE_X
                my = MX_LOCALE_Y
                break;
            }

            if (!wrel[len-2] && !jump){
                skip.add('l')
                skip.add('ul')
                skip.add('dl')
            }
            if (!wrel[len-1] && !jump){
                skip.add('u')
                skip.add('ul')
                skip.add('ur')
            }
            if (wrel[len-2] == mx && !jump){
                skip.add('r')
                skip.add('ur')
                skip.add('dr')
            }
            if (wrel[len-1] == my && !jump){
                skip.add('d')
                skip.add('dl')
                skip.add('dr')
            }
            if (!skip.has('ul')) grid[0] = __action.__wrel_get_bg(__action.__wrel_move_left(u), true)
            if (!skip.has('u'))  grid[1] = __action.__wrel_get_bg(u, true)
            if (!skip.has('ur')) grid[2] = __action.__wrel_get_bg(__action.__wrel_move_right(u), true)
            if (!skip.has('l'))  grid[3] = __action.__wrel_get_bg(l, true)
            grid[4] = __action.__wrel_get_bg(wrel, true)
            if (!skip.has('r'))  grid[5] = __action.__wrel_get_bg(r, true)
            if (!skip.has('dl')) grid[6] = __action.__wrel_get_bg(__action.__wrel_move_left(d), true)
            if (!skip.has('d'))  grid[7] = __action.__wrel_get_bg(d, true)
            if (!skip.has('dr')) grid[8] = __action.__wrel_get_bg(__action.__wrel_move_right(d), true)

            return grid;
        },
        __map81_get_xy: function(map, xy){
            try{
                return map[9*xy[1]+xy[0]]
            }catch(e){}
        },
        __bg_is_road: function(bg){
            try{
                return (bg != bg.toLowerCase());
            }catch(e){}
        },
        __map81_xy_grid9: function(map, xy){
            // fail empty or part array
            var res = Array(9)

            try{
                res[1] = map[9*(-1+xy[1]) + 0+ xy[0]]
                res[4] = map[9*(xy[1]) + 0+ xy[0]]
                res[7] = map[9*(1+xy[1]) + 0+ xy[0]]
                if (xy[0]){
                    res[0] = map[9*(-1+xy[1]) + -1+ xy[0]]
                    res[3] = map[9*(xy[1]) + -1+ xy[0]]
                    res[6] = map[9*(1+xy[1]) + -1+ xy[0]]
                }
                if (xy[0] < MX_REGION_ENVIRON){
                    res[2] = map[9*(-1+xy[1]) + 1+ xy[0]]
                    res[5] = map[9*(xy[1]) + 1+ xy[0]]
                    res[8] = map[9*(1+xy[1]) + 1+ xy[0]]
                }
            }catch(e){}

            return res;
        },
        __map81_xy_grid9_sides: function(map, xy){
            // fail empty or part array
            var res = Array(9)

            try{
                res[1] = map[9*(-1+xy[1]) + 0+ xy[0]]
                res[4] = map[9*(xy[1]) + 0+ xy[0]]
                res[7] = map[9*(1+xy[1]) + 0+ xy[0]]
                if (xy[0]){
                    res[3] = map[9*(xy[1]) + -1+ xy[0]]
                }
                if (xy[0] < MX_REGION_ENVIRON){
                    res[5] = map[9*(xy[1]) + 1+ xy[0]]
                }
            }catch(e){}
            return res;
        },
        __map81_is_xy_road: function(map, xy){
            return __action.__bg_is_road(__action.__map81_get_xy(map, xy));
        },
        __map81_is_xy_nonroad: function(map, xy){
            return false === __action.__bg_is_road(__action.__map81_get_xy(map, xy));
        },
        __xy9_get_dir: function(xy, dir){
            try{
                switch(dir){
                case 'u': return xy[1]?    [xy[0],-1+xy[1]]: null;
                case 'd': return xy[1]!=8? [xy[0], 1+xy[1]]: null;
                case 'l': return xy[0]?    [-1+xy[0],xy[1]]: null;
                case 'r': return xy[0]!=8? [ 1+xy[0],xy[1]]: null;
                }
            }catch(e){}
        },
        scroll_dom_to_center: function(dom){
            if (!dom)
                return;
            let scroll = dom.parentElement
            while (scroll && !scroll.scrollTopMax && !scroll.scrollLeftMax){
                scroll = scroll.parentElement;
            }
            if (!scroll)
                return;
            let v = {dom: dom.getBoundingClientRect(), scroll: scroll.getBoundingClientRect()}
            v.dy = v.dom.y + (v.dom.height/2) - v.scroll.y - (v.scroll.height/2)
            v.dx = v.dom.x + (v.dom.width/2) - v.scroll.x - (v.scroll.width/2)
            scroll.scrollTop += v.dy
            scroll.scrollLeft += v.dx
        },
        __RegionCell_focus_zoom_environ: function(){
            if (this.classList.contains('focus')){
                __prop._wrel = [this.wx, this.wy, this.rx, this.ry]
                __action.set_state('environ')
                return
            }
            let wrel = __prop._wrel || []
            if (this.wx != wrel[0] || this.wy != wrel[1]){
                __prop._wrel = [this.wx, this.wy, this.rx, this.ry]
                __action.set_state('region', true)
                return
            }
            if (__prop._focus_dsp)
                __prop._focus_dsp.classList.remove('focus')
            __prop._focus_dsp = this
            this.classList.add('focus')
            __action.scroll_dom_to_center(this)
        },
        __EnvironCell_focus_zoom_locale: function(){
            if (this.classList.contains('focus')){
                __prop._wrel = [this.wx, this.wy, this.rx, this.ry, this.ex, this.ey]
                __action.set_state('locale')
                return
            }
            let wrel = __prop._wrel || []
            if (this.wx != wrel[0] || this.wy != wrel[1] 
                ||this.rx != wrel[2] || this.ry != wrel[3]){
                __prop._wrel = [this.wx, this.wy, this.rx, this.ry, this.ex, this.ey]
                __action.set_state('environ', true)
                return
            }
            if (__prop._focus_dsp)
                __prop._focus_dsp.classList.remove('focus')
            __prop._focus_dsp = this
            this.classList.add('focus')
            __action.scroll_dom_to_center(this)
        },
        __LocaleCell_viewing_focus: function(evt){
            let wrel = __prop._wrel.slice(0,6).concat([this.lx, this.ly])
            let info = __prop._ground_info = __action.__wrel_get_(wrel)
            if(LOG_SELECT_LOCALE_TILE) console.log('locale, __wrel_get_/=>info, this :::', wrel, info, this)

            if(this.classList.contains('viewing') || evt && evt.detail == 2){
                // on 2nd-click or double-click, set focus
                if (__prop._focus_dsp)
                    __prop._focus_dsp.classList.remove('focus')
                __prop._focus_dsp = this
                this.classList.add('focus')
                if (__prop._viewing_dsp)
                    __prop._viewing_dsp.classList.remove('viewing')
                __prop._viewing_dsp = null
            }else if (this.classList.contains('focus')){
                // click focus, clear viewing
                __prop._viewing_dsp.classList.remove('viewing')
                __prop._viewing_dsp = null
            }else{
                // click other. set viewing
                if (__prop._viewing_dsp)
                    __prop._viewing_dsp.classList.remove('viewing')
                __prop._viewing_dsp = this
                this.classList.add('viewing')
            }

            __action.scroll_dom_to_center(this)
        },

        __mapgen: function(res, opts, grid){
            let debug = null

            const sp_a_0_r = 16, sp_a_1_r = 12, sp_a_2_r = 8, sp_a_3_r = 4,
                sp_side_r = 14, sp_corn_r = 6,
                sp_b_b_r = 20,
                cl_r = 3, cl_4_n = 25, cl_5_n = 13, cl_6_n = 5,
                ln_r = 2, ln_7_r = 20, ln_8_r = 14, ln_9_r = 8

            // gen_bg: [ sp16, sp12, sp8, sp4,  cl25, cl13, cl5,  ln20, ln14, ln9]
            let alts = __prop._gen_bg_[ grid[4].toLowerCase() ],
                rem

            if (grid[4] == grid[4].toUpperCase() ){
                // generating roads reveal adjacent non-roads
                let nexts = []
                if (grid[1] && grid[1] != grid[1].toUpperCase()){
                    nexts.push(__action.__wrel_move_up(opts.wrel))
                }
                if (grid[3] && grid[3] != grid[3].toUpperCase()){
                    nexts.push(__action.__wrel_move_left(opts.wrel))
                }
                if (grid[5] && grid[5] != grid[5].toUpperCase()){
                    nexts.push(__action.__wrel_move_right(opts.wrel))
                }
                if (grid[7] && grid[7] != grid[7].toUpperCase()){
                    nexts.push(__action.__wrel_move_down(opts.wrel))
                }
                if (nexts.length)
                    setTimeout(()=>{
                        while(nexts.length){
                            __prop._wrel_.set(nexts[0].join('_'),
                            select.generate_(
                                (nexts[0].length == 2? 'Region': 'Environ'), 
                                {wrel:nexts.shift()}))
                        }}, 5)
            }
            grid = grid.map((i)=>i&&i.toLowerCase())

            // 1) paint bg.
            for (let i=0; i<81; i++){
                res[i] = grid[4]
            }

            // 2) splash a
            if (alts[0]){
                rem = __action.result_roll(sp_a_0_r)
                while (rem--){
                    res[ __action.pick_in_range(81) ] = alts[0]
                }
            }
            if (alts[1]){
                rem = __action.result_roll(sp_a_1_r)
                while (rem--){
                    res[ __action.pick_in_range(81) ] = alts[1]
                }
            }
            if (alts[2]){
                rem = __action.result_roll(sp_a_2_r)
                while (rem--){
                    res[ __action.pick_in_range(81) ] = alts[2]
                }
            }
            if (alts[3]){
                rem = __action.result_roll(sp_a_3_r)
                while (rem--){
                    res[ __action.pick_in_range(81) ] = alts[3]
                }
            }

            // 3) splash sides
            rem = __action.result_roll(sp_side_r)
            while (rem--){
                res[ 9 * __action.pick_in_range(4) + __action.pick_in_range(9) ] = grid[1]
            }
            rem = __action.result_roll(sp_side_r)
            while (rem--){
                res[ 9 * __action.pick_in_range(9) + __action.pick_in_range(4) ] = grid[3]
            }
            rem = __action.result_roll(sp_side_r)
            while (rem--){
                res[ 9 * __action.pick_in_range(9) + 5 + __action.pick_in_range(4) ] = grid[5]
            }
            rem = __action.result_roll(sp_side_r)
            while (rem--){
                res[ 9 * (5 + __action.pick_in_range(4)) + __action.pick_in_range(9) ] = grid[7]
            }

            // 4) splash corners if match a neighbor
            if (grid[0] == grid[1] || grid[0] == grid[3]){
                rem = __action.result_roll(sp_corn_r)
                while (rem--){
                    res[ 9 * (__action.pick_in_range(4)) + __action.pick_in_range(4) ] = grid[0]
                }
            }
            if (grid[2] == grid[1] || grid[2] == grid[5]){
                rem = __action.result_roll(sp_corn_r)
                while (rem--){
                    res[ 9 * (__action.pick_in_range(4)) + 5 + __action.pick_in_range(4) ] = grid[2]
                }
            }
            if (grid[6] == grid[3] || grid[6] == grid[7]){
                rem = __action.result_roll(sp_corn_r)
                while (rem--){
                    res[ 9 * (5 + __action.pick_in_range(4)) + __action.pick_in_range(4) ] = grid[6]
                }
            }
            if (grid[8] == grid[5] || grid[8] == grid[7]){
                rem = __action.result_roll(sp_corn_r)
                while (rem--){
                    res[ 9 * (5 + __action.pick_in_range(4)) + 5 + __action.pick_in_range(4) ] = grid[8]
                }
            }

            // 5) splash b bg
            rem = __action.result_roll(sp_b_b_r)
            while (rem--){
                res[ __action.pick_in_range(81) ] = grid[4]
            }

            // 6) cluster
            if (alts[4] && !__action.pick_in_range(cl_r)){
                rem = {
                    n: cl_4_n, 
                    d: 5,
                }
                rem.bx = -rem.d + __action.result_roll(SZ_REGION_ENVIRON) 
                rem.by = -rem.d + __action.result_roll(SZ_REGION_ENVIRON) 
                while(rem.n--){
                    rem.x = rem.bx + __action.result_roll(rem.d)
                    if (!(rem.x >= 0 && rem.x < SZ_REGION_ENVIRON))
                        continue;
                    rem.y = rem.by + __action.result_roll(rem.d)
                    if (!(rem.y >= 0 && rem.y < SZ_REGION_ENVIRON))
                        continue;
                    res[ SZ_REGION_ENVIRON * rem.y + rem.x ] = alts[4]
                }
            }
            if (alts[5] && !__action.pick_in_range(cl_r)){
                rem = {
                    n: cl_5_n, 
                    d: 4,
                }
                rem.bx = -rem.d + __action.result_roll(SZ_REGION_ENVIRON) 
                rem.by = -rem.d + __action.result_roll(SZ_REGION_ENVIRON) 
                while(rem.n--){
                    rem.x = rem.bx + __action.result_roll(rem.d)
                    if (!(rem.x >= 0 && rem.x < SZ_REGION_ENVIRON))
                        continue;
                    rem.y = rem.by + __action.result_roll(rem.d)
                    if (!(rem.y >= 0 && rem.y < SZ_REGION_ENVIRON))
                        continue;
                    res[ SZ_REGION_ENVIRON * rem.y + rem.x ] = alts[5]
                }
            }
            if (alts[6] && !__action.pick_in_range(cl_r)){
                rem = {
                    n: cl_6_n, 
                    d: 3,
                }
                rem.bx = -rem.d + __action.result_roll(SZ_REGION_ENVIRON) 
                rem.by = -rem.d + __action.result_roll(SZ_REGION_ENVIRON) 
                while(rem.n--){
                    rem.x = rem.bx + __action.result_roll(rem.d)
                    if (!(rem.x >= 0 && rem.x < SZ_REGION_ENVIRON))
                        continue;
                    rem.y = rem.by + __action.result_roll(rem.d)
                    if (!(rem.y >= 0 && rem.y < SZ_REGION_ENVIRON))
                        continue;
                    res[ SZ_REGION_ENVIRON * rem.y + rem.x ] = alts[6]
                }
            }

            // 7) lines. prevailing direction (+- 1). like ul-U-ur or u-UR-r
            if (alts[7] && !__action.pick_in_range(ln_r)){
                rem = {
                    dir: __action.pick_in_range(8), 
                    n: __action.result_roll(ln_7_r),
                }
                // can start offscreen and move on
                rem.x = __action.result_roll([-(rem.n-3), rem.n-3, SZ_REGION_ENVIRON], 1) 
                rem.y = __action.result_roll([-(rem.n-3), rem.n-3, SZ_REGION_ENVIRON], 1) 
                while(rem.n--){
                    rem.d = rem.dir - 2 + __action.result_roll(3)
                    switch(rem.d){
                    case 0: case 8: rem.y -= 1; break;
                    case 1: rem.y -= 1; rem.x += 1; break;
                    case 2:             rem.x += 1; break;
                    case 3: rem.y += 1; rem.x += 1; break;
                    case 4: rem.y += 1;             break;
                    case 5: rem.y += 1; rem.x -= 1; break;
                    case 6:             rem.x -= 1; break;
                    case 7: rem.y -= 1; rem.x -= 1; break;
                    }

                    if (!(rem.x >= 0 && rem.x < SZ_REGION_ENVIRON))
                        continue;
                    if (!(rem.y >= 0 && rem.y < SZ_REGION_ENVIRON))
                        continue;
                    res[ SZ_REGION_ENVIRON * rem.y + rem.x ] = alts[7]
                }
            }
            if (alts[8] && !__action.pick_in_range(ln_r)){
                rem = {
                    dir: __action.pick_in_range(8), 
                    n: __action.result_roll(ln_8_r),
                }
                rem.x = __action.result_roll([-(rem.n-3), rem.n-3, SZ_REGION_ENVIRON], 1) 
                rem.y = __action.result_roll([-(rem.n-3), rem.n-3, SZ_REGION_ENVIRON], 1) 
                while(rem.n--){
                    rem.d = rem.dir - 2 + __action.result_roll(3)
                    switch(rem.d){
                    case 0: case 8: rem.y -= 1; break;
                    case 1: rem.y -= 1; rem.x += 1; break;
                    case 2:             rem.x += 1; break;
                    case 3: rem.y += 1; rem.x += 1; break;
                    case 4: rem.y += 1;             break;
                    case 5: rem.y += 1; rem.x -= 1; break;
                    case 6:             rem.x -= 1; break;
                    case 7: rem.y -= 1; rem.x -= 1; break;
                    }

                    if (!(rem.x >= 0 && rem.x < SZ_REGION_ENVIRON))
                        continue;
                    if (!(rem.y >= 0 && rem.y < SZ_REGION_ENVIRON))
                        continue;
                    res[ SZ_REGION_ENVIRON * rem.y + rem.x ] = alts[8]
                }
            }
            if (alts[9] && !__action.pick_in_range(ln_r)){
                rem = {
                    dir: __action.pick_in_range(8), 
                    n: __action.result_roll(ln_9_r),
                }
                rem.x = __action.result_roll([-(rem.n-3), rem.n-3, SZ_REGION_ENVIRON], 1) 
                rem.y = __action.result_roll([-(rem.n-3), rem.n-3, SZ_REGION_ENVIRON], 1) 
                while(rem.n--){
                    rem.d = rem.dir - 2 + __action.result_roll(3)
                    switch(rem.d){
                    case 0: case 8: rem.y -= 1; break;
                    case 1: rem.y -= 1; rem.x += 1; break;
                    case 2:             rem.x += 1; break;
                    case 3: rem.y += 1; rem.x += 1; break;
                    case 4: rem.y += 1;             break;
                    case 5: rem.y += 1; rem.x -= 1; break;
                    case 6:             rem.x -= 1; break;
                    case 7: rem.y -= 1; rem.x -= 1; break;
                    }

                    if (!(rem.x >= 0 && rem.x < SZ_REGION_ENVIRON))
                        continue;
                    if (!(rem.y >= 0 && rem.y < SZ_REGION_ENVIRON))
                        continue;
                    res[ SZ_REGION_ENVIRON * rem.y + rem.x ] = alts[9]
                }
            }

            // 8) side water requires water at corners (to traverse diagonal waters)
            const set_water = function(xy){
                let x = 9*xy[1] + xy[0]
                if (res[x] == res[x].toUpperCase()){
                    res[x] = 'W'
                }else{
                    res[x] = 'w'
                }
            }
            // grid all lowercase
            if ('w' == grid[1]){
                set_water([0,0])
                set_water([8,0])
            }
            if ('w' == grid[3]){
                set_water([0,0])
                set_water([0,8])
            }
            if ('w' == grid[5]){
                set_water([8,0])
                set_water([8,8])
            }
            if ('w' == grid[7]){
                set_water([0,8])
                set_water([8,8])
            }

            // 9) water tile. tunnel water from each corner to center. random.
            if ('w' == grid[4]){
                rem = {}
                for (let g of [[[0,0],[4,4]], [[0,8],[4,4]], [[8,0],[4,4]], [[8,8],[4,4]]]){
                    rem.at = g.shift()
                    set_water(rem.at)
                    while(g.length){
                        if (rem.at[0] > g[0][0]){
                            rem.dirs = ['l']
                        }else if (rem.at[0] < g[0][0]){
                            rem.dirs = ['r']
                        }else{
                            rem.dirs = ['l', 'r']
                        }
                        if (rem.at[1] > g[0][1]){
                            rem.dirs.push('u')
                        }else if (rem.at[1] < g[0][1]){
                            rem.dirs.push('d')
                        }else{
                            if (rem.dirs.length == 2)
                                break;
                            rem.dirs.push('u')
                            rem.dirs.push('d')
                        }
                        set_water(rem.at = __action.__xy9_get_dir(rem.at, __action.pick_from_items(rem.dirs)))
                    }
                }
            }

            // 10) primary roads opts: { rdx rdy rd0 rd1, rd2, rdgx, rdgy => rd1end, rd2end } 
            if (opts.rd1){
                if(debug)console.log('preroad map:', res, grid)

                // .a) goals. for turn, add goal near the middle for better normal length. for straight, edge anywhere. with r2, 2 goals (either 1 road from middle, or forked from edge, or from a corner as 4 way))
                rem = { g: [ [opts.rdx, opts.rdy] ] }
                rem.ix = SZ_REGION_ENVIRON*rem.g[0][1] + rem.g[0][0]
                res[rem.ix] = res[rem.ix].toUpperCase()
                if(debug != null)console.log('set road 1 init', rem.g[0])
                opts.rd1path = ''
                if (opts.rd2){
                    // fork. step rd2 once to get away. make rd1 first
                    opts.rd2path = opts.rd2
                    rem.g2 = [ Array.from(rem.g[0]) ]
                    // rd2 is always straight (from auto 2nd step in zone)
                    switch(opts.rd2){
                    case 'u': rem.g2[0][1] -= 1; rem.g2.push([null, 0]); break;
                    case 'd': rem.g2[0][1] += 1; rem.g2.push([null, 8]); break;
                    case 'l': rem.g2[0][0] -= 1; rem.g2.push([0, null]); break;
                    case 'r': rem.g2[0][0] += 1; rem.g2.push([8, null]); break;
                    }
                    rem.ix = 9*rem.g2[0][1] + rem.g2[0][0]
                    res[rem.ix] = res[rem.ix].toUpperCase()
                    if(debug != null)console.log('set road 2 init', rem.g2[0])
                }
                if (opts.rdgx != null){
                    // use single static exit for road 1 direction
                    rem.g.push([opts.rdgx, opts.rdgy])
                }else{
                    // insert turn mid-goals.
                    switch(opts.rd0){
                    case 'u':
                        switch(opts.rd1){
                            case 'd': rem.g.push([null, 8]); break;
                            case 'l':
                                rem.g.push([2,2]);
                                rem.g.push([0, null]); 
                                break;
                            case 'r': 
                                rem.g.push([6,2]);
                                rem.g.push([8, null]); 
                                break;
                        }
                        break;
                    case 'd':
                        switch(opts.rd1){
                            case 'u': rem.g.push([null, 0]); break;
                            case 'l': 
                                rem.g.push([2,6]);
                                rem.g.push([0, null]); 
                                break;
                            case 'r': 
                                rem.g.push([6,6]);
                                rem.g.push([8, null]); 
                                break;
                        }
                        break;
                    case 'l':
                        switch(opts.rd1){
                            case 'r': rem.g.push([8, null]); break;
                            case 'u': 
                                rem.g.push([2,2]);
                                rem.g.push([null, 0]); 
                                break;
                            case 'd': 
                                rem.g.push([2,6]);
                                rem.g.push([null, 8]); 
                                break;
                        }
                        break;
                    case 'r':
                        switch(opts.rd1){
                            case 'l': rem.g.push([0, null]); break;
                            case 'u': 
                                rem.g.push([6,2]);
                                rem.g.push([null, 0]); 
                                break;
                            case 'd': 
                                rem.g.push([6,6]);
                                rem.g.push([null, 8]); 
                                break;
                        }
                        break;
                    }
                }
                // road 2 is always straight/1-goal

                const next_step = function(g, never){
                    rem.dirs = new Set(['u', 'd','l','r'])
                    rem.dirs.delete(never)
                    switch(rem.lastdir){
                    case 'u': rem.dirs.delete('d'); break;
                    case 'l': rem.dirs.delete('r'); break;
                    case 'r': rem.dirs.delete('l'); break;
                    case 'd': rem.dirs.delete('u'); break;
                    }
                    let sg, direct;
                    if (debug) console.log('try step from', rem.at, 'to goal', g[0].join('_'), __action.__map81_xy_grid9_sides(res, rem.at))
                    if (rem.dirs.has('u')){
                        sg = __action.__map81_xy_grid9_sides(res, __action.__xy9_get_dir(rem.at, 'u'))
                        if (!sg[4] || __action.__bg_is_road(sg[4]) ||
                            sg[1] && __action.__bg_is_road(sg[1]) || 
                            sg[3] && __action.__bg_is_road(sg[3]) || 
                            sg[5] && __action.__bg_is_road(sg[5])){
                            if (debug) console.log('up road rejected', sg, rem.at.join('_'). opts)
                            rem.dirs.delete('u')
                        }
                    }
                    if (rem.dirs.has('l')){
                        sg = __action.__map81_xy_grid9_sides(res, __action.__xy9_get_dir(rem.at, 'l'))
                        if (!sg[4] || __action.__bg_is_road(sg[4]) ||
                            sg[1] && __action.__bg_is_road(sg[1]) || 
                            sg[3] && __action.__bg_is_road(sg[3]) || 
                            sg[7] && __action.__bg_is_road(sg[7])){
                            if (debug) console.log('left road rejected', sg)
                            rem.dirs.delete('l')
                        }
                    }
                    if (rem.dirs.has('d')){
                        sg = __action.__map81_xy_grid9_sides(res, __action.__xy9_get_dir(rem.at, 'd'))
                        if (!sg[4] || __action.__bg_is_road(sg[4]) ||
                            sg[3] && __action.__bg_is_road(sg[3]) || 
                            sg[5] && __action.__bg_is_road(sg[5]) || 
                            sg[7] && __action.__bg_is_road(sg[7])){
                            if (debug) console.log('down road rejected,', sg)
                            rem.dirs.delete('d')
                        }
                    }
                    if (rem.dirs.has('r')){
                        sg = __action.__map81_xy_grid9_sides(res, __action.__xy9_get_dir(rem.at, 'r'))
                        if (!sg[4] || __action.__bg_is_road(sg[4]) ||
                            sg[1] && __action.__bg_is_road(sg[1]) || 
                            sg[5] && __action.__bg_is_road(sg[5]) || 
                            sg[7] && __action.__bg_is_road(sg[7])){
                            if (debug) console.log('right road rejected', sg)
                            rem.dirs.delete('r')
                        }
                    }

                    let xd = g[0][0] == null? null: g[0][0] - rem.at[0]
                    let yd = g[0][1] == null? null: g[0][1] - rem.at[1]
                    if (!xd){
                        if (yd > 0){
                            direct = 'd'
                            rem.dirs.delete('u')
                        }else{
                            direct = 'u'
                            rem.dirs.delete('d')
                        }
                        if (1 === Math.abs(yd)){
                            rem.lastdir = direct
                            g.shift()
                            if (debug) console.log('complete 1-dist road. ' + rem.lastdir);
                            rem.at = __action.__xy9_get_dir(rem.at, rem.lastdir)
                            return
                        }
                    }else if (!yd){
                        if (xd > 0){
                            direct = 'r'
                            rem.dirs.delete('l')
                        }else{
                            direct = 'l'
                            rem.dirs.delete('r')
                        }
                        if (1 === Math.abs(xd)){
                            rem.lastdir = direct
                            g.shift()
                            if (debug) console.log('complete 1-dist road. ' + rem.lastdir);
                            rem.at = __action.__xy9_get_dir(rem.at, rem.lastdir)
                            return
                        }
                    }else{
                        if (Math.abs(xd) > Math.abs(yd)){
                            if (xd > 0){
                                direct = 'r'
                                rem.dirs.delete('l')
                            }else{
                                direct = 'l'
                                rem.dirs.delete('r')
                            }
                        }else if (Math.abs(xd) == Math.abs(yd)){
                            if (yd > 0){
                                if (xd > 0){
                                    direct = __action.pick_from_items(['d', 'r'])
                                }else{
                                    direct = __action.pick_from_items(['d', 'l'])
                                }
                            }else{
                                if (xd > 0){
                                    direct = __action.pick_from_items(['u', 'r'])
                                }else{
                                    direct = __action.pick_from_items(['u', 'l'])
                                }
                            }
                        }else{
                            if (yd > 0){
                                direct = 'd'
                                rem.dirs.delete('u')
                            }else{
                                direct = 'u'
                                rem.dirs.delete('d')
                            }
                        }
                    }

                    if (rem.dirs.size == 1){
                        rem.lastdir = Array.from(rem.dirs)[0]
                        if (debug) console.log('single road option. ' + rem.lastdir);
                        rem.at = __action.__xy9_get_dir(rem.at, rem.lastdir)
                        return
                    }

                    const rand_bias = 2, direct_bias = 0
                    sg = __action.__map81_xy_grid9_sides(res, rem.at)

                    // any of remaining. add block bias plus direct-dist-bias plus random roll
                    rem.dirs = Array.from(rem.dirs).map((d)=>{
                        let ix, bias = __action.result_roll(rand_bias)
                        switch(d){
                        case 'u': ix = 1; bias += yd<0? (10+yd): -yd*2; break;
                        case 'l': ix = 3; bias += xd<0? (10+xd): -xd*2; break;
                        case 'r': ix = 5; bias += xd>0? (10-xd): xd*2; break;
                        case 'd': ix = 7; bias += yd>0? (10-yd): yd*2; break;
                        }
                        if (sg[ix]){
                            bias += __prop._block_rule_.road_bias[sg[ix]]
                            if (debug)console.log('dir bg bias xd yd direct', d, sg[ix], bias, xd, yd, direct);
                            if (d == direct){
                                bias += direct_bias;
                                // look-ahead-grid 2 dist. if 2 dist less bias than side neighbor (uu vs ul or ur) and that side also more bias(l vs u), reduce some dir-bias ()
                                let db;
                                switch(d){
                                case 'u': 
                                    db = __action.__map81_xy_grid9(res, [rem.at[0], -1+rem.at[1]])

                                    if (db[0] && __prop._block_rule_.road_bias[db[0]] > __prop._block_rule_.road_bias[db[1]] && __prop._block_rule_.road_bias[db[6]] > __prop._block_rule_.road_bias[db[4]]){
                                        db = null
                                    }else if (db[2] && __prop._block_rule_.road_bias[db[2]] > __prop._block_rule_.road_bias[db[1]] && __prop._block_rule_.road_bias[db[8]] > __prop._block_rule_.road_bias[db[4]]){
                                        db = null
                                    }
                                    if (!db){
                                        bias -= 0.5 * (10+yd);
                                    }
                                    break;
                                case 'd':
                                    db = __action.__map81_xy_grid9(res, [rem.at[0], 1+rem.at[1]])
                                    if (db[6] && __prop._block_rule_.road_bias[db[6]] > __prop._block_rule_.road_bias[db[7]] && __prop._block_rule_.road_bias[db[0]] > __prop._block_rule_.road_bias[db[4]]){
                                        db = null
                                    }else if (db[8] && __prop._block_rule_.road_bias[db[8]] > __prop._block_rule_.road_bias[db[7]] && __prop._block_rule_.road_bias[db[2]] > __prop._block_rule_.road_bias[db[4]]){
                                        db = null
                                    }
                                    if (!db){
                                        bias -= 0.5 * (10-yd);
                                    }
                                    break;
                                case 'l': 
                                    db = __action.__map81_xy_grid9(res, [rem.at[0] -1, rem.at[1]])
                                    if (db[0] && __prop._block_rule_.road_bias[db[0]] > __prop._block_rule_.road_bias[db[3]] && __prop._block_rule_.road_bias[db[2]] > __prop._block_rule_.road_bias[db[4]]){
                                        db = null
                                    }else if (db[6] && __prop._block_rule_.road_bias[db[6]] > __prop._block_rule_.road_bias[db[3]] && __prop._block_rule_.road_bias[db[8]] > __prop._block_rule_.road_bias[db[4]]){
                                        db = null
                                    }

                                    if (!db){
                                        bias -= 0.5 * (10+xd);
                                    }
                                    break;
                                case 'r': 
                                    db = __action.__map81_xy_grid9(res, [rem.at[0] +1, rem.at[1]])
                                    if (db[2] && __prop._block_rule_.road_bias[db[2]] > __prop._block_rule_.road_bias[db[5]] && __prop._block_rule_.road_bias[db[0]] > __prop._block_rule_.road_bias[db[4]]){
                                        db = null
                                    }else if (db[8] && __prop._block_rule_.road_bias[db[8]] > __prop._block_rule_.road_bias[db[5]] && __prop._block_rule_.road_bias[db[6]] > __prop._block_rule_.road_bias[db[4]]){
                                        db = null
                                    }
                                    if (!db){
                                        bias -= 0.5 * (10-xd);
                                    }
                                    break;
                                }
                            }
                        }
                        return [d, bias]
                    })

                    if (rem.dirs.length){
                        rem.lastdir = rem.dirs.sort( (a,b)=>(b[1]-a[1]) )[0][0]
                        if (debug)console.log('random road ' + rem.lastdir, rem.dirs);
                        rem.at = __action.__xy9_get_dir(rem.at, rem.lastdir)
                    }
                }
                for (let g of [rem.g, rem.g2||[]]){
                    if (!g.length)continue;
                    rem.at = g.shift()
                    rem.lastx = -1
                    if (rem.g2 == g){
                        rem.lastdir = opts.rd2
                    }else{
                        switch (opts.rd0){
                        case 'u': rem.lastdir = 'd'; break;
                        case 'd': rem.lastdir = 'u'; break;
                        case 'l': rem.lastdir = 'r'; break;
                        case 'r': rem.lastdir = 'l'; break;
                        }
                    }

                    rem.back = opts.rd0
                    rem.backpedal = false
                    while(g.length){
                        rem.backpedal? next_step(g): next_step(g, opts.back)
                        if (rem.at[0] == rem.lastx && rem.at[1] == rem.lasty){
                            if (!rem.backpedal){
                                rem.backpedal = true 
                                continue
                            }else if (g.length == 1){
                                // console.log('no final road found. critical error.');
                                // if(debug)debugger
                                rem.backpedal? next_step(g): next_step(g, opts.back)
                                throw('retry road')
                                break;
                            }else{
                                if (debug) console.log('no next road found. skip mid-goal.');
                                g.shift()
                                if (g.length == 1){
                                    switch(g==rem.g?opts.rd1: opts.rd2){
                                    case 'u': rem.back = 'd'; break;
                                    case 'd': rem.back = 'u'; break;
                                    case 'l': rem.back = 'r'; break;
                                    case 'r': rem.back = 'l'; break;
                                    }
                                }
                            }
                        }else{
                            rem.lastx = rem.at[0]
                            rem.lasty = rem.at[1]
                            rem.ix = 9*rem.at[1] + rem.at[0]
                            if(debug != null)console.log('SET road ' + rem.lastdir + ' at ' + rem.at + ' to from ' + res[rem.ix])
                            res[rem.ix] = res[rem.ix].toUpperCase()
                            if (g == rem.g){
                                opts.rd1path += rem.lastdir
                            }else{
                                opts.rd2path += rem.lastdir
                            }
                        }
                        rem.backpedal = false
                        if (!g.length){
                            if (g == rem.g){
                                opts.rd1path += opts.rd1
                                opts.rd1end = [ ...(opts.wrel.slice(0,4)), ...rem.at ]
                                if(debug != null)console.log('goal 1 end', opts.rd1end)
                            }else{
                                opts.rd2path += opts.rd2
                                opts.rd2end = [ ...(opts.wrel.slice(0,4)), ...rem.at ]
                                if(debug != null)console.log('goal 2 end', opts.rd2end)
                            }
                        }
                    }
                }
                if(debug != null)console.log('final generated road map', Array.from(opts.wrel), opts, res)
            }
        },
        _next_road_dir: function(wx, wy, rx, ry, from, stop_region_edge){
            let grid, first
            // world wraps, environ crosses region border unless stop_region_edge
            // => dirs semi-sort edge first

            if (rx == null){
                grid = __action.__wrel_get_bg_grid9([wx, wy], true)
                if (!wx) first = 'l';
                else if (!wy) first = 'u';
                else if (wx == MX_WORLD_X) first = 'r';
                else if(wy == MX_WORLD_Y) first = 'd';
            }else{
                grid = __action.__wrel_get_bg_grid9([wx, wy, rx, ry], !stop_region_edge)
                if (!rx) first = 'l';
                else if (!ry) first = 'u';
                else if (rx == MX_REGION_ENVIRON) first = 'r';
                else if(ry == MX_REGION_ENVIRON) first = 'd';
            }
            switch(from){
            case 'u': grid[1] = null; break;
            case 'l': grid[3] = null; break;
            case 'r': grid[5] = null; break;
            case 'd': grid[7] = null; break;
            }

            let dirs = []
            switch(first){
            case 'u': if (grid[1] && grid[1] == grid[1].toUpperCase()) dirs.push('u'); break;
            case 'l': if (grid[3] && grid[3] == grid[3].toUpperCase()) dirs.push('l'); break;
            case 'r': if (grid[5] && grid[5] == grid[5].toUpperCase()) dirs.push('r'); break;
            case 'd': if (grid[7] && grid[7] == grid[7].toUpperCase()) dirs.push('d'); break;
            }
            if (first !='u' && grid[1] && grid[1] == grid[1].toUpperCase()) dirs.push('u')
            if (first !='l' && grid[3] && grid[3] == grid[3].toUpperCase()) dirs.push('l')
            if (first !='r' && grid[5] && grid[5] == grid[5].toUpperCase()) dirs.push('r')
            if (first !='d' && grid[7] && grid[7] == grid[7].toUpperCase()) dirs.push('d')

            return dirs;
        },
        _init_road: function(wx, wy, rx, ry, rdrx, rdry, rdex, rdey, rd0, rd1path, rd2path, only_one){
            const debug = null
            // only_one must be exactly true to prevent zip to next region|environ to end of world|region.
            let dir, tmp, ix, rd12, next = {}, opts, rd1, rd2 
            if (rd1path){
                rd1 = rd1path[0]
                rd1path = rd1path.slice(1)
            }
            if (rd2path){
                rd2 = rd2path[0]
                rd2path = rd2path.slice(1)
            }
            if(debug)console.log('init_road', arguments)
            if (rx != null){
                // Environ type. walk to end of region. rdrx/rdry unused.
                
                next.rd1path = ''
                if (rd2){
                    next.rd2path = ''
                    rd12 = rd2
                    rd2 = rd2path[0]
                    rd2path = rd2path.slice(1)
                }

                for (let rd of ['rd1', 'rd2']){
                    opts = {
                        wrel: [wx, wy, rx, ry], 
                        rd0:rd0,
                    }
                    if (rd == 'rd1'){
                        opts.rdx = rdex
                        opts.rdy = rdey
                    }else if(next.rd2){
                        // initialized by rd12
                        switch(next.rd2path[-1+next.rd2path.length]){
                        case 'u':
                            opts.wrel[3] -= 1
                            opts.rdx = next.rd2[4]
                            opts.rdy = MX_REGION_ENVIRON
                            break;
                        case 'd':
                            opts.wrel[3] += 1
                            opts.rdx = next.rd2[4]
                            opts.rdy = 0
                            break;
                        case 'l':
                            opts.wrel[2] -= 1
                            opts.rdx = MX_REGION_ENVIRON
                            opts.rdy = next.rd2[5]
                            break;
                        case 'r':
                            opts.wrel[2] += 1
                            opts.rdx = 0
                            opts.rdy = next.rd2[5]
                            break;
                        }
                    }

                    while(dir = (rd == 'rd1'? rd1:rd2)){
                        opts.rd1 = dir
                        opts.rdgx = null
                        opts.rdgy = null
                        opts.rd2 = rd12

                        switch(dir){
                        case 'u':
                            // set goal if needed
                            if (!opts.wrel[1] && !opts.wrel[3]){
                                tmp = __prop._wrel_.get(opts.wrel[0] + '_' + MX_WORLD_Y + '_' + opts.wrel[2] + '_' + MX_REGION_ENVIRON)
                                if (tmp){
                                    opts.rdgy = 0
                                    x = -1
                                    while(++x < SZ_REGION_ENVIRON){
                                        ix = SZ_REGION_ENVIRON*MX_REGION_ENVIRON + x
                                        if(tmp[ix] == tmp[ix].toUpperCase()){
                                            opts.rdgx = x 
                                            break;
                                        }
                                    }
                                }
                            }
                            tmp = 'd'
                            break;
                        case 'd':
                            if (opts.wrel[1] == MX_WORLD_Y && opts.wrel[3] == MX_REGION_ENVIRON){
                                tmp = __prop._wrel_.get(opts.wrel[0] + '_0_' + opts.wrel[2] + '_0')
                                if (tmp){
                                    opts.rdgy = MX_REGION_ENVIRON
                                    x = -1
                                    while(++x < SZ_REGION_ENVIRON){
                                        ix = x
                                        if(tmp[ix] == tmp[ix].toUpperCase()){
                                            opts.rdgx = x 
                                            break;
                                        }
                                    }
                                }
                            }
                            tmp = 'u'
                            break;
                        case 'l':
                            if (!opts.wrel[0] && !opts.wrel[2]){
                                tmp = __prop._wrel_.get(MX_WORLD_X + '_' + opts.wrel[1] + '_' + MX_REGION_ENVIRON + '_' + opts.wrel[3])
                                if (tmp){
                                    opts.rdgx = 0
                                    y = -1
                                    while(++y < SZ_REGION_ENVIRON){
                                        ix = SZ_REGION_ENVIRON*y + MX_REGION_ENVIRON
                                        if(tmp[ix] == tmp[ix].toUpperCase()){
                                            opts.rdgy = y 
                                            break;
                                        }
                                    }
                                }
                            }
                            tmp = 'r'
                            break;
                        case 'r':
                            if (opts.wrel[0] == MX_WORLD_X && opts.wrel[2] == MX_REGION_ENVIRON){
                                tmp = __prop._wrel_.get('0_' + opts.wrel[1] + '_0_' + opts.wrel[3])
                                if (tmp){
                                    opts.rdgx = MX_REGION_ENVIRON
                                    y = -1
                                    while(++y < SZ_REGION_ENVIRON){
                                        ix = SZ_REGION_ENVIRON*y
                                        if(tmp[ix] == tmp[ix].toUpperCase()){
                                            opts.rdgy = y 
                                            break;
                                        }
                                    }
                                }
                            }
                            tmp = 'l'
                            break;
                        }

                        if(debug){
                            console.log('gen Environ', opts)
                            if(rd == 'rd1'){
                                console.log('remaining rd1path', rd1path)
                            }else{
                                console.log('remaining rd2path', rd2path)
                            }
                        }
                        __prop._wrel_.set(opts.wrel.slice(0,4).join('_'), select.generate_('Environ', opts))

                        // always rd1 in opts (except with rd12 below)
                        next[rd] = opts.rd1end
                        next[rd + 'path'] += opts.rd1path

                        opts.wrel = __action.__wrel_move_dir(opts.wrel, dir)
                        opts.rd0 = tmp

                        switch(dir){
                        case 'u':
                            opts.rdx = next[rd][4]
                            opts.rdy = MX_REGION_ENVIRON
                            break;
                        case 'd':
                            opts.rdx = next[rd][4]
                            opts.rdy = 0
                            break;
                        case 'l':
                            opts.rdx = MX_REGION_ENVIRON
                            opts.rdy = next[rd][5]
                            break;
                        case 'r':
                            opts.rdx = 0
                            opts.rdy = next[rd][5]
                            break;
                        }

                        if (rd == 'rd1'){
                            rd1 = rd1path[0]
                            rd1path = rd1path.slice(1)
                            if (rd12){
                                // singular forked environ. rest in region use opts.rd1 only.
                                next.rd2 = opts.rd2end
                                next.rd2path += opts.rd2path
                                rd12 = null
                            }
                        }else{
                            rd2 = rd2path[0]
                            rd2path = rd2path.slice(1)
                        }
                    }
                }
                return next;
            }
            // Region type. nest Environs. walk to end of world

            opts = {
                wrel:[wx, wy], 
                rd0:rd0, 
                rd1:rd1, 
                rd2:rd2,
                rdx: rdrx,
                rdy: rdry
            }

            if (__prop._wrel_.has(opts.wrel.join('_'))){
                if(debug) console.log('prevent remake region road', Array.from(opts.wrel));
                return;
            }
            if (rd1path || rd2path){
                if(debug) console.log('region should be called with rd1/2 direction, not path')
                return;
            }

            // rdgx rdgy
            if (!wy && rd1 == 'u'){
                tmp = __prop._wrel_.get(wx + '_' + MX_WORLD_Y)
                if (tmp){
                    opts.rdgy = 0
                    x = -1
                    while(++x < SZ_REGION_ENVIRON){
                        ix = SZ_REGION_ENVIRON*MX_REGION_ENVIRON + x
                        if(tmp[ix] == tmp[ix].toUpperCase()){
                            opts.rdgx = x 
                            break;
                        }
                    }
                }
            }else if (wy == MX_WORLD_Y && rd1 == 'd'){
                tmp = __prop._wrel_.get(wx + '_0')
                if (tmp){
                    opts.rdgy = MX_REGION_ENVIRON
                    x = -1
                    while(++x < SZ_REGION_ENVIRON){
                        ix = x
                        if(tmp[ix] == tmp[ix].toUpperCase()){
                            opts.rdgx = x 
                            break;
                        }
                    }
                }
            }else if (!wx && rd1 == 'l'){
                tmp = __prop._wrel_.get(MX_WORLD_X + '_' + wy)
                if (tmp){
                    opts.rdgx = 0
                    y = -1
                    while(++y < SZ_REGION_ENVIRON){
                        ix = SZ_REGION_ENVIRON*y + MX_REGION_ENVIRON
                        if(tmp[ix] == tmp[ix].toUpperCase()){
                            opts.rdgy = y 
                            break;
                        }
                    }
                }
            }else if (wx == MX_WORLD_X && rd1 == 'r'){
                tmp = __prop._wrel_.get('0_' + wy)
                if (tmp){
                    opts.rdgx = MX_REGION_ENVIRON
                    y = -1
                    while(++y < SZ_REGION_ENVIRON){
                        ix = SZ_REGION_ENVIRON*y
                        if(tmp[ix] == tmp[ix].toUpperCase()){
                            opts.rdgy = y 
                            break;
                        }
                    }
                }
            }

            let tries = 100
            // button-hook can cause failure. delete and remake. crit fail still possible but extremely rare
            make_region:
            while(tries-- > 0){
                try{
                    __prop._wrel_.set(opts.wrel.slice(0,2).join('_'), select.generate_('Region', opts))
                    
                    if(debug) console.log('region created opts', opts)

                    // next paths include final transition across region boundary
                    if (rd2){
                        next = __action._init_road(wx, wy, rdrx, rdry, null, null, rdex, rdey, rd0, opts.rd1path, opts.rd2path)
                    }else{
                        next = __action._init_road(wx, wy, rdrx, rdry, null, null, rdex, rdey, rd0, opts.rd1path)
                    }
                    if(debug) console.log('region created environ next', next)
                    
                    if (only_one === true)
                        return next

                    for (let rd of ['rd1', 'rd2']){
                        tmp = null
                        switch(rd == 'rd1'? rd1: rd2){
                        case 'u':
                            if (!wy) break;
                            dir = __action._next_road_dir(wx, wy-1, null, null, 'd')
                            if (!dir.length){
                                if (debug) console.log('region road dead end at', [wx, wy-1])
                                debugger;
                                dir = __action._next_road_dir(wx, wy-1, null, null, 'd')
                                break;
                            }
                            if (dir.length > 1){
                                tmp = __action._init_road(wx, wy-1, null, null, next[rd][2], 8, next[rd][4], 8, 'd', dir[0], dir[1])
                            }else{
                                tmp = __action._init_road(wx, wy-1, null, null, next[rd][2], 8, next[rd][4], 8, 'd', dir[0])
                            }
                            break;
                        case 'd':
                            if (wy == MX_WORLD_Y) break;
                            dir = __action._next_road_dir(wx, wy+1, null, null, 'u')
                            if (!dir.length){
                                if (debug) console.log('region road dead end at', [wx, wy+1])
                                debugger;
                                dir = __action._next_road_dir(wx, wy+1, null, null, 'u')
                                break;
                            }
                            if (dir.length > 1){
                                tmp = __action._init_road(wx, wy+1, null, null, next[rd][2], 0, next[rd][4], 0, 'u', dir[0], dir[1])
                            }else{
                                tmp = __action._init_road(wx, wy+1, null, null, next[rd][2], 0, next[rd][4], 0, 'u', dir[0])
                            }
                            break;
                        case 'l':
                            if (!wx) break;
                            dir = __action._next_road_dir(wx-1, wy, null, null, 'r')
                            if (!dir.length){
                                if (debug) console.log('region road dead end at', [wx-1, wy])
                                debugger;
                                dir = __action._next_road_dir(wx-1, wy, null, null, 'r')
                                break;
                            }
                            if (dir.length > 1){
                                tmp = __action._init_road(wx-1, wy, null, null, 8, next[rd][3], 8, next[rd][5], 'r', dir[0], dir[1])
                            }else{
                                tmp = __action._init_road(wx-1, wy, null, null, 8, next[rd][3], 8, next[rd][5], 'r', dir[0])
                            }
                            break;
                        case 'r':
                            if (wx == MX_WORLD_X) break;
                            dir = __action._next_road_dir(wx+1, wy, null, null, 'l')
                            if (!dir.length){
                                if (debug) console.log('region road dead end at', [wx+1, wy])
                                debugger;
                                dir = __action._next_road_dir(wx+1, wy, null, null, 'l')
                                break;
                            }
                            if (dir.length > 1){
                                tmp = __action._init_road(wx+1, wy, null, null, 0, next[rd][3], 0, next[rd][5], 'l', dir[0], dir[1])
                            }else{
                                tmp = __action._init_road(wx+1, wy, null, null, 0, next[rd][3], 0, next[rd][5], 'l', dir[0])
                            }
                            break;
                        }

                        if (!tmp){
                            // at world edge. last path step crosses edge to other primary-road
                        }else{
                            // next region extends path and overrides end
                            next[rd] = tmp[rd]
                            next[rd + 'path'] += tmp[rd + 'path']
                        }
                    }
                }catch(e){
                    if (debug) console.log(e)
                    if (!tries){
                        throw('critical region fail')
                    }
                    let base = opts.wrel.join('_')
                    __prop._wrel_.delete(base)
                    let x, y=-1
                    while(y++ < SZ_REGION_ENVIRON){
                        x = -1
                        while(x++ < SZ_REGION_ENVIRON){
                            __prop._wrel_.delete(base + '_' + x + '_' + y)
                        }
                    }
                    continue make_region;
                }
                return next;
            }      
        },

        _init_world: function(){
            const log_len = true
            __prop._game_ent = new Map();

            // 6 primary roads
            const X0 = 32, Y0 = 14

            let v = {}
            v.R0 =  __action._init_road(X0, Y0, null, null, 8, 8, 8, 8, 'd', 'l', 'u', true)
            v.R1 =  __action._init_road(X0-1, Y0, null, null, 8, v.R0.rd1[3], 8, v.R0.rd1[5], 'r', 'u', null, true)
            v.R2 =  __action._init_road(X0-1, Y0-1, null, null, v.R1.rd1[2], 8, v.R1.rd1[4], 8, 'd', 'l')
            if (log_len) console.log('R primary length. km:', v.R2.rd1path.length / 10);

            v.tmp = __prop._wrel_.get(X0 + '_' + Y0 + '_8_8')
            // v.tmp[7 + 8*9] = 'M'
            // v.tmp[8 + 8*9] = 'M'
            v.tmp[8 + 8*9] = 'C'
            v.tmp = __prop._wrel_.get(X0 + '_' + Y0)
            v.tmp[8 + 8*9] = 'C'

            setTimeout(()=>{
                v.D0 =  __action._init_road(X0, Y0+1, null, null, 8, 0, 8, 0, 'u', 'd', 'l', true)
                v.D1 =  __action._init_road(X0, Y0+2, null, null, v.D0.rd1[2], 0, v.D0.rd1[4], 0, 'u', 'd')
                if (log_len) console.log('D primary length. km:', v.D1.rd1path.length / 10)

                // v.tmp = __prop._wrel_.get(X0 + '_' + (1+Y0) + '_8_0')
                // v.tmp[7] = 'M'
                // v.tmp[8] = 'C'
                // v.tmp = __prop._wrel_.get(X0 + '_' + (1+Y0))
                // v.tmp[8] = 'C'

                setTimeout(()=>{
                    v.W0 =  __action._init_road(X0, Y0-1, null, null, v.R0.rd2[2], 8, v.R0.rd2[4], 8, 'd', 'u')
                    if (log_len) console.log('W primary length. km:', v.W0.rd1path.length / 10)

                    setTimeout(()=>{
                        v.M0 =  __action._init_road(X0+1, Y0+1, null, null, 0, 0, 0, 0, 'u', 'r')
                        if (log_len) console.log('M primary length. km:', v.M0.rd1path.length / 10)
                    
                        // v.tmp = __prop._wrel_.get((1+X0) + '_' + (1+Y0) + '_0_0')
                        // v.tmp[0] = 'M'

                        setTimeout(()=>{
                            v.A0 =  __action._init_road(X0+1, Y0, null, null, 0, 8, 0, 8, 'l', 'u', null, true)
                            v.A1 =  __action._init_road(X0+1, Y0-1, null, null, v.A0.rd1[2], 8, v.A0.rd1[4], 8, 'd', 'r')
                            if (log_len) console.log('A primary length. km:', v.A1.rd1path.length / 10)
                        
                            // v.tmp = __prop._wrel_.get((1+X0) + '_' + Y0 + '_0_8')
                            // v.tmp[0 + 8*9] = 'M'
                            setTimeout(()=>{
                                v.L0 =  __action._init_road(X0-1, Y0+1, null, null, 8, v.D0.rd2[3], 8, v.D0.rd2[5], 'r', 'l')
                                if (log_len) console.log('L primary length. km:', v.L0.rd1path.length / 10)

                                console.log('init ROADS:', v)
                            }, 1)
                        }, 1)
                    }, 1)
                }, 1)
            }, 1)
        },

    },// _action_
    _generate_:{

        top: {_element: 'div',
            init_: function(dsp, opts){
                // INIT page/tool/selection/game/path/miniroll whatever you want to call it. this could be anywhere called by initial display generation (so cascading from any of the initial _view_/_display_)

                view.refresh('mmenu_')

                // wip change view_io_ args to be [force-view/hide, use-collapse] and 
                select.action_('view_io_', [0, 0]) // collapse
                select.action_('view_log_', [1, 0]) // hide
            },
            _className: 'miniroll top',
            _children_pre_dsp: [
                'creation_top_', 
                'coord_label_', 
                'block_menu_', 
                ],
            _children_gen_opts: [
                ],
            _children_dsp: [
                'world_top_', 
                'region_top_', 
                'environ_top_', 
                'locale_top_', 
                ],
        },
        page_mmenu: {_element: 'div',
            _className: 'miniroll page_mmenu',
            _prop_: {
                // weird: click on inside banner blocks, but dbl-click on it allows through
                // onclick: function(){
                //     this.parentElement.classList.add('hidden')
                // }
            },
            _children_gen_opts: [
                'top_banner_reset_btn',
                'top_banner_label',
                // ... save load

                // bad place for this.
                'top_banner_unhide_inspect',
                'top_banner_last_inspect',
                'top_banner_last_last_inspect',
                ],
        },

        left_menu: {_element: 'div',
            _className: 'miniroll left menu',
            _children_dsp: [
                'creation_',
                'results_',
                ]
        },

        up: {_element: 'div',
            _className: 'miniroll up',
            _children_dsp: [
                'inspect_',
                ]
        },
        main: {_element: 'div',
            _className: 'miniroll main',
            _children_dsp: [
                'world_',
                'region_',
                'environ_',
                'locale_',
                // 'interaction_',
                'action_'
                ]
        },
        down: {_element: 'div',
            _className: 'miniroll down',
            _children_dsp: [
                'party_'
                ],
        },
        right: {_element: 'div',
            _className: 'miniroll right',
            _children_dsp: [
                'encounter_',
                'targets',
                ],
        },
        bottom: {_element: 'div',
            _className: 'miniroll bottom',
            _children_dsp: [
                'status_'
                ],
        },
        
        top_banner_reset_btn: {_element: 'button', 
            _className: 'reset', _prop_: {
                innerText: "new",
                onclick: function(){
                    // HIDE
                    this.disabled = true

                    console.log("reset whole game. grey-out reset-button")

                    view.prompt(__action.pick_from_items(__prop._prompts.gm.intro))

                    __prop._party = []
                    // __prop._encounter = []

                    __action.init_creation()
                },
            }
        },
        top_banner_label: {_element: 'div', _className: "label",
            className_: function(dsp, opts){
                select.action_('add_component_inspect_', [dsp, 'creation'])
            },_prop_: {
                id:'inspect_help',
                innerText: "Mini Roll",
                ondblclick: function(evt){
                    if (evt && evt.stopPropagation){
                        evt.stopPropagation()
                    }

                    let prev = this.previousElementSibling
                    if (prev){
                        prev.disabled = prev.disabled? false: true
                    }

                },
            }
        },
        top_banner_unhide_inspect: {_element: 'div', _className: 'btn on',
            _prop_:{
                innerText: 'help',
                onclick: function(evt){
                    if (evt && evt.stopPropagation)evt.stopPropagation()
                    if (__sel._display_.inspect_._value.classList.contains('min')){
                        select.action_('shrink_dsp_force_grow_', [__sel._display_.inspect_._value, view.MAX]);
                        this.classList.add('on')
                    } else{
                        select.action_('shrink_dsp_force_grow_', [__sel._display_.inspect_._value, view.MIN]);
                        this.classList.remove('on')
                    }
                },
            },
        },
        top_banner_last_inspect: {_element: 'div', _className: 'btn last dim',
            _prop_:{
                innerText: 'o',
                onclick: function(evt){
                    if (evt && evt.stopPropagation)evt.stopPropagation()
                    if (__prop._last_inspect){
                        let tmp1 = __prop._inspect,
                            tmp2 = __prop._inspect_as_html

                        __prop._inspect = __prop._last_inspect
                        __prop._inspect_as_html = __prop._last_inspect_as_html
                        __prop._last_inspect = tmp1
                        __prop._last_inspect_as_html = tmp2
                        view.display('inspect_')
                    }
                    if (__sel._display_.inspect_._value.classList.contains('min'))
                        select.action_('shrink_dsp_force_grow_', [__sel._display_.inspect_._value, view.MAX]);

                },
            },
        },
        top_banner_last_last_inspect: {_element: 'div', _className: 'btn last dim',
            _prop_:{
                innerText: 'oo',
                onclick: function(evt){
                    if (evt && evt.stopPropagation)evt.stopPropagation()
                    if (__prop._last_last_inspect){
                        let tmp1 = __prop._last_last_inspect,
                            tmp2 = __prop._last_last_inspect_as_html

                        __prop._last_last_inspect = __prop._last_inspect
                        __prop._last_last_inspect_as_html = __prop._last_inspect_as_html
                        __prop._last_inspect = __prop._inspect
                        __prop._last_inspect_as_html = __prop._inspect_as_html
                        __prop._inspect = tmp1
                        __prop._inspect_as_html = tmp1
                        view.display('inspect_')
                    }
                    if (__sel._display_.inspect_._value.classList.contains('min'))
                        select.action_('shrink_dsp_force_grow_', [__sel._display_.inspect_._value, view.MAX]);
                },
            },
        },


        // simple text
        coord_label_: {_element: 'div', _className: 'coord label', 
            _prop__: {
                innerText: function(dsp, opts){
                    let txt = ''
                    switch(__sel._state){
                    case 'world': 
                        txt += 'World[8km] ';
                        if (__prop._wrel.length){
                            // txt += '@(' + __prop._wrel.slice(0,2) + ')'
                        }
                        return txt;
                    case 'region': 
                        txt += 'Region[900m](' + __prop._wrel.slice(0,2) + ') '
                        if (__prop._wrel.length > 2){
                            // txt += '@(' + __prop._wrel.slice(2,4) + ')'
                        }
                        return txt;
                    case 'environ': 
                        txt += 'Environ[100m](' + __prop._wrel.slice(0,4) + ') '
                        if (__prop._wrel.length > 4){
                            // txt += '@(' + __prop._wrel.slice(4,6) + ')'
                        }
                        return txt;
                    case 'locale': 
                        txt += 'Locale[1m](' + __prop._wrel.slice(0,6) + ') '
                        if (__prop._wrel.length > 6){
                            // txt += '@(' + __prop._wrel.slice(4,6) + ')'
                        }
                        return txt;
                    }
                    dsp.classList.add('hidden');
                    return
                },
            }
        },

        // inspect_: html or text
        // status_, prompt and msg: text (sometimes w type)
        inspect_: {_element: 'div', _className: 'inspect',
            className_: function(dsp, opts){
                if (!__prop._inspect) return 'hidden'

                select.action_('add_component_sizable_', [dsp, __sel, '_inspect_sz'])
                dsp.ondblclick = null // prevent min by click ( toggle btn only )
            },
            children: function(dsp){
                if (__prop._inspect_as_html){
                    if (__prop._inspect instanceof Element){
                        dsp.innerHTML = ''
                        dsp.appendChild(__prop._inspect)
                    }else{
                        dsp.innerHTML = __prop._inspect
                    }
                }else{
                    if (__prop._inspect instanceof Element){
                        // ambiguous
                        dsp.innerText = __prop._inspect.outerHTML
                    }else{
                        dsp.innerText = __prop._inspect
                    }
                }
            },
        },
        // bottom of screen. intended for fadeout
        status_: {_element: 'div', 
            className: ()=>{if (!__prop._status_txt) return 'hidden'},
            _className: 'miniroll status',
            _prop_: {
                onclick: function(){
                    __prop._last_status_txt = __prop._status_txt;
                    __prop._last_status_type = __prop._status_type;
                    __prop._status_txt = '';
                    view.display('status_')
                },
            },
            _prop__: {
                innerText: function(dsp, opts){
                    if (dsp.classList.contains('hidden'))return;
                    console.log('wip status type', __prop._status_type)
                    return __prop._status_txt
                },
            },
        },
        // prompt default toggle-vis. speech.
        prompt: {_element: 'div', _className: 'prompt', _prop__:{
            innerText: function(dsp, opts){
                // default toggle vis
                select.action_('add_component_clickaction_', [dsp, opts.onclick || 'visible'])
                return (opts.prompt)
            },},
        },
        // msg default delete. game notes.
        msg: {_element: 'div', _className: 'msg', _prop__:{
            innerText: function(dsp, opts){
                // default delete
                select.action_('add_component_clickaction_', [dsp, opts.onclick || 'delete'])
                return (opts.msg)
            },},
        },

        // creation_top pop-prefix top-menu
        creation_top_: {_element: 'div', _className: 'creation top',
            className: ()=>{if ('creation' != __sel._state) return 'hidden'},
            children: function(dsp){
                if (dsp.classList.contains('hidden'))return;
                dsp.appendChild(select.generate_('creation_top_reroll_name'))
                dsp.appendChild(select.generate_('creation_top_std_ent'))
                dsp.appendChild(select.generate_('creation_top_uber_ent'))
                dsp.appendChild(select.generate_('creation_top_std_party'))
                dsp.appendChild(select.generate_('creation_top_uber_party'))
            },
        },
        creation_top_reroll_name: {_element: 'div', _className: 'btn on', _prop_: {onclick: function(evt){
            if (evt) evt.stopPropagation();
            let ent = __prop._creation._ent
            if (!ent) return;
            ent.roll_name() 
            return view.display('creation_')
        }, innerText: '(rename)'}},
        creation_top_std_ent: {_element: 'div', _className: 'btn on', _prop_: {onclick: function(evt){
            if (evt) evt.stopPropagation();
            // console.log(__prop._creation._ent, __prop._party)
            let ent = __prop._creation._ent
            if (!ent) return;
            ent._rerolls = 0 
            switch(ent.cl){
            case 'WAR':
                ent.str = [18,6,6,6]
                ent.con = [18,6,6,6]
                ent.dex = [10,3,3,4]
                ent.cha = [10,3,3,4]
                ent.int = [10,3,3,4]
                ent.wis = [14,5,5,4]
                break;
            case 'ROG':
                ent.str = [10,3,3,4]
                ent.con = [14,5,5,4]
                ent.dex = [18,6,6,6]
                ent.cha = [18,6,6,6]
                ent.int = [10,3,3,4]
                ent.wis = [10,3,3,4]
                break;
            case 'MND':
                ent.str = [8,3,3,2]
                ent.con = [10,3,3,4]
                ent.dex = [10,3,3,4]
                ent.cha = [16,5,5,6]
                ent.int = [18,6,6,6]
                ent.wis = [18,6,6,6]
                break;
            }
            return view.display('creation_')
        }, innerText: '(mold)'}},
        creation_top_uber_ent: {_element: 'div', _className: 'btn on', _prop_: {onclick: function(evt){
            if (evt) evt.stopPropagation();
            // console.log(__prop._creation._ent, __prop._party)
            let ent = __prop._creation._ent
            if (!ent) return;
            ent._rerolls = 0 
            ent.str = [18,6,6,6]
            ent.con = [18,6,6,6]
            ent.dex = [18,6,6,6]
            ent.cha = [18,6,6,6]
            ent.int = [18,6,6,6]
            ent.wis = [18,6,6,6]
            return view.display('creation_')
        }, innerText: '(uber)'}},
        creation_top_std_party: {_element: 'div', _className: 'btn', _prop_: {onclick: function(evt){
            if (evt) evt.stopPropagation();
            // console.log(__prop._creation._ent, __prop._party)
            __prop._party = []
            __action.init_creation()
            __prop._creation._ent.cl = 'WAR'
            this.previousElementSibling.previousElementSibling.click()
            __prop._creation._ent.finalize()
            __prop._creation._ent.cl = 'ROG'
            this.previousElementSibling.previousElementSibling.click()
            __prop._creation._ent.finalize()
            __prop._creation._ent.cl = 'MND'
            this.previousElementSibling.previousElementSibling.click()
            __prop._creation._ent.finalize()
        }, innerText: 'mold party'}},
        creation_top_uber_party: {_element: 'div', _className: 'btn', _prop_: {onclick: function(evt){
            if (evt) evt.stopPropagation();
            // console.log(__prop._creation._ent, __prop._party)
            __prop._party = []
            __action.init_creation()
            __prop._creation._ent.cl = 'WAR'
            this.previousElementSibling.previousElementSibling.click()
            __prop._creation._ent.finalize()
            __prop._creation._ent.cl = 'ROG'
            this.previousElementSibling.previousElementSibling.click()
            __prop._creation._ent.finalize()
            __prop._creation._ent.cl = 'MND'
            this.previousElementSibling.previousElementSibling.click()
            __prop._creation._ent.finalize()
        }, innerText: 'uber party'}},

        creation_: {_element: 'div', _className: 'creation',
            className: ()=>{if ('creation' != __sel._state) return 'hidden'},
            // ######       INITIALIZATION of help html       ##########
            children: function(res){
                if (!__prop._help_inspect){
                    // do once
                    let html = '', data, cols, rows, tmp
                    html += '<table><tbody>'
                    html += '<tr><th>Help</th><th>About</th></tr>'
                    html += '<tr><td>interface</td><td>try double-clicking labels<table><tbody><tr><td>unlock/lock/min/max</td><td>dbl-click</td><td>hold-back<br>dbl-arrow<br>dbl-hold-arrow</td></tr><tr><td>resize/inspect</td><td>click</td><td>hold-ok</td></tr><tr><td>reverse/bounce</td><td></td><td>hold-arrow</td></tr><tr><td>jump focus</td><td></td><td>dbl-arrow<br>dbl-hold-arrow</td></tr><tr><td></td><td></td><td></td></tr></tbody></table></td></tr>'
                    html += '<tr><td>stats</td><td>see below. max roll is 18, +1 to the 2 class stats at creation. equip buffs/debuffs are extremely rare, but actions/eating/time/level can modify them slowly. Even numbers more often include a new action. 8 may be a nearly essential action, and 10 a very common action.  14 typically contains a class-distinct action.</td></tr>'
                    html += '<tr><td>hp</td><td>health points. named NPC and player-characters cannot die. They become unconscious and gain 1 hp per day minimum or by \'revive\' healing.</td></tr>'
                    html += '<tr><td>rations</td><td>standard daily usage of 3 water (gourd) and 4 food rations (attainable by 1 meat and 1 veg): 1 protein, 1 energy, 1 vitamin, 1 mineral. Stat debuffs/buffs can occur by prolonged under/over -eating. Food may be eaten in 1 sitting, but can only drink 1 water per hour. Rationing of either is possible if set as intention, reducing some max-stamina types (fatigue, air, tire, stress).</td></tr>'
                    // html += '<tr><td>classes</td><td>see bottom table. select offensive stat and 1 other stat to gain a bonus stat point and a couple unique skills.</td></tr>'
                    html += '<tr><td>acc</td><td>Accuracy (x 5%). acc % minus evade % is actual hit %. Specific for damage type and attack type.</td></tr>'
                    html += '<tr><td>eva</td><td>Evade (x 5%). combination of dodge/parry/absorb.</td></tr>'
                    html += '<tr><td>atk types</td><td>[m]elee close-range(even 6m polearms). default. [r]anged  [s]pell/skill general-competence. Most weapon/skill/spell groups give training bonuses as well.</td></tr>'
                    html += '<tr><td>dmg types</td><td>[p]ierce [s]lash [b]lunt [e]lectric [m]ental [v]ibration [h]eat [f]ever/poison [c]old [d]ecrepid/disease</td></tr>'
                    html += '<tr><td>train</td><td>weapon/skill groups can give bonuses after usage. Sometimes a trainer is required. A weapon with 2 trainables has a higher potential than with 1 trainable (not double. 5-20% for each extra trainable)</td></tr>'
                    html += '<tr><td>display-world-scale</td><td>8km meter blocks (~5 miles). 60x30. A road travels on average 10km within a world-block.</td></tr>'
                    html += '<tr><td>display-world-move</td><td>Carriages on the road that refresh horses can travel 10-20+ blocks per day. Can walk ~3-6 blocks per day along roads, and 1-4 off road. Water travel is 0-10 per hour, and air travel is 0-20 per hour.</td></tr>'
                    html += '<tr><td>display-world-visibility</td><td>upto 3 block view from mountains and water, 2 from grassland/savannah, 1 from the rest. Or find/purchase maps/rumors.</td></tr>'
                    html += '<tr><td>display-world-npc</td><td>uppercase is where NPC is unlocked. Then, it will be available at all lowercase locations. Some locations must be discovered by rumor and maps.</td></tr>'

                    html += '<tr><td>display-environ-scale</td><td>1 world block (8 km or 5 mi), made of 80 x 80 (100 m) locales</td></tr>'
                    html += '<tr><td>display-environ-content</td><td>most are auto-generated dependent on neighboring blocks and if a road is present.</td></tr>'
                    html += '<tr><td>display-environ-road</td><td>average 100 locales (100m) for 10 km distance, but this varies during auto-generation.</td></tr>'

                    html += '<tr><td>display-locale-scale</td><td>1 meter blocks. 100 x 10 although height can represent a far distance.</td></tr>'
                    html += '<tr><td>display-locale-block</td><td>lowercase are transparent. uppercase are semi-solid. can change between by construct/fill/grow/rain/unlock or break/dig/forage/drain/lock</td></tr>'

                    html += '<tr><td>display-locale-move-land</td><td><table><tr><td>boulder-up</td><td>boulder-up-side</td><td></td><td></td><td></td></tr><tr><td>climb-up</td><td>climb-up-side</td><td>boulder-climb-up-over</td><td></td><td></td></tr><tr><td>jump-up</td><td>jump-up-side</td><td>climb-over-up-over-side</td><td>boulder-over-up-jump</td><td></td></tr><tr><td>step-up</td><td>step-up-side</td><td>hop-over-up</td><td>jump-over-up</td><td></td></tr><tr><td>FROM</td><td>step</td><td>hop-over</td><td>jump-over</td><td>boulder-far-over</td></tr><tr><td>step-down</td><td>step-down-side</td><td>hop-over-down</td><td>jump-over-down</td><td>climb-far-over-down</td></tr><tr><td>jump-down</td><td>jump-down-side</td><td>jump-down-over</td><td>short-fall-jump-over-jump-down</td><td>long-fall-far-over-jump-down</td></tr><tr><td>short-fall-down</td><td>short-fall-side</td><td>short-fall-over</td><td>long-fall-jump-over-far-down</td><td></td></tr><tr><td>long-fall-down</td><td>long-fall-side</td><td>long-fall-over</td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td></tr></table></td></tr>'
                    html += '<tr><td>display-locale-move-water</td><td><table><tr><td>swim, wade</td><td>swim, wade</td><td>swim-far</td></tr><tr><td>FROM</td><td>swim, wade</td><td>swim-far</td></tr><tr><td>swim, wade</td><td>swim, wade</td><td>swim-far</td></tr></table></td></tr>'
                    html += '<tr><td>display-locale-move-climb</td><td><table><tr><td>climb, boulder</td><td>climb, boulder</td><td>boulder-far</td></tr><tr><td>FROM</td><td>climb, boulder</td><td>boulder-far</td></tr><tr><td>climb, boulder</td><td>climb, boulder</td><td>boulder-far</td></tr></table></td></tr>'
                    html += '<tr><td>display-locale-move-air</td><td><table><tr><td>hover-far-up</td><td>fly-far-up</td><td>fly-far-over-far-up</td></tr><tr><td>takeoff, hover-up</td><td>fly-up</td><td>fly-far-over-up</td></tr><tr><td>FROM</td><td>fly</td><td>fly-far</td></tr><tr><td>land, hover-down</td><td>fly-down</td><td>fly-far-over-down</td></tr><tr><td>hover-far-down</td><td>fly-far-down</td><td>fly-far-over-far-down</td></tr></table></td></tr>'

                    html += '<tr><td>display-locale-move-state</td><td>1 depth water is wading, deeper is swimming. Climb is a skill allowing hold onto solid object from the side. Boulder is advanced climb allowing hold onto solid object from below.</td></tr>'
                    html += '<tr><td>display-locale-fall</td><td>Short fall (4-down) has little-to-no minor injury chance. Long fall (5+ down) has unavoidable injury chance. </td></tr>'
                    html += '<tr><td>display-locale-move-swimming</td><td>Chars cannot fall down out of water, but fall 1 on-enter water from side, and fall 1 at end of each round.</td></tr>'
                    html += '<tr><td>display-locale-move-flying</td><td>Chars fly in any lowercase block and some uppercase. There must be at least 1 block gap above ground, or is landed and requires takeoff action to resume flight.</td></tr>'


                    html += '<tr><td>sleep</td><td>sleep anywhere but sleep can be disturbed. Better sleep receives bonuses. The very best sleep is in chair-block next to 2 empty chair-blocks in a locked-door-enclosed semi-solid space containing each of these 4: r/R(decor/flower) W(water) g/G(plant) c/C(container/chest)</td></tr>'
                    html += '<tr><td>range</td><td>can attack ~20% over max-range or ~20% under min-range with acc penalty <br>or can increase air-usage to gain more movement this turn.</td></tr>'
                    html += '<tr><td>dual wield</td><td>always possible if you have 2 functional hands. offhand(w2) receives -40% acc by default.</td></tr>'
                    html += '<tr><td>2 hand</td><td>2-handed weapons (in w and w2 slots only) can be used with 1 hand with -30% acc by default. 2h equipment in other hand-slots ([o]ffhand/non-weapons [r]ange [t]hrow) can be held/equipped but not used without both hands free. w-slot is considered dominant hand; all other hand-slots are the other hand and mutually exclusive.</td></tr>'
                    html += '<tr><td>stamina: air</td><td>{out-of-breath} is a warning to {exhaustion} which gives 1 single round to end exhaustion or pass out asleep and be confused, and a tiny chance of stat decrease.</td></tr>'
                    html += '<tr><td>stamina: fatigue</td><td>soreness of muscles. {fatigue} gives some stress and a little less dmg, but improves resistance to fatigue and air-loss (upto ~20% bonus. default chars are already \'in-shape\').</td></tr>'
                    html += '<tr><td>stamina: tire</td><td>builds up by all activities until sleep. {tired} gives 5% fail to actions, even easy ones.</td></tr>'
                    html += '<tr><td>stamina: stress</td><td>builds by adrenaline and pain. {stressed} gives acc and eva debuff and sleep health-regen.</td></tr>'
                    html += '<tr><td>time</td><td>1 action round is 7.2 sec. 25 rounds per 3 minutes. 500 rnd/hr. 12k rnd/day.</td></tr>'
                    html += '<tr><td>action points</td><td>each round, 1 primary action is selected, and any number of minor pre/post -actions can occur. standard air-usage allow 12 action points. </td></tr>'
                    html += '<tr><td>action priority</td><td>on queueing an action for a round, it is given a priority. a re-action with higher priority can override the queued action. <table><tr><th span="2">priorites are:</th></tr><tr><td>[1]</td><td>avoid unc/death</td></tr><tr><td>[2]</td><td>stop exhaustion(out-of-air/drowning)</td></tr><tr><td>[3]</td><td>avoid being crushed</td></tr><tr><td>[4]</td><td>avoid being trapped</td></tr><tr><td>[5]</td><td>avoid major dmg</td></tr><tr><td>[6]</td><td>avoid large fall</td></tr><tr><td>[7]</td><td>reduce major harm hp/status/effect/equip</td></tr><tr><td>[8]</td><td>flee undefeatable-immediate-hostile</td></tr><tr><td>[9]</td><td>ready for combat</td></tr><tr><td>[10]</td><td>reduce combat disadvantage</td></tr><tr><td>[11]</td><td>improve combat advantage</td></tr><tr><td>[12]</td><td>stop/flee dangerous-immediate-hostile</td></tr><tr><td>[13]</td><td>avoid small fall</td></tr><tr><td>[14]</td><td>avoid harming non-hostile</td></tr><tr><td>[15]</td><td>stop/flee immediate-hostile</td></tr><tr><td>[16]</td><td>stop/avoid all-hostile</td></tr><tr><td>[17]</td><td>avoid being pushed</td></tr><tr><td>[18]</td><td>avoid pushing another</td></tr><tr><td>[19]</td><td>improve movement efficiency</td></tr><tr><td>[20]</td><td>stop tire</td></tr><tr><td>[21]</td><td>stop thirst</td></tr><tr><td>[22]</td><td>stop hunger</td></tr><tr><td>[23]</td><td>reduce stressed</td></tr><tr><td>[24]</td><td>reduce fatigued</td></tr><tr><td>[25]</td><td>progress objective</td></tr><tr><td>[26]</td><td>improve value to encumbrance ratio</td></tr><tr><td>[27]</td><td>improve self effects</td></tr><tr><td>[28]</td><td>move anywhere/explore</td></tr><tr><td>[29]</td><td>anger those with whom we are angry</td></tr><tr><td>[30]</td><td>prevent angering those with whom we are not angry</td></tr><tr><td>[31]</td><td>improve beneficial favor</td></tr><tr><td>[32]</td><td>reduce harmful favor</td></tr><tr><td>[33]</td><td>improve any favor</td></tr></table></td></tr>'
                    html += '<tr><td>react</td><td>re-action. on carrying out the action of others, other entities given opportunity to automatically override their queued action (and will if the prioitiy is higher and generated re-action is different). In some instances, the player can select a re-action or pre-plan automatic re-actions. Some skills may be required to avoid harm.</td></tr>'
                    html += '<tr><td>Ability</td><td>repeating action upto chosen time. May be infinite-use or limited hrs/day (showing fractional hours. 1.5 is 90min or 750 rounds). May include/require individual actions/skills/spells.</td></tr>'
                    html += '<tr><td>Skill</td><td>single action. may be infinite-use or max uses per day.</td></tr>'
                    html += '<tr><td>Spell</td><td>single action. require spell charges. All spells regen up to spell-charges during sleep or rest.</td></tr>'
                    html += '<tr><td>level</td><td>Acquired spells gain 1 rank every 2-4 character levels (upto max-rank). Basic stats (hp, general-acc, general-eva, general-save) go up...and then down around level 20 (some other level-rewards exist. training bonuses do not decay).</td></tr>'
                    html += '<tr><td>save</td><td>Save chance (x 5%) from specific types of harm. The most widely-used bonuses are resilience (str and con. physical), reflex (dex and cha. adaptation), and fortitude (int and wis. mental).</td></tr>'
                    html += '<tr><td>initiative</td><td>Lower is faster and acts first, although decisions are made simultaneously.<br>By default, a char will auto-try to pre-move into range before attack (but may fail or not chase).</td></tr>'
                    // html += '<tr><td></td><td></td><td></td></tr></tbody>'
                    html += '</tbody></table>'

                    for (let [stat, effects] of Object.entries(__prop._stat_lvl_effects_)){
                        html += '<table><tbody>'
                        rows = []
                        cols = []
                        data = {}

                        for (let [prop, rules] of Object.entries(effects)){
                            if (!cols.includes(prop)) 
                                cols.push(prop);
                            tmp = 1 + cols.indexOf(prop)
                            for (let [req, rule] of Object.entries(rules)){
                                if (!rows.includes(req)){
                                    rows.push(req);
                                    data[req] = [req.replaceAll('__', '< ').replace('_', '')]
                                }
                                if (prop[0] == '_' && rule > 0){
                                    data[req][tmp] = '+' + rule
                                }else{
                                    data[req][tmp] = String(rule)
                                }
                            }
                        }

                        html += '<tr><th>'
                        html += stat.toUpperCase()
                        html += '</th>'
                        try{
                            html += cols.map((i)=>('<th>'+ (__prop._effect_labels_[i].__ || __prop._effect_labels_[i]._) +'</th>')).join('')
                        }catch(e){
                            console.log(cols)
                            console.log(e)
                        }
                        html += '</tr>'

                        rows.sort(function(a,b){
                            let l = Number(a.replaceAll('_', '')) - Number(b.replaceAll('_', ''))
                            if (!l)
                                l = b.length - a.length;
                            return l
                        });
                        // console.log(data, cols, rows)

                        for (let row of rows){
                            html += '<tr>'
                            html += '<td>' + data[row][0] + '</td>'
                            html += cols.map((i,ix)=>('<td>' + (data[row][1+ix] || '') + '</td>')).join('')
                            html += '</tr>'
                        }

                        html += '</tbody></table>'
                    }

                    __prop._help_inspect = html
                }

                if ('creation' != __sel._state){
                    this._children_gen_opts = []
                    return;
                } 
                __prop._inspect_as_html = true
                __prop._inspect = __prop._help_inspect
                this._children_gen_opts = [
                    {gen:'creation_reroll_msg', opts:{}},
                    {gen:'creation_stat', opts:{stat:'str'}},
                    {gen:'creation_stat', opts:{stat:'con'}},
                    {gen:'creation_stat', opts:{stat:'dex'}},
                    {gen:'creation_stat', opts:{stat:'cha'}},
                    {gen:'creation_stat', opts:{stat:'int'}},
                    {gen:'creation_stat', opts:{stat:'wis'}},
                    {gen:'creation_class', opts:{}},
                    {gen:'creation_rerolls', opts:{}},
                    {gen:'creation_auto_next', opts:{}},
                    {gen:'creation_reset', opts:{}},
                    {gen:'creation_quick_finish', opts:{}},
                    {gen:'creation_add', opts:{}},
                    ]
            }
        },
        creation_rerolls: {_element: 'div', _className: 'rerolls', 
            _prop__: {
                innerText: function (dsp, opts){
                    if (__prop._creation && __prop._creation._ent){
                        dsp.setAttribute('data-rerolls', __prop._creation._ent._rerolls || 0)
                        return "more 1d6 rerolls."
                    }
                },
            }
        },
        creation_reroll_msg: {_element: 'div', _className: 'reroll msg', _prop__: {innerText: ()=>(__prop._creation && __prop._creation._ent && __prop._creation._ent._reroll_msg || "")}},
        creation_stat: {_element: 'div', _className: 'stat', className: (opts)=>opts.stat,
            children_: function(res, opts){
                if (!__prop._creation._ent) return;
                let gen
                res.appendChild(select.generate_('creation_stat_reroll', {stat: opts.stat}))
                gen = __prop._creation._ent[opts.stat]
                res.appendChild(select.generate_('creation_stat_value', {value: gen}))
            },
        },
        creation_stat_reroll: {_element: 'div', _className:"reroll", _prop__: {
            innerText: (res, opts)=>('train ' + opts.stat.toUpperCase()),
            onclick: (res, opts)=>()=>{try{__prop._creation._ent.reroll(opts.stat)}catch(e){console.log(e)}}}},
        creation_stat_value: {_element: 'div', _className: 'value', 
            children_: function(res, opts){
                let d
                if (!__prop._creation) 
                    return;
                res.appendChild(d = select.generate_('cur_value_lbl', {value: opts.value[0]}))
                if (opts.value[0] < 8){
                    d.classList.add('bad')
                }
                res.appendChild(select.generate_('die_lbl', {die: 'd6', value: opts.value[1]}))
                res.appendChild(select.generate_('die_lbl', {die: 'd6', value: opts.value[2]}))
                res.appendChild(select.generate_('die_lbl', {die: 'd6', value: opts.value[3]}))
            },
        },

        creation_auto_next: {_element: 'button', 
            className: ()=>{if (!__prop._creation || !__prop._creation._ent) return 'hidden';},
            children: function(dsp){
                if (dsp.classList.contains('hidden'))return;
                __prop._creation._ent.auto_stat()
                if (__prop._creation._ent._auto_stat){
                    dsp.innerText = 'train ' + __prop._creation._ent._auto_stat.toUpperCase()
                }else{
                    dsp.innerText = 'train STR'
                    dsp.disabled = true
                }

                if (!__prop._creation._ent._rerolls)
                    dsp.disabled = true;
            },
            _prop_: {onclick: function(){
                __prop._creation._ent.reroll(__prop._creation._ent._auto_stat)
            }
        }},
        creation_quick_finish: {_element: 'button', 
            className_: (dsp, opts)=>{if (!__prop._creation || !__prop._creation._ent) return 'hidden';
                dsp.innerText = 'quick ' + __prop._creation._ent.cl
                if (!(__prop._creation._ent._rerolls > 0) || !__prop._creation._ent._auto_stat)
                    dsp.disabled = true;
            }, 
            _prop_: {onclick: function(){
                let ent = __prop._creation && __prop._creation._ent, rerolls = 0
                if (!(ent._rerolls > 0)) 
                    return;
                if (!__prop._creation._ent._auto_stat){
                    this.disabled = true 
                    return
                }
                while (ent._rerolls != rerolls){
                    rerolls = ent._rerolls
                    ent.reroll(ent._auto_stat)
                    ent.auto_stat()
                    if (!__prop._creation._ent._auto_stat){
                        this.disabled = true 
                        return
                    }
                }
            }
        }},
        creation_reset: {_element: 'button', 
            className: ()=>{if (!__prop._creation || !__prop._creation._ent) return 'hidden';},
            _prop_: {innerText: 'reset', onclick: function(){
                __action.init_creation()
            }
        }},
        creation_add: {_element: 'button', _className: 'add',
            className_: function(dsp, opts){
                if (!__prop._creation || !__prop._creation._ent) return 'hidden';
                if (__prop._creation._ent._rerolls)
                    dsp.disabled = true;
            },
            _prop_: {innerText: 'make', onclick: function(){
                if (!__prop._creation  || !__prop._creation || !__prop._creation._ent 
                    || __prop._creation._ent._rerolls) 
                    return;
                __prop._creation._ent.finalize();
            }
        }},
        creation_class: {_element: 'div', _className: 'class', _prop__: {
            innerText: function(res, opts){
                let tmp, txt, war = [],
                    ent = __prop._creation && __prop._creation._ent;
                if (!ent) return;
                war[1] = ent.str[0] + ent.con[0];
                war[2] = ent.dex[0] + ent.cha[0];
                if (war[2] > war[1]){
                    war[0] = [war[2], ['dex', 'cha']]
                }else{
                    war[0] = [war[1], ['str', 'con']]
                }
                war[3] = ent.int[0] + ent.wis[0];
                if (war[3] > war[0][0]){
                    war[0] = [war[3], ['int', 'wis']]
                }
                txt = ent.name
                txt += ': '
                // 1+ to simulate class initialized
                txt += ( 1 + ent[war[0][1][0]][0] )
                txt += '-'
                txt += ( 1 + ent[war[0][1][1]][0] )
                txt += ' '

                let USE_SUBCLASS = 0
                // naming is not good. need semi-fixed

                if (war[0][1][0] == 'str'){
                    if (!USE_SUBCLASS){
                        ent.cl = 'WAR'
                        txt += 'WAR'
                    }else if (ent.cl != 'WAR'){
                        ent.cl = 'WAR'
                        // random class-name
                        // 'strcon' => CRO COT STN 
                        tmp = [__action.pick_in_range(6), __action.pick_in_range(6), __action.pick_in_range(6)]
                        ent.sub_cl = tmp.map((i)=>('STRCON'[i])).join('')
                        tmp = tmp[0] + tmp[1] + tmp[2]
                        ent.sub_cl_def = tmp - 7.5 
                    }
                }else if (war[0][1][0] == 'dex'){
                    if (!USE_SUBCLASS){
                        ent.cl = 'ROG'
                        txt += 'ROG'
                    }else if (ent.cl != 'ROG'){
                        ent.cl = 'ROG'
                        // 'dexcha' => HEX DAX HAD
                        tmp = [__action.pick_in_range(6), __action.pick_in_range(6), __action.pick_in_range(6)]
                        ent.sub_cl = tmp.map((i)=>('DEXCHA'[i])).join('')
                        tmp = tmp[0] + tmp[1] + tmp[2]
                        ent.sub_cl_def = tmp - 7.5 
                    }
                }else{
                    if (!USE_SUBCLASS){
                        ent.cl = 'MND'
                        txt += 'MND'
                    }else if (ent.cl != 'MND'){
                        ent.cl = 'MND'
                        // 'intwis' => WIT TSN ISI
                        tmp = [__action.pick_in_range(6), __action.pick_in_range(6), __action.pick_in_range(6)]
                        ent.sub_cl = tmp.map((i)=>('INTWIS'[i])).join('')
                        // for name consistency, norm 'I'
                        tmp = tmp.map((i)=>((i==0 || i ==4)? 2:i))
                        tmp = tmp[0] + tmp[1] + tmp[2]
                        ent.sub_cl_def = tmp - 7.5 
                    }
                }
                if (USE_SUBCLASS){
                    txt += ent.sub_cl + ' ('
                    // 0 - 7.5 - 15
                    if (ent.sub_cl_def >= 5.0 ){
                        txt += 'abs'
                    }else if (tmp <= -5.0){
                        // txt += ' +++off'
                        txt += 'crit'
                    }else if (tmp >= 2.5){
                        // txt += ' ++def'
                        txt += 'res'
                    }else if (tmp <= -2.5){
                        // txt += ' ++off'
                        txt += 'dmg'
                    }else if (tmp > 0){
                        // txt += ' +def'
                        txt += 'eva'
                    }else if (tmp < 0){
                        // txt += ' +off'
                        txt += 'acc'
                    }
                    txt += '-' + ent.cl +')'
                }

                txt += '\n'
                txt += 'WAR : str + con\n'
                txt += 'ROG : dex + cha\n'
                txt += 'MND : int + wis\n'

                return txt
            }},_prop_: {
        }},
        creation_ent: { _class: 'Object',
            init_: function(ent, opts){
                ent._auto_stat = 'str'
                ent.auto_stat = function(_log){
                    if (!ent || !ent.cl) return;

                    const map = {
                        WAR: [['str', 14],
                              ['con', 14],
                              ['dex', 10],
                              ['wis', 10],
                              ['cha', 10],
                              ['int', 10],
                              // ['str', 17],
                              // ['con', 17],
                            ],
                        ROG: [['dex', 14],
                              ['cha', 14],
                              ['str', 10],
                              ['con', 10],
                              ['int', 10],
                              ['wis', 10],
                              // ['dex', 17],
                              // ['cha', 17],
                            ],
                        MND: [['int', 16],
                              ['wis', 16],
                              ['str', 10],
                              ['con', 10],
                              ['dex', 10],
                              ['cha', 10],
                              // ['int', 17],
                              // ['wis', 17],
                            ],
                    }

                    let log = (ent.cl + ':')

                    for (let rule of map[ent.cl]){
                        log += '\n  ' + rule[0] + '=' + ent[rule[0]][0] +' is '
                        if (ent[rule[0]][0] < rule[1]){
                            ent._auto_stat = rule[0]
                            log += ('less than ' + rule[1] + ' so reroll. ')
                            if (_log) console.log(log);
                            return ent._auto_stat
                        }else{
                            log += ('not less than ' + rule[1])
                        }
                    }

                    ent._auto_stat = null
                    // ent._auto_stat = map[ent.cl][0][0]
                    // log += ('\n ... none found. default to primary. fix rules.')
                    // if (_log) console.log(log);
                    // return ent._auto_stat;
                }
                ent._rerolls = __prop._creation._stat_rerolls
                ent._renames_until_any_letter = 20
                ent.roll_name = function(){
                    if (this._renames_until_any_letter){
                        --this._renames_until_any_letter
                        this.name = __action._gen_name(__prop._creation._ix)
                    }else{
                        this.name = __action._gen_name(__action.pick_in_range(26))
                    }
                }

                ent.roll_name()
                ent.finalize = function(){
                    let final_ent, final_opts = {};

                    if (++__prop._creation._ix >= 26)
                        __prop._creation._ix = 0;
                    final_opts.name = ent.name
                    final_opts.cl = ent.cl
                    final_opts.lvl = 0
                    switch(ent.cl){
                        case 'WAR':
                            final_opts.w = 'short_sword'
                            final_opts.b = 'hide_armor'
                            ent.str[0] += 1
                            ent.con[0] += 1
                            break;
                        case 'ROG':
                            final_opts.w = 'dagger'
                            final_opts.b = 'leather_armor'
                            ent.dex[0] += 1
                            ent.cha[0] += 1
                            break;
                        case 'MND':
                            final_opts.w = 'honing_staff'
                            final_opts.b = 'robes'
                            ent.int[0] += 1
                            ent.wis[0] += 1
                            break;
                    }
                    final_opts.str = ent.str[0]
                    final_opts.con = ent.con[0]
                    final_opts.dex = ent.dex[0]
                    final_opts.cha = ent.cha[0]
                    final_opts.int = ent.int[0]
                    final_opts.wis = ent.wis[0]
                    final_opts.wrel = [32, 14, 8, 8, 8, 8, __prop._party.length, 1];
                    final_opts.wrelix = [32+SZ_WORLD_X*14, 8+8*SZ_REGION_ENVIRON, 8+8*SZ_REGION_ENVIRON, final_opts.wrel[6] + 1*SZ_LOCALE_X]
                    // final_opts.inv = ['meat', 'meat', 'gourd_2']
                    final_opts.inv = []

                    final_opts.prompt = "GM:  ---- Greetings " + final_opts.name + ". " + __action.pick_from_items(__prop._prompts.gm['create_' + ent.cl])

                    final_ent = select.generate_('Ent_party', final_opts)
                    __prop._party.push(final_ent)

                    __prop._inspect_sz = view.LESS
                    __prop._party_info_sz = view.LESS

                    if (__prop._party.length < __prop._creation._party_size){
                        __action.init_creation()
                    }else{
                        __prop._creation._ent = null
                        // __action.set_state('debug')
                        // __action.set_state('environ')
                        __action.set_state('world')
                        // __action.set_state('locale')
                    }
                }
                ent.reroll = function(stat){
                    let i, n, r, success
                    if (!(this._rerolls > 0)){
                        this._rerolls = 0
                        // console.log('warn: no stat rerolls remaining')
                        return
                    }
                    if (!(__prop._stats.includes(stat))){
                        console.log('warn: invalid reroll stat:', stat)
                        return
                        // stat = __action.pick_from_items(stats)  stats[-1 + __action.result_roll([stats.length])]
                    }
                    if (this[stat][0] >= __prop._creation._stat_max){
                        this._reroll_msg = 'Max stat. Cannot reroll.'
                        return view.display('creation_')
                    }

                    this._rerolls--;
                    n = 10
                    i = 1
                    for (let _i of Object.keys(this[stat])){
                        if (this[stat][_i] <= n){
                            i = _i
                            n = this[stat][_i]
                        }
                    }
                    r = __action.result_roll(__prop._creation._stat_reroll)
                    this._reroll_msg = '[' + r + ']: '
                    if (r <= n){
                        this._reroll_msg += "failed to train " + stat.toUpperCase()
                    }else{
                        success = (r - n)
                        this[stat][i] = r
                        this[stat][0] = __prop._creation._stat_base + this[stat][1] + this[stat][2] + this[stat][3]
                        this._reroll_msg += stat.toUpperCase() + " +" + (r-n)
                        if (this[stat][0] >= __prop._creation._stat_max){
                            this._reroll_msg += '  --MAX--'
                        }

                    }
                    return view.display('creation_')
                    return success
                }

                for (let stat of __prop._stats){
                    ent[stat] = [__prop._creation._stat_base]
                    let rem = __prop._creation._stat_rolls
                    while(rem-- > 0){
                        ent[stat].push(__action.result_roll(__prop._creation._stat_roll))
                        ent[stat][0] += ent[stat][-1 + ent[stat].length]
                    }
                }
            },
        },

        cur_value_lbl: {_element: 'div', _className: 'cur', _prop__: {innerText: (res, opts)=>(opts.value)}},
        die_lbl: {_element: 'span', _className: 'die', 
            className_: function(dsp, opts){
                dsp.classList.add(opts.die)

                let max = Number(opts.die.slice(1))
                
                // worst1 worst2 ...
                dsp.classList.add('worst' + opts.value)

                // best1 best2 ...
                max = (1 + max - opts.value)
                dsp.classList.add('best' + max)


            }, _prop__: {innerText: (res, opts)=>(opts.value)}
        },

        Ent_base: { _class: 'Object',
            finalize_: function(_this, opts){
                let props = new Set(['name', 'hp', 'max_hp', 'mv', 'max_1h_wt', 'max_b_wt',
                    ])
                for (let [prop, value] of Object.entries(opts || {})){
                    switch (prop){
                    case 'inv':
                        // do at end
                        break;
                    case 'name':
                    case 'cl':
                        _this[prop] = value 
                        props.delete(prop)
                        break;
                    case 'mv':
                    case 'lvl':
                    case 'xp_to_lvl':
                    case 'max_1h_wt':
                    case 'max_b_wt':
                        if (value > 0){
                            _this[prop] = value || 0
                        }
                        props.delete(prop)
                        break;

                    default:
                        if (__prop._eq_slots.includes(prop)){
                            // do at end
                            break;
                        }
                        _this.set(prop, value)
                        props.delete(prop)
                        break;
                    }
                }

                // remaining essential
                for (let prop of props){
                    switch (prop){
                    case 'name':
                        console.log('default name?', opts)
                        break;
                    case 'max_hp':
                    case 'hp':
                        _this[prop] = 1
                        break;
                    case 'mv':
                        _this[prop] = 12
                        break;
                    case 'max_1h_wt':
                        _this[prop] = 10
                        break;
                    case 'max_b_wt':
                        _this[prop] = 15
                        break;
                    default:
                        console.log('impliment essential prop')
                    }
                }
                _this.inv = [[null]]
                if (opts.inv){
                    for (let i of opts.inv){
                        _this.add_inv(i)
                    }
                }
                for (let slot of __prop._eq_slots){
                    if (opts[slot])
                        _this.set_eq(slot, opts[slot])
                }
                if (_this.cl && _this.xp_to_lvl < 1)
                    _this.levelup();
            }, 
            _prop_: {
                msgs: {push:()=>{}},
            
        
                set_stat(stat, value){
                    if (!__prop._stats.includes(stat))
                        return;
                    // 3 types: 
                    //    _prop are bonus-like and set (cur-bonus - old-bonus)
                    //    prop_ are add-rem-like and compile [used-to-have-names] [now-have-names] and set (prop-base, name, true/false )
                    //    prop are set-like and set (cur-value)

                    let cur, old, ov, cv, fo, fc, tmp, add
                    old = this[stat]
                    cur = this[stat] = value
                    for (let [prop, rules] of Object.entries(__prop._stat_lvl_effects_[stat])){
                        fo = fc = 0
                        if (prop.endsWith('_')){
                            ov = []
                            cv = []
                            add = prop.slice(0,-1)
                        }else{
                            cv = ov = 0
                            add = false
                        }
                        for (let [req, val] of Object.entries(rules)){
                            if (req.startsWith('__')){
                                // less than
                                tmp = req.slice(2)
                                if (old && fo != 2){
                                    if (tmp > old){
                                        fo = 1
                                        if (add){
                                            if (val)
                                                ov.push(val)
                                        }else{
                                            ov = val
                                        }
                                    } else if(fo == 1){
                                        fo = 2
                                    }
                                }
                                if (cur && fc != 2){
                                    if (tmp > cur){
                                        fc = 1
                                        if (add){
                                            if (val)
                                                cv.push(v)
                                        }else{
                                            cv = val
                                        }
                                    } else if(fc == 1){
                                        fc = 2
                                    }
                                }
                            }else{
                                // exact
                                if (old && fo != 2){
                                tmp = req.slice(1)
                                    if (tmp == old){
                                        fo = 1
                                        if (add){
                                            if (val)
                                                ov.push(val)
                                        }else{
                                            ov = val
                                        }
                                    } else if(fo == 1){
                                        fo = 2
                                    }
                                }
                                if (cur && fc != 2){
                                    if (tmp == cur){
                                        fc = 1
                                        if (add){
                                            if (val)
                                                cv.push(val)
                                        }else{
                                            cv = val
                                        }
                                    } else if(fc == 1){
                                        fc = 2
                                    }
                                }
                            }
                        }
                        if (add){
                            // (skill/ability/spell, name, true/false )
                            for (let r of ov){
                                if (!cv.includes(r)){
                                    this.set(add, r, false)
                                }
                            }
                            for (let r of cv){
                                if (!ov.includes(r)){
                                    this.set(add, r, true)
                                }
                            }
                        }else if (prop.startsWith('_')){
                            this.set(prop, cv - ov)
                        }else{
                            this.set(prop, cv)
                        }
                    }
                },
                set_eq: function(slot, name){
                    // console.log('wip set eq', arguments)
                },
                add_inv: function(name, cnt){
                    // console.log('wip add inv', arguments)
                },

                get: function(prop, _arg){
                    switch(prop){
                    case 'stat':
                        return this[_arg]
                    default:
                        if (prop in this)
                            return this[prop]
                        console.error('impliment GET ent prop:', prop, _arg)
                    }
                },
                set: function(prop, value, _arg){
                    switch(prop){
                    case 'onday_heal_roll':     //  4
                    case 'onday_unc_heal_roll': //  1
                    case 'acc_2h1':             // -6
                    case 'acc_w2':              // -8
                    case 'carry_wt':            // 40
                        console.log('prevented SET ent const-prop:', prop)
                        break;
                    case 'wrel':
                    case 'wrelix':
                        this[prop] = Array.from(value)
                        break;
                    case 'favor':
                    case 'max_1h_wt':
                    case 'max_b_wt':
                    case 'acc':
                    case 'm_acc':
                    case 'r_acc':
                    case 's_acc':
                    case 'dmg':
                    case 'm_dmg':
                    case 'r_dmg':
                    case 's_dmg':
                    case 'eva':
                    case 'm_eva':
                    case 'r_eva':
                    case 's_eva':
                        if (value > 0 || value < 0)
                            this[prop] = value;
                        else
                            this[prop] = 0;
                        break;
                    case '_sv_resilience':
                    case '_sv_reflex':
                    case '_sv_fortitude':
                    case '_sv_fever':
                    case '_onday_heal_roll':
                    case '_onday_unc_heal_roll':
                    case '_s_charges':
                    case '_hp_onlvl':
                    case '_acc_2h1':
                    case '_acc_w2':
                    case '_max_1h_wt':
                    case '_max_b_wt':
                    case '_carry_wt':
                    case '_acc':
                    case '_m_acc':
                    case '_r_acc':
                    case '_s_acc':
                    case '_dmg':
                    case '_m_dmg':
                    case '_r_dmg':
                    case '_s_dmg':
                    case '_eva':
                    case '_m_eva':
                    case '_r_eva':
                    case '_s_eva':
                        if (value > 0 || value < 0)
                            this[prop] = (this[prop] || 0) + value
                        break;
                    case 'prompt':
                        this[prop] = value 
                        break;

                    case 'msg':
                        this.msgs.push(value) 
                        break;
                    case 'msgs':
                        if (Array.isArray(value))
                            this.msgs = this.msgs.concat(value) 
                        else
                            this.msgs.push(value) 
                        break;
                    case 'stat':
                        return this.set_stat(value, _arg)
                    default:
                        if (__prop._stats.includes(prop)){
                            return this.set_stat(prop, value)
                        }
                        if (prop.startsWith('fv_') && (value > 0 || value < 0)){
                            return this[prop] = (this[prop] || 0) + value
                        }

                        console.error('impliment SET ent prop:', prop, value, _arg)
                    }
                },
            }
        },
        Ent_party: { _generate: 'Ent_base',
            init_: function(_this, opts){
                console.log('generate Ent party member from',opts)
            }

        },
        Ent_mob: { _generate: 'Ent_mob',
            init_: function(_this, opts){
                console.log('generate Ent mob from',opts)
            }
        },

        action_: {_element: 'div', _className: 'action',
            _children_dsp: [
                ]
        },

        world_: {_element: 'table',
            className_: function(dsp, opts){
                if (__sel._state != 'world') return 'hidden';
                return 'world'
            },

            children_: function(dsp, opts){
                const VIEW_BLOCK_GAP = 0
                if (__sel._state != 'world') return 'hidden'

                __prop._world_dsp = dsp

                let x, y, c, tmp, body, row, cell, focus 
                __prop._wrel = __action.ensure_wrel(__prop._wrel)
                focus = __prop._wrel && __prop._wrel.length > 1? __prop._wrel.slice(0,2): [32,14]

                switch (__prop._viewing_cycle){
                case 1:
                    dsp.classList.add('npclbl')
                    break;
                case 2:
                    dsp.classList.add('roadlbl')
                    break;
                case 3:
                    break;
                case 4:
                    dsp.classList.add('bglbl')
                    break;
                default:
                    __prop.viewing_world = 0
                    dsp.classList.add('noroad')
                }

                dsp.setAttribute('cellspacing', VIEW_BLOCK_GAP != null? VIEW_BLOCK_GAP: __prop._viewing_block_gap)
                dsp.classList.add('size'+__prop._viewing_block_sz);
                dsp.appendChild(body = document.createElement('tbody'))

                function focus_zoom_region(){
                    if (this.classList.contains('focus')){
                        __prop._wrel = [this.wx, this.wy]
                        __action.set_state('region')
                        return
                    }
                    if (__prop._focus_dsp)
                        __prop._focus_dsp.classList.remove('focus')
                    __prop._focus_dsp = this
                    this.classList.add('focus')
                    __action.scroll_dom_to_center(this)
                }

                y = -1
                c = -1
                while (++y < 30){
                    x = -1
                    body.appendChild(row = document.createElement('tr'))
                    while (++x < 60){
                        row.appendChild(cell = document.createElement('td'))
                        cell.wx = x 
                        cell.wy = y

                        tmp = __prop._world_bg[++c]
                        cell.setAttribute('data-bg', tmp)
                        cell.classList.add('cell')
                        cell.className += ' ' + __prop._block_rule_.map[tmp].cl
                        cell.onclick = focus_zoom_region
                        if (tmp != tmp.toLowerCase()){
                            cell.classList.add('road')
                        }
                        if (focus && focus[0] == x && focus[1] == y){
                            cell.classList.add('focus')
                            if (__prop._focus_dsp)
                                __prop._focus_dsp.classList.remove('focus')
                            __prop._focus_dsp = cell

                            setTimeout(()=>__action.scroll_dom_to_center(__prop._focus_dsp), 10)
                        }

                        tmp = __prop._world_npc[c]
                        if (tmp)
                            cell.setAttribute('data-npc', tmp)
                        tmp = __prop._world_dist[c]
                        if (tmp != '-')
                            cell.setAttribute('data-dist', tmp)
                    }
                }
                return 
            },
        },
        world_top_: {_element: 'div', _className: 'world top',
            className: ()=>{if ('world' != __sel._state) return 'hidden'},
            children: function(dsp){
                if (dsp.classList.contains('hidden'))return;
            },
        },

        block_menu_: {_element: 'div', _className: 'block_menu', 
            children_: function(dsp, opts){
                if (!(['world', 'region', 'environ', 'locale']).includes(__sel._state)){
                    dsp.classList.add('hidden')
                    return
                }
                dsp.appendChild(select.generate_('block_view_cycle'))
                dsp.appendChild(select.generate_('block_inc_size'))
                dsp.appendChild(select.generate_('block_dec_size'))
            }
        },
        block_view_cycle: {_element: 'div', _className: 'btn on',
            className_: function(dsp, opts){
                switch (__prop._viewing_cycle){
                case 1:
                    dsp.innerText = 'N'
                    break;
                case 2:
                    dsp.innerText = 'R'
                    break;
                case 3:
                    dsp.innerText = 'r'
                    break;
                case 4:
                    dsp.innerText = 'B'
                    break;
                default:
                    dsp.innerText = 'b'
                }
            }, _prop_: {
                onclick: function(evt){
                    if (evt) evt.stopPropagation();
                    __prop._viewing_cycle += 1
                    let d = __prop['_' + __sel._state + '_dsp'];
                    switch (__prop._viewing_cycle){
                    case 1:
                        this.innerText = 'N'
                        d.classList.remove('noroad')
                        d.classList.add('npclbl')
                        return
                    case 2:
                        this.innerText = 'R'
                        d.classList.remove('npclbl')
                        d.classList.add('roadlbl')
                        return
                    case 3:
                        this.innerText = 'r'
                        d.classList.remove('roadlbl')
                        return
                    case 4:
                        this.innerText = 'B'
                        d.classList.add('bglbl')
                        return
                    default:
                        __prop._viewing_cycle = 0
                        this.innerText = 'b'
                        d.classList.remove('bglbl')
                        d.classList.add('noroad')
                    }
                },  
            },
        },

        block_inc_size: {_element: 'div', _className: 'btn on',
            _prop_: {innerText: '+',
                onclick: function(evt){
                    const min = 8 
                    const max = 16
                    if (evt) evt.stopPropagation();
                    let d = __prop['_' + __sel._state + '_dsp']
                    d.classList.remove('size'+__prop._viewing_block_sz)
                    if (!(__prop._viewing_block_sz >= min && __prop._viewing_block_sz < max)){
                        __prop._viewing_block_sz = min
                    }else{
                        ++__prop._viewing_block_sz
                    }
                    d.classList.add('size'+__prop._viewing_block_sz)
                },  
            },
        },

        block_dec_size: {_element: 'div', _className: 'btn on',
            _prop_: {innerText: '-',
                onclick: function(evt){
                    const min = 8 
                    const max = 16
                    if (evt) evt.stopPropagation();
                    let d = __prop['_' + __sel._state + '_dsp']
                    d.classList.remove('size'+__prop._viewing_block_sz)
                    if (!(__prop._viewing_block_sz > min && __prop._viewing_block_sz <= max)){
                        __prop._viewing_block_sz = max
                    }else{
                        --__prop._viewing_block_sz
                    }
                    d.classList.add('size'+__prop._viewing_block_sz)
                },  
            },
        },

        region_: {_element: 'table',
            className: function(dsp, opts){
                if (__sel._state != 'region') return 'hidden';
                return 'region'
            },
            children_: function(dsp, opts){
                const VIEW_BLOCK_GAP = 1.2;
                if (dsp.classList.contains('hidden')) return;

                let wrel = __prop._wrel = __action.ensure_wrel(__prop._wrel)

                if (!wrel || wrel.length < 2 || !__action.__wrel_get_bg(wrel.slice(0,2), true)){
                    setTimeout(()=>__action.set_state('world'), 10)
                    return;
                }

                __prop._region_dsp = dsp

                switch (__prop._viewing_cycle){
                case 1:
                    dsp.classList.add('npclbl')
                    break;
                case 2:
                    dsp.classList.add('roadlbl')
                    break;
                case 3:
                    break;
                case 4:
                    dsp.classList.add('bglbl')
                    break;
                default:
                    __prop.viewing_region = 0
                    dsp.classList.add('noroad')
                }

                let body
                dsp.setAttribute('cellspacing', VIEW_BLOCK_GAP != null? VIEW_BLOCK_GAP: __prop._viewing_block_gap)
                dsp.classList.add('size'+__prop._viewing_block_sz);
                dsp.appendChild(body = document.createElement('tbody'))

                if (!__prop._wrel_.has(wrel.join('_'))){
                    __prop._wrel_.set(wrel.slice(0,2).join('_'), select.generate_('Region', {wrel}))
                }

                let at = {}, focus = wrel.length > 3? wrel.slice(2, 4): [4,4]
                at.c = wrel.slice(0,2)
                at.l = __action.__wrel_move_left(at.c, 1)
                at.r = __action.__wrel_move_right(at.c, 1)
                at.u = __action.__wrel_move_up(at.c, 1)
                at.d = __action.__wrel_move_down(at.c, 1)
                at.ul = __action.__wrel_move_left(at.u, 1)
                at.ur = __action.__wrel_move_right(at.u, 1)
                at.dl = __action.__wrel_move_left(at.d, 1)
                at.dr = __action.__wrel_move_right(at.d, 1)

                let x, y = -1, row, cell
                while (++y < 27){
                    x = -1
                    body.appendChild(row = document.createElement('tr'))
                    while (++x < 27){
                        row.appendChild(cell = document.createElement('td'))

                        cell.rx = x % 9 
                        cell.ry = y % 9

                        if (x < 9){
                            if (y < 9){
                                cell.wx = at.ul[0]
                                cell.wy = at.ul[1]
                            }else if (y < 18 ){
                                cell.wx = at.l[0]
                                cell.wy = at.l[1]
                            }else{
                                cell.wx = at.dl[0]
                                cell.wy = at.dl[1]
                            }
                        }else if (x < 18){
                            if (y < 9){
                                cell.wx = at.u[0]
                                cell.wy = at.u[1]
                            }else if (y < 18 ){
                                cell.wx = at.c[0]
                                cell.wy = at.c[1]
                                if (focus && focus[0] == cell.rx && focus[1] == cell.ry){
                                    cell.classList.add('focus')
                                    if (__prop._focus_dsp)
                                        __prop._focus_dsp.classList.remove('focus')
                                    __prop._focus_dsp = cell
                                    setTimeout((cell)=>__action.scroll_dom_to_center(__prop._focus_dsp), 10)
                                }
                            }else{
                                cell.wx = at.d[0]
                                cell.wy = at.d[1]
                            }
                        }else{
                            if (y < 9){
                                cell.wx = at.ur[0]
                                cell.wy = at.ur[1]
                            }else if (y < 18 ){
                                cell.wx = at.r[0]
                                cell.wy = at.r[1]
                            }else{
                                cell.wx = at.dr[0]
                                cell.wy = at.dr[1]
                            }
                        }

                        if (!cell.rx){
                            cell.setAttribute('data-b-l', 'r')
                        }else if (cell.rx == MX_REGION_ENVIRON){
                            cell.setAttribute('data-b-r', 'r')
                        }
                        if (!cell.ry){
                            cell.setAttribute('data-b-t', 'r')
                        }else if (cell.ry == MX_REGION_ENVIRON){
                            cell.setAttribute('data-b-b', 'r')
                        }

                        bg = __action.__wrel_get_bg([cell.wx, cell.wy, cell.rx, cell.ry])
                        cell.classList.add('cell')
                        if (!bg){
                            bg = __action.__wrel_get_bg([cell.wx, cell.wy])
                            cell.classList.add('fog')
                        }
                        cell.className += ' ' + __prop._block_rule_.map[bg].cl
                        cell.onclick = __action.__RegionCell_focus_zoom_environ

                        cell.setAttribute('data-bg', bg)

                        if (bg != bg.toLowerCase()){
                            cell.classList.add('road')
                        }
                    }
                }
            },
        },
        Region: {_class: 'Array',
            children_: function(res, opts){
                let wrel = Array.from(opts.wrel).slice(0,2)
                if (__prop._wrel_.has(wrel.join('_'))){
                    // prevent recreate
                    // console.log('warn: tried generating existing Region')
                    let d = __prop._wrel_.get(wrel.join('_'))
                    for (let v of d){
                        res.push(v)
                    }
                    return
                }else if (__prop._wrel_.has('_' + wrel.join('_'))){
                    // 'discover' of previously made. delete copy.
                    let d = __prop._wrel_.get('_' + wrel.join('_'))
                    for (let v of d){
                        res.push(v)
                    }
                    __prop._wrel_.delete('_' + wrel.join('_'))
                    return

                }

                let grid = __action.__wrel_get_bg_grid9(wrel, true)
                if (!grid && !grid[4]){
                    console.log('recover?')
                    debugger
                    return
                }

                __action.__mapgen(res, opts, grid)
            },
        },
        region_top_: {_element: 'div', _className: 'region top',
            className: ()=>{if ('region' != __sel._state) return 'hidden'},
            children: function(dsp){
                if (dsp.classList.contains('hidden'))return;
                dsp.appendChild(select.generate_('region_top_goto_world'))
                dsp.appendChild(select.generate_('region_top_label'))
            },
        },
        region_top_goto_world: {_element: 'div', _className: 'btn on',
            _prop_: {innerText: '<=', onclick: function(){return __action.set_state('world')}}
        },
        region_top_label: {_element: 'div', _className: 'label',
            // _prop_:{innerText: 'Region [900m/0.56mi] '}
            // _prop_:{innerText: 'Region [900m] '}
            // _prop_:{innerText: '[900m]  Region'}
            _prop__: {
                innerText: function(dsp, opts){
                    try{
                        return __action.__wrel_get_bg_name(__prop._wrel.slice(0,2))
                    }catch(e){}
                },
            },
        },

        environ_: {_element: 'table',
            className: function(dsp, opts){
                if (__sel._state != 'environ') return 'hidden';
                return 'environ';
            },
            children_: function(dsp, opts){
                const VIEW_BLOCK_GAP = 0;
                if (dsp.classList.contains('hidden')) return;

                let wrel = __prop._wrel = __action.ensure_wrel(__prop._wrel)

                if (!wrel || wrel.length < 4 || !__action.__wrel_get_bg(wrel.slice(0,4), true)){
                    setTimeout(()=>__action.set_state('region'), 10)
                    return;
                }

                __prop._environ_dsp = dsp

                switch (__prop._viewing_cycle){
                case 1:
                    dsp.classList.add('npclbl')
                    break;
                case 2:
                    dsp.classList.add('roadlbl')
                    break;
                case 3:
                    break;
                case 4:
                    dsp.classList.add('bglbl')
                    break;
                default:
                    __prop.viewing_environ = 0
                    dsp.classList.add('noroad')
                }

                let body
                dsp.setAttribute('cellspacing', VIEW_BLOCK_GAP != null? VIEW_BLOCK_GAP: __prop._viewing_block_gap)
                dsp.classList.add('size'+__prop._viewing_block_sz);
                dsp.appendChild(body = document.createElement('tbody'))

                if (!__prop._wrel_.has(wrel.join('_'))){
                    __prop._wrel_.set(wrel.slice(0,4).join('_'), select.generate_('Environ', {wrel}))
                }

                let at = {}, focus = wrel.length > 5? wrel.slice(4,6): [4,4]
                at.c = wrel.slice(0,4)
                at.l = __action.__wrel_move_left(at.c, 1)
                at.r = __action.__wrel_move_right(at.c, 1)
                at.u = __action.__wrel_move_up(at.c, 1)
                at.d = __action.__wrel_move_down(at.c, 1)
                at.ul = __action.__wrel_move_left(at.u, 1)
                at.ur = __action.__wrel_move_right(at.u, 1)
                at.dl = __action.__wrel_move_left(at.d, 1)
                at.dr = __action.__wrel_move_right(at.d, 1)

                let x, y = -1, row, cell
                while (++y < 27){
                    x = -1
                    body.appendChild(row = document.createElement('tr'))
                    while (++x < 27){
                        row.appendChild(cell = document.createElement('td'))

                        cell.ex = x % 9 
                        cell.ey = y % 9


                        if (x < 9){
                            if (y < 9){
                                cell.wx = at.ul[0]
                                cell.wy = at.ul[1]
                                cell.rx = at.ul[2]
                                cell.ry = at.ul[3]
                            }else if (y < 18 ){
                                cell.wx = at.l[0]
                                cell.wy = at.l[1]
                                cell.rx = at.l[2]
                                cell.ry = at.l[3]
                            }else{
                                cell.wx = at.dl[0]
                                cell.wy = at.dl[1]
                                cell.rx = at.dl[2]
                                cell.ry = at.dl[3]
                            }
                        }else if (x < 18){
                            if (y < 9){
                                cell.wx = at.u[0]
                                cell.wy = at.u[1]
                                cell.rx = at.u[2]
                                cell.ry = at.u[3]
                            }else if (y < 18 ){
                                cell.wx = at.c[0]
                                cell.wy = at.c[1]
                                cell.rx = at.c[2]
                                cell.ry = at.c[3]
                                if (focus && focus[0] == cell.ex && focus[1] == cell.ey){
                                    cell.classList.add('focus')
                                    if (__prop._focus_dsp)
                                        __prop._focus_dsp.classList.remove('focus')
                                    __prop._focus_dsp = cell
                                    setTimeout((cell)=>__action.scroll_dom_to_center(__prop._focus_dsp), 10)
                                }
                            }else{
                                cell.wx = at.d[0]
                                cell.wy = at.d[1]
                                cell.rx = at.d[2]
                                cell.ry = at.d[3]
                            }
                        }else{
                            if (y < 9){
                                cell.wx = at.ur[0]
                                cell.wy = at.ur[1]
                                cell.rx = at.ur[2]
                                cell.ry = at.ur[3]
                            }else if (y < 18 ){
                                cell.wx = at.r[0]
                                cell.wy = at.r[1]
                                cell.rx = at.r[2]
                                cell.ry = at.r[3]
                            }else{
                                cell.wx = at.dr[0]
                                cell.wy = at.dr[1]
                                cell.rx = at.dr[2]
                                cell.ry = at.dr[3]
                            }
                        }

                        if (!cell.rx && !cell.ex){
                            cell.setAttribute('data-b-l', 'r')
                        }else if (cell.rx == MX_REGION_ENVIRON && cell.ex == MX_REGION_ENVIRON){
                            cell.setAttribute('data-b-r', 'r')
                        }else if (!cell.ex){
                            cell.setAttribute('data-b-l', 'e')
                        }else if (cell.ex == MX_REGION_ENVIRON){
                            cell.setAttribute('data-b-r', 'e')
                        }
                        if (!cell.ry && !cell.ey){
                            cell.setAttribute('data-b-t', 'r')
                        }else if (cell.ry == MX_REGION_ENVIRON && cell.ey == MX_REGION_ENVIRON){
                            cell.setAttribute('data-b-b', 'r')
                        }else if (!cell.ey){
                            cell.setAttribute('data-b-t', 'e')
                        }else if (cell.ey == MX_REGION_ENVIRON){
                            cell.setAttribute('data-b-b', 'e')
                        }

                        bg = __action.__wrel_get_bg([cell.wx, cell.wy, cell.rx, cell.ry, cell.ex, cell.ey])

                        cell.classList.add('cell')
                        if (!bg){
                            cell.classList.add('fog')
                            bg = __action.__wrel_get_bg([cell.wx, cell.wy, cell.rx, cell.ry])
                            if (!bg){
                                bg = __action.__wrel_get_bg([cell.wx, cell.wy])
                            }
                        }
                        cell.className += ' ' + __prop._block_rule_.map[bg].cl
                        cell.onclick = __action.__EnvironCell_focus_zoom_locale

                        cell.setAttribute('data-bg', bg)

                        if (bg != bg.toLowerCase()){
                            cell.classList.add('road')
                        }
                    }
                }
            },
        },
        Environ: {_class: 'Array',
            children_: function(res, opts){
                let wrel = Array.from(opts.wrel).slice(0,4)
                if (__prop._wrel_.has(wrel.join('_'))){
                    // prevent recreate
                    // console.log('warn: tried generating existing Environ')
                    let d = __prop._wrel_.get(wrel.join('_'))
                    for (let v of d){
                        res.push(v)
                    }
                    return
                }else if (__prop._wrel_.has('_' + wrel.join('_'))){
                    // 'discover' of previously made. delete copy.
                    let d = __prop._wrel_.get('_' + wrel.join('_'))
                    for (let v of d){
                        res.push(v)
                    }
                    __prop._wrel_.delete('_' + wrel.join('_'))
                    return

                }

                let grid = __action.__wrel_get_bg_grid9(wrel, true)
                if (!grid){
                    console.log('recover?')
                    debugger
                    return
                }
                let r_grid = __action.__wrel_get_bg_grid9(wrel.slice(0,-2), true)
                for (let [i,b] of Object.entries(grid)){
                    if (!b){
                        grid[i] = r_grid[i] || grid[4]
                    }
                }

                __action.__mapgen(res, opts, grid)

            },
        },
        environ_top_: {_element: 'div', _className: 'environ top',
            className: ()=>{if ('environ' != __sel._state) return 'hidden'},
            children: function(dsp){
                if (dsp.classList.contains('hidden'))return;
                dsp.appendChild(select.generate_('environ_top_goto_region'))
                dsp.appendChild(select.generate_('environ_top_label'))
            },
        },
        environ_top_goto_region: {_element: 'div', _className: 'btn on',
            _prop_: {innerText: '<=', onclick: function(){return __action.set_state('region')}}
        },
        environ_top_label: {_element: 'div', _className: 'label',
            // _prop_:{innerText: '[100m]  Environ'}
            _prop__: {
                innerText: function(dsp, opts){
                    try{
                        let txt
                        txt = __action.__wrel_get_bg_name(__prop._wrel.slice(0,2))
                        txt += ' > '
                        txt += __action.__wrel_get_bg_name(__prop._wrel.slice(0,4))
                        return txt
                    }catch(e){}
                },
            },
        },      

        // locale_ => locale_dsp => Locale
        locale_: {_element: 'div',
            className: function(dsp, opts){
                if (__sel._state != 'locale') return 'hidden';
                return 'locale'
            },
            children_: function(dsp, opts){
                if (dsp.classList.contains('hidden')) return;

                let wrel = __prop._wrel = __action.ensure_wrel(__prop._wrel)

                if (!wrel || wrel.length < 6 || !__action.__wrel_get_bg(wrel = wrel.slice(0,6), true)){
                    setTimeout(()=>__action.set_state('environ'), 10)
                    return;
                }

                if (__prop._locale_dsp && __prop._locale_dsp.getAttribute('data-wrel') == wrel.join('_')){
                    dsp.appendChild(__prop._locale_dsp)
                    __prop._locale_dsp.refresh()
                }else{
                    dsp.appendChild(__prop._locale_dsp = select.generate_('locale_dsp', opts))
                }
            },
        },
        locale_dsp: {_element: 'table', _className: 'locale',
            children_: function(dsp, opts){
                const VIEW_BLOCK_GAP = 0
                let debug = true

                // debugger;

                let wrel = __prop._wrel = __action.ensure_wrel(__prop._wrel)
                if (!wrel || wrel.length < 6 || !(__action.__wrel_get_bg(wrel = wrel.slice(0,6), true))){
                    return;
                }

                let data, wrelk = wrel.join('_')
                dsp.setAttribute('data-wrel', wrelk)
                if (__prop._wrel_.has(wrelk)){
                    data = __prop._locale_data = __prop._wrel_.get(wrelk)
                }else if (__prop._wrel_.has('_' + wrelk)){
                    // ALWAYS revealing when making display.
                    data = __prop._locale_data = __prop._wrel_.get('_' + wrelk)
                    __prop._wrel_.set(wrelk, data)
                    __prop._wrel_.delete('_' + wrelk)
                }else{
                    // GENERATE unique. default no save, but possible
                    if (__prop._locale_gen.load_wrel(wrel)){
                        data = __prop._locale_data = __prop._locale_gen.build()
                    }else{
                        if (debug)debugger;
                        __prop._locale_gen.load_wrel(wrel)
                        data = __prop._locale_data = __prop._locale_gen.build()
                    }
                    if (data && opts.save){
                        __prop._wrel_.set(wrelk, data)
                    }
                }
                if (!data || !data.bg){
                    console.log('error generating locale data for display.')
                    if(debug)debugger;
                    __prop._locale_gen.load_wrel(wrel)
                    data = __prop._locale_data = __prop._locale_gen.build()
                    if (!data || !data.bg){             
                        return;
                    }
                }
                dsp.setAttribute('data-bgs', __prop._locale_gen.bgs)

                switch (__prop._viewing_cycle){
                case 1:
                    dsp.classList.add('npclbl')
                    break;
                case 2:
                    dsp.classList.add('roadlbl')
                    break;
                case 3:
                    break;
                case 4:
                    dsp.classList.add('bglbl')
                    break;
                default:
                    __prop.viewing_locale = 0
                    dsp.classList.add('noroad')
                }

                let body
                dsp.setAttribute('cellspacing', VIEW_BLOCK_GAP != null? VIEW_BLOCK_GAP: __prop._viewing_block_gap)
                dsp.classList.add('size'+__prop._viewing_block_sz);
                dsp.appendChild(body = document.createElement('tbody'))

                let at = {}, focus = wrel.length > 7? wrel.slice(6,8): [49,0]
                at.c = wrel.slice(0,6)

                let x, y = -1, row, cell
                while (++y < SZ_LOCALE_Y){
                    x = -1
                    body.appendChild(row = document.createElement('tr'))
                    while (++x < SZ_LOCALE_X){
                        row.appendChild(cell = document.createElement('td'))

                        cell.lx = x 
                        cell.ly = y

                        if (focus && focus[0] == x && focus[1] == y){
                            cell.classList.add('focus')
                            if (__prop._focus_dsp)
                                __prop._focus_dsp.classList.remove('focus')
                            __prop._focus_dsp = cell
                            setTimeout((cell)=>__action.scroll_dom_to_center(__prop._focus_dsp), 10)
                        }

                        bg = data.bg[SZ_LOCALE_X * y + x]
                        cell.setAttribute('data-bg', bg)

                        cell.classList.add('cell')
                        if (!bg || !__prop._block_rule_.locale.bg[bg]){
                            debugger
                        }else{
                            cell.classList.add(__prop._block_rule_.locale.bg[bg].cl)
                        }
                        cell.onclick = __action.__LocaleCell_viewing_focus

                    }
                }

            },_prop_:{
                refresh: function(){
                },
            },
        },


        Locale: {_class: 'Array',
            children_: function(res, opts){
                let wrel = Array.from(opts.wrel).slice(0,4)
                if (__prop._wrel_.has(wrel.join('_'))){
                    // prevent recreate
                    console.log('warn: tried generating existing Environ')
                    let d = __prop._wrel_.get(wrel.join('_'))
                    for (let v of d){
                        res.push(v)
                    }
                    return
                }else if (__prop._wrel_.has('_' + wrel.join('_'))){
                    // 'discover' of previously made. delete copy.
                    let d = __prop._wrel_.get('_' + wrel.join('_'))
                    for (let v of d){
                        res.push(v)
                    }
                    __prop._wrel_.delete('_' + wrel.join('_'))
                    return

                }

                let grid = __action.__wrel_get_bg_grid9(wrel, true)
                if (!grid){
                    console.log('recover?')
                    debugger
                    return
                }
                let r_grid = __action.__wrel_get_bg_grid9(wrel.slice(0,-2), true)
                for (let [i,b] of Object.entries(grid)){
                    if (!b){
                        grid[i] = r_grid[i] || grid[4]
                    }
                }

                __action.__mapgen(res, opts, grid)

            },
        },

        locale_top_: {_element: 'div', _className: 'environ top',
            className: ()=>{if ('locale' != __sel._state) return 'hidden'},
            children: function(dsp){
                if (dsp.classList.contains('hidden'))return;
                dsp.appendChild(select.generate_('locale_top_goto_environ'))
                dsp.appendChild(select.generate_('locale_top_label'))
            },
        },
        locale_top_goto_environ: {_element: 'div', _className: 'btn on',
            _prop_: {innerText: '<=', onclick: function(){return __action.set_state('environ')}}
        },
        locale_top_label: {_element: 'div', _className: 'label',
            // _prop_:{innerText: '[1m]  Locale'}
            _prop__: {
                innerText: function(dsp, opts){
                    try{
                        let txt = __action.__wrel_get_bg_name(__prop._wrel.slice(0,2))
                        txt += ' > '
                        txt += __action.__wrel_get_bg_name(__prop._wrel.slice(0,4))
                        txt += ' > '
                        txt += __action.__wrel_get_bg_name(__prop._wrel.slice(0,6))
                        return txt
                    }catch(e){}

                },
            },
        },

        results_: {_element: 'div', _className: 'results',
            children_: function(dsp, opts){
                if (__prop._results){
                    while (__prop._results.length)
                        dsp.appendChild(select.generate_('results_tile', {result: __prop._results.shift()}))
                }
            }
        },
        results_tile: {_element: 'div', _className: 'tile',
            children_: function(dsp, opts){
                dsp.innerText = String(opts.result)
            },
        },

        targets_: {_element: 'div', _className: 'targets',
        },

        party_: {_element: 'div', _className: 'party info',
            className_: function(dsp, opts){
                if (!__prop._party.length) return 'hidden'
                select.action_('add_component_sizable_', [dsp, __sel, '_party_info_sz'])
            },
            children: function(dsp){
                dsp.appendChild(select.generate_('info_us'))
                let eix = 0
                for (let ent of __prop._party){
                    dsp.appendChild(select.generate_('info_ent', {ent: ent, eix: eix++}))
                }
            },
        },
        encounter_: {_element: 'div', _className: 'encounter info',
            className_: function(dsp, opts){
                if (!__prop._party.length) return 'hidden'
                select.action_('add_component_sizable_', [dsp, __sel, '_encounter_info_sz'])
            },
            children: function(dsp){
                dsp.appendChild(select.generate_('info_them'))
                let eix = 0
                for (let ent of __prop._encounter){
                    dsp.appendChild(select.generate_('info_ent', {ent: ent, eix: eix++}))
                }
            },
        },

        info_us: {_element: 'div', _className: 'us', 
            children: function(dsp){
                // summary
            },
        },
        info_them: {_element: 'div', _className: 'them', 
            children: function(dsp){
                // summary
            },
        },

        info_ent: {_element: 'div', _className: 'ent sib', 
            className_: function(dsp, opts){
                if (!opts || !opts.ent || !(opts.eix >= 0))
                    return 'empty';

                if (opts.ent.mob){
                    select.action_('add_component_sizable_', [dsp, __sel, '_encounter_info_sz', opts.eix])
                }
            },
            _children_gen_opts: [
                'info_ent_plate',
                ] ,
        },      
        info_ent_plate: {_element: 'div', _className:"plate",
            _children_gen_opts: [
                'info_ent_tag',
                ],
        },
        info_ent_tag: {_element: 'div', _className:"tag",
            _children_gen_opts: [
                'info_ent_index',
                'info_ent_name'
                ],
        },
        info_ent_index: {_element: 'span', _className:"index",
            children_: function(dsp, opts){
                const nt_fv_min = 0, nt_fv_max = 29;
                if (opts.ent.mob){
                    dsp.innerText = __prop._encounter.indexOf(opts.ent)
                    dsp.classList.add('mob')
                    for (let p of __prop._party){
                        if ((opts.ent['fv_' + p.name] || 0) < nt_fv_min || (p['fv_' + opts.ent.name] || 0) < nt_fv_min){
                            dsp.classList.add('hostile')
                            return
                        }
                        if ((opts.ent['fv_' + p.name] || 0) > nt_fv_max || (p['fv_' + opts.ent.name] || 0) > nt_fv_max){
                            dsp.classList.add('friend')
                        }
                    }
                }else{
                    dsp.classList.add('party')
                    dsp.innerText = __prop._party.indexOf(opts.ent)
                }
            },
        },
        info_ent_name: {_element: 'span', _className:"name",
            children_: function(dsp, opts){
                dsp.innerText = opts.ent.name
                select.action_('add_component_inspect_', [dsp, 'ent', opts.ent])
            },
        },

    },// _generate_
    _display_: {
        // name_ ( suffix '_' ) are re-generate '._value' and inserted-where-prev-value-is-if-exists
        // name ( no suffix '_' ) return '._value' or generate-once
        // { _value:<auto-made>  generate()?  _generate_name?  _generate_options?  _generate?: name-or-array[ <name>, <options> ]

        page_mmenu: {_generate_name: 'page_mmenu', },
        
        // on-view page
        top: {_generate_name: 'top', },
        menu: {_generate_name: 'left_menu', },
        up: {_generate_name: 'up', },
        main: {_generate_name: 'main', },
        down: {_generate_name: 'down', },
        right: {_generate_name: 'right', },
        bottom: {_generate_name: 'bottom', },

        results_: {_generate_name: 'results_'},
        coord_label_: {_generate_name: 'coord_label_', },
        block_menu_: {_generate_name: 'block_menu_', },
        
        targets_: {_generate_name: 'targets_'},
        
        party_: {_generate_name: 'party_', },
        action_: {_generate_name: 'action_', },

        action_targetted_: {_generate_name: 'action_targetted_'},
        action_last_: {_generate_name: 'action_last_', },
        action_msgs_: {_generate_name: 'action_msgs_', },
        action_prompt_: {_generate_name: 'action_prompt_', },
        action_select_: {_generate_name: 'action_select_'},
        action_options_: {_generate_name: 'action_options_', },

        // _after all
        // main_msgs_: {_generate_name: 'main_msgs_', },
        // main_prompt_: {_generate_name: 'main_prompt_', },
        status_: {_generate_name: 'status_', },
        inspect_: {_generate_name: 'inspect_'},

        // state: creation
        creation_: {_generate_name: 'creation_'},
        creation_top_: {_generate_name: 'creation_top_'},

        // state: world
        world_: {_generate_name: 'world_', },
        world_top_: {_generate_name: 'world_top_', },

        // state: region
        region_: {_generate_name: 'region_', },
        region_top_: {_generate_name: 'region_top_', },

        // state: environ
        environ_: {_generate_name: 'environ_', },
        environ_top_: {_generate_name: 'environ_top_'},
        encounter_: {_generate_name: 'encounter_'},

        // state: locale
        locale_: {_generate_name: 'locale_', },
        locale_top_: {_generate_name: 'locale_top_', },

    },
    _view_: {
        top: 'top',
        left: 'menu',

        up: 'up',
        main: 'main',
        down: 'down',
        
        right: 'right',
        bottom: 'bottom',
    },
}// __sel = _selection = this-path (sub-selection called __sel._selecting)
__prop = __sel._prop_
__action = __sel._action_


__prop._world_bg = "mfimmffFFFFMmmmmfmmmmmmmdDDDdwwwwwwwmmmmmcccmmmmccmmmmmmFwimiwwwimFFwwwFMFIWMMDddcddDDwwwwmwmmMWFFFFcimFFFFFFmfwwwwfFFwmwwiwwiFwwfwwfmiwmdDDcfcDDwwmcimwmFFwwfmFFFFFwwfmFFFWFFwwwWwwmiciwwWwfcfwwwwwmddDdwDDdwmfmfFWFFcmwwwwwwwwwfmwwwwwfFFfwFFFmmiwwiFwwfwwmwmwwwwDDDDdwwmFFFFwfciwFFFmmwwmmcwwwwfwwwWwwwwFmffwmwFfwwwmiimwwmwwdmdwwmFFwwwwwfFFFmFFFmwwfwwwmwwwfwFFwfwFwwwwfmFFwwfiimfFWFmwwdwwmfFwwwwwFFFiwfmwFfmwwwwmgmmwwwwWwwwWmmfwfmfFFwwwmfFFwFFmwwwwmiFFFwFFFmwfFFFFFwwwwmmgGGGmwwwFFwFFmfwwmfgfFFFwmfFwwwFFwiwwwmmfFWFmwfFFFwwwwwfmwggGGgMcmcwwFwFfmffwwmfcmmMwwwWwfwwWwwwmwwwwwwmFFFFwwwfwmmggwGGGwcJjwwcwFWFfccmcwccmWSSwmmFFMfwFmwiffwmfwwfFwwwwwfmmwgGGWGggwjJwjjmwwwfmsSSSWSssSwwwwsmmFmwFMIIFwwMFFwwFFwwwmmgwgGGggwwwcmWJJjjmwmmswSswwWwsSwmswswsMmwwfmfFfwM"+
"mFFwwFwggGGGGGGggmgmwwjjcJjmwwwwswWwwSSwwWwSSSWscMfwwwwwFFWF"+
"wwMMFWGGGGgwggmmmgGMJJwjJJwmwsswwwSwsSwwsSSWwwSSMFfwFFFwwwww"+
"mwwwWFWmmmmgmcgggGGmjJJwJmjMWSSSssSwsSwsmwwwswwwmfwwWwFFwfww"+
"wwFWFWFFFffmcCGGgGgmjwJwJJJJwwsWwwWwmWwsSSWSSWScmfwwFfwWwwwF"+
"WFFwwCcmWFFwiCcGwGgcmWJwwwwwwSSSwsSwwSwwSwwswwSmfwwFFwwFfwFF"+
"wwwWCCwwwfFfwFmGgGgmJWwwMMMMmSwswwSwsSWSWswwwSSmwwwFwwfFwwWwwMCFwwwFWFFwmFmGGGmWWcmmDdcCmSSSsmSMMmwmswSWSSmwwFWFwfwFWfFwmCmfwcwFwwmfwFimgmWJcmddDdMCcmsSsmmwWwcwmsSwmwwwfFwwwwwwFFFwwFCMfwFFmwwfFFicmWJcDDDmDdMiCMSSmwwwGmgcwcSWwwwwwWwffwfwwwwwwwmCMfFmcmwFFfcmJWcdDcDDDdMMMmwwwmgmGGGgmwcSwcwwFFwFMMFmfwMWFwwwFmMciFWFfmmwWwmdDddddmwwwwwmmMGwmgGfwwmMWWWFFwwWwmCCFMCwFMCwFmMFFFwwmmwWJwmdDDDmcwwwmwmIImGWGGGwmwcmwwwmffFFwwwwwwwwwwMWCcifmmmwwwwWwwwmmdMwwwmmiwiImwggcgwgMWMGWMMFMCMwwMCMmwmmwwwwwiciffimwwFFwjwwwwWwwmiIIWIImmmwGWGGMwwwwfiwffwwCFwCcmFFMMmmwwwwwFWFWFMwwwwmmcCimCIIwiwimmggGmgwcwcfwwwmwwwmMwFWwwWwwFMDmwwmwWwwwwwwwmmcwiCCICcwimiwmcmgGGGGWMWCWCFWMWCWFwWwMFFmwmdDdmwfwFFWFWFWMIIIImciwcIIIIiwmmccmmmmmwwwwiwmwcwwwwFFFmmdDWDDdmwwwwwwwwwwmiciIIIIIIIicIwim"
__prop._world_dist = "-------12345-------------789----------------------------9---------9N---6789D123-----56--------234567---345678-------87--------8-----------45---34--------S1----89T12----9A1234---6--------7------------6--12------6789-------------------56--543------6------------789S----2345-----321---------------7----2------5-------------------A1------654-L98-------------89---1------43-------987--------9-----987-----7--------------T---E-------21-----1E-65-------876-21D---23456-------234----12-89--------I98---2---43--------543---9A1----------L1-5-----3-7-----------7---3----2-----------5678----------789--6-----456---------456---456--1-----------4----------3456----7----------65432--3-------7--V9876--987--32--------12-------89E--------7---1--2-------8------5--A-65--1---56789L----------1--------8--9O--1-7654--9------4321--432W1234--------4567--32--------9--8---M98--321N--321---------1RA----------23--89-4--9N123--C--7--------------4-N9------21LDM12----123-1----M-5678---4--1--6--9876543-----5--8---6543--1--345--E-4-A---21------765--2--5--L-----2----76--7--87---432----6--9-5-9--43--7654-8----3--4321----E1----8---6--9--765---U987--8-678-65---8--3-9R1--456-----6789---1O9---54-E--8-----1-----7----87----9-12---2----7-----5------2------321--9A1--32----56---E9-654-N-A-6543----8-----43-----3-------------23-4----34---21--7-321-987-------9H1----2----54-321R---432---4-5--S12----3---8------------98---2----1R9876--4--98765-1R9-5-6789-----54---9C1--------89-76543-----------65----------876----------6------2--------7--------7654321E987--456------------------87------3----23456----21N98-----------23-7--89E1-------4321N9-------4--9H1--------3---------------1-98--7--234-----5------------5678----------456789M123456789I-N-456----5-----6789T1234567-----5678------------------------123---9876----------------89S1234--9---"
__prop._world_own = ""
__prop._world_npc = ""


}})()
// end tool/miniroll.js
</script>
</head>
<body class="h-f">
<div class="h-f d-fc" id="bodyall">
    <div id="bodyhead"></div>
    <div id="bodytop"></div>
    <div class="f-1 d-fr" id="bodyrow">
        <div class="h-f d-fc" id="bodyleft"></div>
        <div class="h-f f-1 d-fc b-vw-v" id="bodycol">
            <div class="w-f" id="bodyup"></div>
            <div class="w-f f-1 b-vw-v" id="bodycell"></div>
            <div class="w-f" id="bodydown"></div>
            </div>
        <div class="h-f d-fc" id="bodyright"></div>
        </div>
    <br class="clear">
    <div id="bodybot"></div>
    <div id="bodyfoot"></div>
    <div id="bodybrand">My2</div>
    </div>
</body>
</html>
